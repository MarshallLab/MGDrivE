<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>MGDrivE Examples • MGDrivE</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.1/jquery-3.6.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="MGDrivE Examples">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MGDrivE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.6.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><a class="dropdown-item" href="../articles/mgdrive_examples.html">Example Simulations</a></li>
    <li><a class="dropdown-item" href="../articles/mgdrive_math.html">Mathematical Description</a></li>
    <li><a class="dropdown-item" href="../articles/mgdrive_run.html">Detailed Run Example</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/MarshallLab/MGDrivE" aria-label="View on GitHub"><span class="fa fa-lg fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>MGDrivE Examples</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/MarshallLab/MGDrivE/blob/HEAD/vignettes/mgdrive_examples.Rmd" class="external-link"><code>vignettes/mgdrive_examples.Rmd</code></a></small>
      <div class="d-none name"><code>mgdrive_examples.Rmd</code></div>
    </div>

    
    
<style type="text/css">
pre {
  white-space: pre !important;
  overflow-y: scroll !important;
  max-height: 25vh !important;
}

# reference
#  https://stackoverflow.com/questions/41135085/how-to-make-vertical-scrollbar-appear-in-rmarkdown-code-chunks-html-view
</style>
<div class="section level2">
<h2 id="landscape-setup">Landscape Setup<a class="anchor" aria-label="anchor" href="#landscape-setup"></a>
</h2>
<p><em>MGDrivE</em> is capable of running in one population, on a simple
network, or on networks derived from real locations and parameterized
using local topology and climate. Topology and climate analysis are out
of the scope of this vignette, but we will show how to setup simple,
single-node examples to real landscapes parameterized only by distance.
The key to this flexibility is that the landscape module of
<em>MGDrivE</em> only requires a matrix of daily movement rates between
nodes. Nodes are listed along the X/Y-axis, with the diagonal
representing the proportion of mosquitoes that don’t leave a node at
each day.</p>
<p>Each example produces a <code>moveMat</code> object - this is the
matrix of daily movement rates. It is used for the
<code>migrationMale</code> and/or <code>migrationFemale</code> matrices
in the constructor of the <code>Network</code> object.</p>
<div class="section level3">
<h3 id="single-population">Single Population<a class="anchor" aria-label="anchor" href="#single-population"></a>
</h3>
<p>Each node on our network represents an independent population. Thus,
it is important that <em>MGDrivE</em> run on a on a single node. A
single population can be provided by parameterizing <em>MGDrivE</em>
with a 1-by-1 matrix, where there is a 100% chance of individuals
staying at that location (i.e., there is no where else to move, thus
they have to remain).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># setup movement matrix for 1 node</span></span>
<span><span class="va">moveMat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fl">1</span>, nrow <span class="op">=</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">moveMat</span></span>
<span><span class="co">#&gt;      [,1]</span></span>
<span><span class="co">#&gt; [1,]    1</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="two-populations">Two Populations<a class="anchor" aria-label="anchor" href="#two-populations"></a>
</h3>
<p>Extending our single population example, running <em>MGDrivE</em> on
2 populations is also simple. However, movement rates are calculated
using the rows, i.e., the movement of critters from node 1 to any other
node is parameterized by row 1 in the movement matrix. Thus, the rows of
the movement matrix must be normalized and sum to 1.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># setup movement matrix for 2 nodes</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># 2 nodes, no migration</span></span>
<span><span class="co">####################</span></span>
<span><span class="va">moveMat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, ncol <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">moveMat</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]    1    0</span></span>
<span><span class="co">#&gt; [2,]    0    1</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># 2 nodes, with migration</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># 5% migration per day from population 1</span></span>
<span><span class="co"># 10% migraton per day from population 2</span></span>
<span><span class="co">#  Notice that the rows sum to 1</span></span>
<span><span class="va">moveMat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.95</span>, <span class="fl">0.05</span>, <span class="fl">0.10</span>, <span class="fl">0.90</span><span class="op">)</span>,</span>
<span>                  nrow <span class="op">=</span> <span class="fl">2</span>, ncol <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">moveMat</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,] 0.95 0.05</span></span>
<span><span class="co">#&gt; [2,] 0.10 0.90</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="n-populations">n Populations<a class="anchor" aria-label="anchor" href="#n-populations"></a>
</h3>
<p><em>MGDrivE</em> can run on arbitrary networks, provided that the
rows of the movement matrix are normalized. Below are two more examples,
one completely random, and one where there is migration to the
population on either side only, as if all populations were in a
line.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># setup random movement matrix for 5 nodes</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># 5 nodes</span></span>
<span><span class="co">####################</span></span>
<span><span class="va">nNodes</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="co"># fill with random data</span></span>
<span><span class="va">moveMat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">nNodes</span><span class="op">*</span><span class="va">nNodes</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="va">nNodes</span>, ncol <span class="op">=</span> <span class="va">nNodes</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># normalize</span></span>
<span><span class="va">moveMat</span> <span class="op">&lt;-</span> <span class="va">moveMat</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">moveMat</span><span class="op">)</span></span>
<span><span class="va">moveMat</span></span>
<span><span class="co">#&gt;           [,1]       [,2]       [,3]       [,4]       [,5]</span></span>
<span><span class="co">#&gt; [1,] 0.2448828 0.13895585 0.12253207 0.25163078 0.24199852</span></span>
<span><span class="co">#&gt; [2,] 0.2669949 0.20987141 0.20489206 0.27871981 0.03952180</span></span>
<span><span class="co">#&gt; [3,] 0.1162291 0.05470122 0.37966140 0.04772306 0.40168521</span></span>
<span><span class="co">#&gt; [4,] 0.2624233 0.20761107 0.08071609 0.15010016 0.29914933</span></span>
<span><span class="co">#&gt; [5,] 0.2617368 0.28756166 0.18854677 0.22853249 0.03362227</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># setup line with 10 nodes</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># 10 nodes in a line</span></span>
<span><span class="co">####################</span></span>
<span><span class="va">nNodes</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span></span>
<span><span class="co"># define function for use</span></span>
<span><span class="va">triDiag</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">upper</span>, <span class="va">lower</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="co"># return matrix</span></span>
<span>  <span class="va">retMat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fl">0</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">upper</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">upper</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># set index values for upper/lower triangles</span></span>
<span>  <span class="va">indx</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">upper</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># set forward/backward migration using matrix access</span></span>
<span>  <span class="va">retMat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">indx</span><span class="op">+</span><span class="fl">1</span>,<span class="va">indx</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lower</span></span>
<span>  <span class="va">retMat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">indx</span>,<span class="va">indx</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">upper</span></span>
<span></span>
<span>  <span class="co"># set stay probs</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">retMat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">retMat</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">retMat</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># fill movement matrix</span></span>
<span><span class="co">#  Remember, rows need to sum to 1.</span></span>
<span><span class="va">moveMat</span> <span class="op">&lt;-</span> <span class="fu">triDiag</span><span class="op">(</span>upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep.int</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.05</span>, times <span class="op">=</span> <span class="va">nNodes</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>                   lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep.int</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.05</span>, times <span class="op">=</span> <span class="va">nNodes</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">moveMat</span></span>
<span><span class="co">#&gt;       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]</span></span>
<span><span class="co">#&gt;  [1,] 0.95 0.05 0.00 0.00 0.00 0.00 0.00 0.00 0.00  0.00</span></span>
<span><span class="co">#&gt;  [2,] 0.05 0.90 0.05 0.00 0.00 0.00 0.00 0.00 0.00  0.00</span></span>
<span><span class="co">#&gt;  [3,] 0.00 0.05 0.90 0.05 0.00 0.00 0.00 0.00 0.00  0.00</span></span>
<span><span class="co">#&gt;  [4,] 0.00 0.00 0.05 0.90 0.05 0.00 0.00 0.00 0.00  0.00</span></span>
<span><span class="co">#&gt;  [5,] 0.00 0.00 0.00 0.05 0.90 0.05 0.00 0.00 0.00  0.00</span></span>
<span><span class="co">#&gt;  [6,] 0.00 0.00 0.00 0.00 0.05 0.90 0.05 0.00 0.00  0.00</span></span>
<span><span class="co">#&gt;  [7,] 0.00 0.00 0.00 0.00 0.00 0.05 0.90 0.05 0.00  0.00</span></span>
<span><span class="co">#&gt;  [8,] 0.00 0.00 0.00 0.00 0.00 0.00 0.05 0.90 0.05  0.00</span></span>
<span><span class="co">#&gt;  [9,] 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.05 0.90  0.05</span></span>
<span><span class="co">#&gt; [10,] 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.05  0.95</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="realistic-location">Realistic Location<a class="anchor" aria-label="anchor" href="#realistic-location"></a>
</h3>
<p>Here we show how to make a landscape from a set of coordinates, each
of which will represent a node the user wishes to simulate in the
metapopulation model. In this example we show a simple setup with 3
nodes.</p>
<p>The first step is to calculate the distance between points - several
built-in functions are provided, or the user may provide their own.
Examples of built-in functions include <code><a href="../reference/calcCos.html">calcCos()</a></code>,
<code><a href="../reference/calcHaversine.html">calcHaversine()</a></code>, or most accurately,
<code><a href="../reference/calcVinEll.html">calcVinEll()</a></code>.</p>
<p>The second step that we do here is to put a zero-inflated exponential
kernel over those distances, using function
<code><a href="../reference/calcHurdleExpKernel.html">calcHurdleExpKernel()</a></code>. We do this because it is
hypothesized that mosquitoes follow a leptokurtic movement pattern. This
also ensures that our rows are normalized. However, this is not
necessary for all scenarios, one must only remember to normalize the
rows.</p>
<p>We also provide functions to calculate a basic exponential kernel
(<code><a href="../reference/calcExpKernel.html">calcExpKernel()</a></code>), gamma kernel
(<code><a href="../reference/calcGammaKernel.html">calcGammaKernel()</a></code>), and log-normal kernel
(<code><a href="../reference/calcLognormalKernel.html">calcLognormalKernel()</a></code>).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># realistic landscape</span></span>
<span></span>
<span><span class="co"># matrix of coordinates as latitude/longitude pairs</span></span>
<span><span class="va">lat_longs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">37.873507</span>, <span class="op">-</span><span class="fl">122.268181</span>,</span>
<span>                             <span class="fl">37.873578</span>, <span class="op">-</span><span class="fl">122.254430</span>,</span>
<span>                             <span class="fl">37.869806</span>, <span class="op">-</span><span class="fl">122.267639</span><span class="op">)</span>,</span>
<span>                    nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                    dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Lat'</span>,<span class="st">'Lon'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate distance matrix between points</span></span>
<span><span class="co"># dmat &lt;- MGDrivE::calcHaversine(latLongs = lat_longs)</span></span>
<span><span class="co"># dmat &lt;- MGDrivE::calcVinSph(latLongs = lat_longs)</span></span>
<span><span class="va">distMat</span> <span class="op">&lt;-</span> <span class="fu">MGDrivE</span><span class="fu">::</span><span class="fu"><a href="../reference/calcVinEll.html">calcVinEll</a></span><span class="op">(</span>latLongs <span class="op">=</span> <span class="va">lat_longs</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate a zero-inflated movement kernal over the distances</span></span>
<span><span class="co"># p0 is the probability, per day, that a mosquito doesn't move.</span></span>
<span><span class="co">#  This is the value used in Code sample 1 from the paper, and in the examples in our</span></span>
<span><span class="co">#  github repository.</span></span>
<span><span class="co"># rate is the average migration rate per day, implying 1/rate is the average</span></span>
<span><span class="co">#  migration distance. The average distance was estimated as ~55.5 meters per day,</span></span>
<span><span class="co">#  which is the value used in Code sample 1 and in the examples on github.</span></span>
<span><span class="va">p0</span> <span class="op">&lt;-</span> <span class="fl">0.991</span></span>
<span><span class="va">rate</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">55.5</span></span>
<span></span>
<span><span class="va">moveMat</span> <span class="op">&lt;-</span> <span class="fu">MGDrivE</span><span class="fu">::</span><span class="fu"><a href="../reference/calcHurdleExpKernel.html">calcHurdleExpKernel</a></span><span class="op">(</span>distMat <span class="op">=</span> <span class="va">distMat</span>, rate <span class="op">=</span> <span class="va">rate</span>, p0 <span class="op">=</span> <span class="va">p0</span><span class="op">)</span></span>
<span><span class="va">moveMat</span></span>
<span><span class="co">#&gt;             [,1]         [,2]        [,3]</span></span>
<span><span class="co">#&gt; [1,] 0.991000000 5.282449e-09 0.008999995</span></span>
<span><span class="co">#&gt; [2,] 0.005513189 9.910000e-01 0.003486811</span></span>
<span><span class="co">#&gt; [3,] 0.008999997 3.340880e-09 0.991000000</span></span></code></pre></div>
<p>Notice, the diagonal elements, representing the probability that a
critter in each node remains in that node, is equal to to zero-inflation
probability, p0. Additionally, each row is normalized to 1.</p>
</div>
</div>
<div class="section level2">
<h2 id="inheritance-simulations">Inheritance Simulations<a class="anchor" aria-label="anchor" href="#inheritance-simulations"></a>
</h2>
<p>It is important to know that a model produces results consistent with
accepted theory. It is also important that other members of the
community (i.e., you, the user!) understand and can run their own
explorations with a model. Thus, we use this section to provide small,
simple examples illustrating how <em>MGDrivE</em> is setup and run, and
connecting these simulations to the underlying theory.</p>
<div class="section level3">
<h3 id="mendelian-inheritance-simulations-single-population">Mendelian Inheritance Simulations, Single Population<a class="anchor" aria-label="anchor" href="#mendelian-inheritance-simulations-single-population"></a>
</h3>
<p>A useful benchmark of population models that include genetic
inheritance is to study basic Mendelian inheritance. <em>MGDrivE</em>
provides a 1-locus, 2-allele Mendelian inheritance pattern in the
function <code><a href="../reference/cubeMendelian.html">cubeMendelian()</a></code>.</p>
<div class="section level4">
<h4 id="deterministic">Deterministic<a class="anchor" aria-label="anchor" href="#deterministic"></a>
</h4>
<p>First, we show an example running a deterministic <em>MGDrivE</em>
simulation under Mendelian inheritance in a single node; that is, a
non-spatial model. The population is 100% <em>AA</em> (homozygous
dominant) individuals at time 0. At day 25, 10 female and 10 male
<em>aa</em> (homozygous recessive) individuals enter the population.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">####################</span></span>
<span><span class="co"># Load libraries</span></span>
<span><span class="co">####################</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://marshalllab.github.io/MGDrivE/" class="external-link">MGDrivE</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading MGDrivE: Mosquito Gene Drive Explorer</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Output Folder</span></span>
<span><span class="co">####################</span></span>
<span><span class="va">outFolder</span> <span class="op">&lt;-</span> <span class="st">"mgdrive"</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Simulation Parameters</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># days to run the simulation</span></span>
<span><span class="va">tMax</span> <span class="op">&lt;-</span> <span class="fl">365</span></span>
<span></span>
<span><span class="co"># entomological parameters</span></span>
<span><span class="va">bioParameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>betaK<span class="op">=</span><span class="fl">20</span>, tEgg<span class="op">=</span><span class="fl">5</span>, tLarva<span class="op">=</span><span class="fl">6</span>, tPupa<span class="op">=</span><span class="fl">4</span>, popGrowth<span class="op">=</span><span class="fl">1.175</span>, muAd<span class="op">=</span><span class="fl">0.09</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># a 1-node network where mosquitoes do not leave</span></span>
<span><span class="va">moveMat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fl">1</span>, nrow <span class="op">=</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># parameters of the population equilibrium</span></span>
<span><span class="va">adultPopEquilibrium</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">sitesNumber</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">moveMat</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Basic Inheritance pattern</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Mendelian cube with standard (default) parameters</span></span>
<span><span class="va">cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cubeMendelian.html">cubeMendelian</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Setup releases and batch migration</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># set up the empty release vector</span></span>
<span><span class="co">#  MGDrivE pulls things out by name</span></span>
<span><span class="va">patchReleases</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span>n<span class="op">=</span><span class="va">sitesNumber</span>,</span>
<span>                           expr<span class="op">=</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maleReleases<span class="op">=</span><span class="cn">NULL</span>,femaleReleases<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>                                      eggReleases<span class="op">=</span><span class="cn">NULL</span>,matedFemaleReleases<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span><span class="op">}</span>,</span>
<span>                           simplify<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># choose release parameters</span></span>
<span><span class="co">#  Releases start at time 25, occur every day, for 1 day.</span></span>
<span><span class="co">#  There are 10 mosquitoes released every time.</span></span>
<span><span class="va">releasesParameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>releasesStart<span class="op">=</span><span class="fl">25</span>,</span>
<span>                           releasesNumber<span class="op">=</span><span class="fl">1</span>,</span>
<span>                           releasesInterval<span class="op">=</span><span class="fl">0</span>,</span>
<span>                           releaseProportion<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate release vector</span></span>
<span><span class="va">releasesVector</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateReleaseVector.html">generateReleaseVector</a></span><span class="op">(</span>driveCube<span class="op">=</span><span class="va">cube</span>,</span>
<span>                                        releasesParameters<span class="op">=</span><span class="va">releasesParameters</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># put releases into the proper place in the release list</span></span>
<span><span class="va">patchReleases</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">maleReleases</span> <span class="op">&lt;-</span> <span class="va">releasesVector</span></span>
<span><span class="va">patchReleases</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">femaleReleases</span> <span class="op">&lt;-</span> <span class="va">releasesVector</span></span>
<span></span>
<span></span>
<span><span class="co"># batch migration is disabled by setting the probability to 0</span></span>
<span><span class="co"># This is required because of the stochastic simulations, but doesn't make sense</span></span>
<span><span class="co">#  in a deterministic simulation.</span></span>
<span><span class="va">batchMigration</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basicBatchMigration.html">basicBatchMigration</a></span><span class="op">(</span>batchProbs<span class="op">=</span><span class="fl">0</span>,</span>
<span>                                      sexProbs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.5</span>,<span class="fl">.5</span><span class="op">)</span>,</span>
<span>                                      numPatches<span class="op">=</span><span class="va">sitesNumber</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Combine parameters and run!</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># set MGDrivE to run deterministic</span></span>
<span><span class="fu"><a href="../reference/setupMGDrivE.html">setupMGDrivE</a></span><span class="op">(</span>stochasticityON <span class="op">=</span> <span class="cn">FALSE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># setup parameters for the network. This builds a list of parameters required for</span></span>
<span><span class="co">#  every population in the network. In ths case, we havee a network of 1 population.</span></span>
<span><span class="va">netPar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/parameterizeMGDrivE.html">parameterizeMGDrivE</a></span><span class="op">(</span>runID<span class="op">=</span><span class="fl">1</span>, simTime<span class="op">=</span><span class="va">tMax</span>, sampTime <span class="op">=</span> <span class="fl">1</span>, nPatch<span class="op">=</span><span class="va">sitesNumber</span>,</span>
<span>                              beta<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">betaK</span>, muAd<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">muAd</span>,</span>
<span>                              popGrowth<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">popGrowth</span>, tEgg<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">tEgg</span>,</span>
<span>                              tLarva<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">tLarva</span>, tPupa<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">tPupa</span>,</span>
<span>                              AdPopEQ<span class="op">=</span><span class="va">adultPopEquilibrium</span>, inheritanceCube <span class="op">=</span> <span class="va">cube</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># build network prior to run</span></span>
<span><span class="va">MGDrivESim</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Network.html">Network</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>params<span class="op">=</span><span class="va">netPar</span>,</span>
<span>                          driveCube<span class="op">=</span><span class="va">cube</span>,</span>
<span>                          patchReleases<span class="op">=</span><span class="va">patchReleases</span>,</span>
<span>                          migrationMale<span class="op">=</span><span class="va">moveMat</span>,</span>
<span>                          migrationFemale<span class="op">=</span><span class="va">moveMat</span>,</span>
<span>                          migrationBatch<span class="op">=</span><span class="va">batchMigration</span>,</span>
<span>                          directory<span class="op">=</span><span class="va">outFolder</span>,</span>
<span>                          verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># run simulation</span></span>
<span><span class="va">MGDrivESim</span><span class="op">$</span><span class="fu">oneRun</span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Post Analysis</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># split output by patch</span></span>
<span><span class="co">#  Required for plotting later</span></span>
<span><span class="fu"><a href="../reference/splitOutput.html">splitOutput</a></span><span class="op">(</span>readDir <span class="op">=</span> <span class="va">outFolder</span>, remFile <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># aggregate females by their mate choice</span></span>
<span><span class="co">#  This reduces the female file to have the same columns as the male file</span></span>
<span><span class="fu"><a href="../reference/aggregateFemales.html">aggregateFemales</a></span><span class="op">(</span>readDir <span class="op">=</span> <span class="va">outFolder</span>, genotypes <span class="op">=</span> <span class="va">cube</span><span class="op">$</span><span class="va">genotypesID</span>,</span>
<span>                 remFile <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot output to see effect</span></span>
<span><span class="fu"><a href="../reference/plotMGDrivESingle.html">plotMGDrivESingle</a></span><span class="op">(</span>readDir <span class="op">=</span> <span class="va">outFolder</span>, totalPop <span class="op">=</span> <span class="cn">TRUE</span>, lwd <span class="op">=</span> <span class="fl">3.5</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="mgdrive_examples_files/figure-html/unnamed-chunk-8-1.png" alt="Example of a deterministic simulation under Mendelian inheritance, in a single node and without fitness costs." width="672"></p>
<p>In the figure, we see males and females of every genotype plotted by
time, along with the total population. With an equilibrium population
size of 500 individuals, and no sex biasing, we have an equal division
of males and females. The release occurs equally in both sexes at time t
= 25, as expected, and we see an increase in the total population due to
the release before recovering to the equilibrium population size.</p>
<p>Since this is basic Mendelian inheritance, we should be able to
calculate the expected allele and genotype frequencies assuming
Hardy-Weinberg equilibrium (HWE). As we released 20 <em>aa</em>
individuals into a population of 500 <em>AA</em> individuals, we can
calculate the expected allele frequencies:</p>
<ul>
<li>
<em>a</em>: <span class="math inline">\(\frac{1}{26}\)</span>
</li>
<li>
<em>A</em>: <span class="math inline">\(\frac{25}{26}\)</span>
</li>
</ul>
<p>This leads to the following expected genotype frequencies:</p>
<ul>
<li>
<em>AA</em>: <span class="math inline">\(\big(\frac{25}{26}\big)^2
=\)</span> 0.9246</li>
<li>
<em>Aa</em>: <span class="math inline">\(2\cdot
\big(\frac{25}{26}\big)\cdot\big(\frac{1}{26}\big) =\)</span>
0.0740</li>
<li>
<em>aa</em>: <span class="math inline">\(\big(\frac{1}{26}\big)^2
=\)</span> 0.0015</li>
</ul>
<p>Which, in a population of size 500, implies the following number of
individuals (remember, this is a deterministic simulation, so
“individuals” will not be whole numbers):</p>
<ul>
<li>
<em>AA</em>: 462.28</li>
<li>
<em>Aa</em>: 36.98</li>
<li>
<em>aa</em>: 0.74</li>
</ul>
<p>However, when we look at the equilibrium genotypes from the
simulation, the populations are:</p>
<ul>
<li>
<em>AA</em>: 485.47</li>
<li>
<em>Aa</em>: 14.42</li>
<li>
<em>aa</em>: 0.11</li>
</ul>
<p>These are significantly different from the expected genotype numbers
according to HWE. This is because of the assumptions in how HWE is
calculated, specifically, ignoring maturation of child stages prior to
reproduction by assuming discrete generations, and infinite population
size. In contrast, <em>MGDrivE</em> has overlapping generations and
tracks offspring development prior to adulthood. Additionally, while the
release performed here is small, the population is far from “infinite”,
and the release represents 4% of the population. Therefore, the
effective population size is significantly larger than 500. Ignoring the
effect of constant daily mortality on the distribution of adults,
implying individual lifespans follow a geometric distribution and
reducing the proportion of released individuals to wild-type as adults
die off, we can calculate the effective population size using the
following parameters;</p>
<ul>
<li>Adult Population Size: 500</li>
<li>Release Amount: 20</li>
<li>Daily Pupation Amount: 45</li>
<li>Maturation Time: 15 days</li>
</ul>
<p>From these parameters, an approximate effective population size is
calculated by combining the <em>Adult Population Size</em>, plus the
<em>Release Amount</em>, plus the <em>Maturation Time</em> times the
<em>Daily Pupation Amount</em>, which estimates a population size of
1195. Using this estimate of our effective population size, the expected
allele frequencies are:</p>
<ul>
<li>
<em>a</em>: <span class="math inline">\(\frac{4}{239}\)</span>
</li>
<li>
<em>A</em>: <span class="math inline">\(\frac{235}{239}\)</span>
</li>
</ul>
<p>Our new expected genotype frequencies:</p>
<ul>
<li>
<em>AA</em>: <span class="math inline">\(\big(\frac{235}{239}\big)^2
=\)</span> 0.96681</li>
<li>
<em>Aa</em>: <span class="math inline">\(2\cdot
\big(\frac{235}{239}\big)\cdot\big(\frac{4}{239}\big) =\)</span>
0.03291</li>
<li>
<em>aa</em>: <span class="math inline">\(\big(\frac{4}{239}\big)^2
=\)</span> 0.00028</li>
</ul>
<p>Since our population will return to equilibrium after some time, 500
individuals, we expect the following number of individuals of each
genotype:</p>
<ul>
<li>
<em>AA</em>: 483.40</li>
<li>
<em>Aa</em>: 16.46</li>
<li>
<em>aa</em>: 0.14</li>
</ul>
<p>This is significantly closer to the simulated population. As
expected, it is slightly high, which stems from ignoring the geometric
distribution of our adult population.</p>
</div>
<div class="section level4">
<h4 id="deterministic-with-fitness-cost">Deterministic, With Fitness Cost<a class="anchor" aria-label="anchor" href="#deterministic-with-fitness-cost"></a>
</h4>
<p>Now that we have shown a basic Mendelian simulation, we will expand
it a little by including a fitness cost on certain genotypes. In the
following simulation, the homozygotes, <em>AA</em> and <em>aa</em>, are
only 60% as fit as the heterozygote over their adult lifetime. This is
an example of a heterozygote advantage, and we should see the population
become primarily heterozygous. We will increase the size and number of
releases and perform them a little bit later, to see the effects of the
fitness cost and then speed up the equilibration process, but everything
else will remain the same, i.e., one population and a deterministic
simulation.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">####################</span></span>
<span><span class="co"># Load libraries</span></span>
<span><span class="co">####################</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://marshalllab.github.io/MGDrivE/" class="external-link">MGDrivE</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Output Folder</span></span>
<span><span class="co">####################</span></span>
<span><span class="va">outFolder</span> <span class="op">&lt;-</span> <span class="st">"mgdrive"</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Simulation Parameters</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># days to run the simulation</span></span>
<span><span class="va">tMax</span> <span class="op">&lt;-</span> <span class="fl">365</span><span class="op">*</span><span class="fl">2</span></span>
<span></span>
<span><span class="co"># entomological parameters</span></span>
<span><span class="va">bioParameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>betaK<span class="op">=</span><span class="fl">20</span>, tEgg<span class="op">=</span><span class="fl">5</span>, tLarva<span class="op">=</span><span class="fl">6</span>, tPupa<span class="op">=</span><span class="fl">4</span>, popGrowth<span class="op">=</span><span class="fl">1.175</span>, muAd<span class="op">=</span><span class="fl">0.09</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># a 1-node network where mosquitoes do not leave</span></span>
<span><span class="va">moveMat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># parameters of the population equilibrium</span></span>
<span><span class="va">adultPopEquilibrium</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">sitesNumber</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">moveMat</span><span class="op">)</span></span>
<span><span class="va">patchPops</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">adultPopEquilibrium</span>,<span class="va">sitesNumber</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Basic Inheritance pattern</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Mendelian cube with standard (default) parameters</span></span>
<span></span>
<span><span class="co"># This time, lets put fitness cost on the homozygotes, giving the heterozygote</span></span>
<span><span class="co">#  an advantage</span></span>
<span></span>
<span><span class="co"># These genotypes correspond to ones in the cube. Look at a base cube first,</span></span>
<span><span class="co">#  then set this.</span></span>
<span><span class="co"># homozygotes are 60% as fit as heterozygote over their entire lifetime</span></span>
<span><span class="co">#  Since omega is the adult daily death rate, we use the built-in function to</span></span>
<span><span class="co">#  calculate our desired lifetime cost as applied daily</span></span>
<span><span class="va">dayOmega</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calcOmega.html">calcOmega</a></span><span class="op">(</span>mu <span class="op">=</span> <span class="va">bioParameters</span><span class="op">$</span><span class="va">muAd</span>, lifespanReduction <span class="op">=</span> <span class="fl">0.60</span><span class="op">)</span></span>
<span><span class="va">omegaNew</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AA"</span><span class="op">=</span><span class="va">dayOmega</span>, <span class="st">"aa"</span><span class="op">=</span><span class="va">dayOmega</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># setup cube</span></span>
<span><span class="va">cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cubeMendelian.html">cubeMendelian</a></span><span class="op">(</span>omega <span class="op">=</span> <span class="va">omegaNew</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Setup releases and batch migration</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># set up the empty release vector</span></span>
<span><span class="co">#  MGDrivE pulls things out by name</span></span>
<span><span class="va">patchReleases</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span>n<span class="op">=</span><span class="va">sitesNumber</span>,</span>
<span>                           expr<span class="op">=</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maleReleases<span class="op">=</span><span class="cn">NULL</span>,femaleReleases<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>                                      eggReleases<span class="op">=</span><span class="cn">NULL</span>,matedFemaleReleases<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span><span class="op">}</span>,</span>
<span>                           simplify<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># choose release parameters</span></span>
<span><span class="co">#  Releases start at time 100, occur every day, for 5 days.</span></span>
<span><span class="co">#  There are 50 mosquitoes released every time.</span></span>
<span><span class="va">releasesParameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>releasesStart<span class="op">=</span><span class="fl">100</span>,</span>
<span>                           releasesNumber<span class="op">=</span><span class="fl">5</span>,</span>
<span>                           releasesInterval<span class="op">=</span><span class="fl">0</span>,</span>
<span>                           releaseProportion<span class="op">=</span><span class="fl">50</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate male release vector</span></span>
<span><span class="va">maleReleasesVector</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateReleaseVector.html">generateReleaseVector</a></span><span class="op">(</span>driveCube<span class="op">=</span><span class="va">cube</span>,</span>
<span>                                            releasesParameters<span class="op">=</span><span class="va">releasesParameters</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate female release vector</span></span>
<span><span class="va">femaleReleasesVector</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateReleaseVector.html">generateReleaseVector</a></span><span class="op">(</span>driveCube<span class="op">=</span><span class="va">cube</span>,</span>
<span>                                              releasesParameters<span class="op">=</span><span class="va">releasesParameters</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># put releases into the proper place in the release list</span></span>
<span><span class="va">patchReleases</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">maleReleases</span> <span class="op">&lt;-</span> <span class="va">maleReleasesVector</span></span>
<span><span class="va">patchReleases</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">femaleReleases</span> <span class="op">&lt;-</span> <span class="va">femaleReleasesVector</span></span>
<span></span>
<span></span>
<span><span class="co"># batch migration is disabled by setting the probability to 0</span></span>
<span><span class="co"># This is required because of the stochastic simulations, but doesn't make sense</span></span>
<span><span class="co">#  in a deterministic simulation.</span></span>
<span><span class="va">batchMigration</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basicBatchMigration.html">basicBatchMigration</a></span><span class="op">(</span>batchProbs<span class="op">=</span><span class="fl">0</span>,</span>
<span>                                      sexProbs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.5</span>,<span class="fl">.5</span><span class="op">)</span>,</span>
<span>                                      numPatches<span class="op">=</span><span class="va">sitesNumber</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Combine parameters and run!</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># set MGDrivE to run deterministic</span></span>
<span><span class="fu"><a href="../reference/setupMGDrivE.html">setupMGDrivE</a></span><span class="op">(</span>stochasticityON <span class="op">=</span> <span class="cn">FALSE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># setup parameters for the network. This builds a list of parameters required for</span></span>
<span><span class="co">#  every population in the network. In ths case, we have a network of 1 population.</span></span>
<span><span class="va">netPar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/parameterizeMGDrivE.html">parameterizeMGDrivE</a></span><span class="op">(</span>runID<span class="op">=</span><span class="fl">1</span>, simTime<span class="op">=</span><span class="va">tMax</span>, nPatch<span class="op">=</span><span class="va">sitesNumber</span>,</span>
<span>                              beta<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">betaK</span>, muAd<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">muAd</span>,</span>
<span>                              popGrowth<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">popGrowth</span>, tEgg<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">tEgg</span>,</span>
<span>                              tLarva<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">tLarva</span>, tPupa<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">tPupa</span>,</span>
<span>                              AdPopEQ<span class="op">=</span><span class="va">patchPops</span>, inheritanceCube <span class="op">=</span> <span class="va">cube</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># build network prior to run</span></span>
<span><span class="va">MGDrivESim</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Network.html">Network</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>params<span class="op">=</span><span class="va">netPar</span>,</span>
<span>                          driveCube<span class="op">=</span><span class="va">cube</span>,</span>
<span>                          patchReleases<span class="op">=</span><span class="va">patchReleases</span>,</span>
<span>                          migrationMale<span class="op">=</span><span class="va">moveMat</span>,</span>
<span>                          migrationFemale<span class="op">=</span><span class="va">moveMat</span>,</span>
<span>                          migrationBatch<span class="op">=</span><span class="va">batchMigration</span>,</span>
<span>                          directory<span class="op">=</span><span class="va">outFolder</span>,</span>
<span>                          verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># run simulation</span></span>
<span><span class="va">MGDrivESim</span><span class="op">$</span><span class="fu">oneRun</span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Post Analysis</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># split output by patch</span></span>
<span><span class="co">#  Required for plotting later</span></span>
<span><span class="fu"><a href="../reference/splitOutput.html">splitOutput</a></span><span class="op">(</span>readDir <span class="op">=</span> <span class="va">outFolder</span>, remFile <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># aggregate females by their mate choice</span></span>
<span><span class="co">#  This reduces the female file to have the same columns as the male file</span></span>
<span><span class="fu"><a href="../reference/aggregateFemales.html">aggregateFemales</a></span><span class="op">(</span>readDir <span class="op">=</span> <span class="va">outFolder</span>, genotypes <span class="op">=</span> <span class="va">cube</span><span class="op">$</span><span class="va">genotypesID</span>, remFile <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                 verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot output to see effect</span></span>
<span><span class="fu"><a href="../reference/plotMGDrivESingle.html">plotMGDrivESingle</a></span><span class="op">(</span>readDir <span class="op">=</span> <span class="va">outFolder</span>, totalPop <span class="op">=</span> <span class="cn">TRUE</span>, lwd <span class="op">=</span> <span class="fl">3.5</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="mgdrive_examples_files/figure-html/unnamed-chunk-11-1.png" alt="Example of a deterministic simulation under Mendelian inheritance, in a single node, with fitness costs." width="672"></p>
<p>Again, we plot the females on the left, the males on the right, with
the population size on the Y-axis and simulation time along the X-axis.
We see the total population size starts at 250 males and females, a
total of 500 individuals, but quickly drops to 275.1667639. This is
because of the fitness cost applied to the <em>AA</em> individuals that
make up the population. As we applied an 60% fitness cost, we expect the
total population to be 60% of the desired population. 60% of 500
individuals, assuming HWE applies, is 300, which is close to the
simulated population size prior to the releases. This discrepancy can be
accounted for by the presence of density-dependence during larval
maturation.</p>
<p>After releases of <em>aa</em> individuals are performed, we see the
population quickly drive towards heterozygous individuals, and the
population size marginally recover. The population partially recovers
because there is no fitness cost on the heterozygotes, but does not
fully recover because heterozygotes create homozygotes at each
generation. At equilibrium, given that heterozygotes produce homozygotes
at a rate of 50% per generation, our expected genotype amounts (assuming
all HWE assumptions apply) are:</p>
<ul>
<li>
<em>AA</em>: <span class="math inline">\(500 \cdot \frac{1}{4} \cdot
0.60 = 75\)</span>
</li>
<li>
<em>Aa</em>: <span class="math inline">\(500 \cdot \frac{1}{2} \cdot
1.00 = 250\)</span>
</li>
<li>
<em>aa</em>: <span class="math inline">\(500 \cdot \frac{1}{4} \cdot
0.60 = 75\)</span>
</li>
<li>Total: <em>AA</em> + <em>Aa</em> + <em>aa</em> = 400</li>
</ul>
<p>Checking at the end of our simulation, we find that the empirical
genotype amounts are:</p>
<ul>
<li>
<em>AA</em>: 72.59</li>
<li>
<em>Aa</em>: 241.03</li>
<li>
<em>aa</em>: 72.03</li>
<li>Total: 385.65</li>
</ul>
<p>This closely matches our simulated population, differing because HWE
assumes discrete generations.</p>
</div>
<div class="section level4">
<h4 id="stochastic">Stochastic<a class="anchor" aria-label="anchor" href="#stochastic"></a>
</h4>
<p>The processes of birth, death, mating, and inheritance are inherently
probabilistic, meaning that in order to understand the full spectrum of
outcomes a model may produce, it is necessary to simulate from
correctly-specified stochastic models. We show an example of the same
modeled system here when the stochastic simulation is used; we run an
ensemble of simulations, then plot the trajectories to give a sense of
the expected variability in possible model trajectories.</p>
<p>We now use the same simulation parameters as the previous example but
run the stochastic version of the model. To view variability in sampled
trajectories, we run 50 repetitions. For realistic applications, large
ensembles of simulations (&gt;100) should be run and statistically
analyzed to characterize quantities of interest.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">####################</span></span>
<span><span class="co"># Load libraries</span></span>
<span><span class="co">####################</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://marshalllab.github.io/MGDrivE/" class="external-link">MGDrivE</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Output Folder</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># directory</span></span>
<span><span class="co"># This is slightly obtuse for vignette building reasons</span></span>
<span><span class="co">#  Really, all you need is a base directory, then the repetitions in folders inside that.</span></span>
<span><span class="co">#  Here, our base directory is "mgdrive", and the repetition folders are "001","002", etc.</span></span>
<span><span class="co">#  So, the final structure is "mgdrive/001","mgdrive/002", etc.</span></span>
<span><span class="va">outFolder</span> <span class="op">&lt;-</span> <span class="st">"mgdrive"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">outFolder</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Simulation Parameters</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># days to run the simulation</span></span>
<span><span class="va">tMax</span> <span class="op">&lt;-</span> <span class="fl">365</span><span class="op">*</span><span class="fl">2</span></span>
<span></span>
<span><span class="co"># number of Monte Carlo iterations</span></span>
<span><span class="va">nRep</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span></span>
<span><span class="co"># each Monte Carlo iteration gets its own folder</span></span>
<span><span class="va">folderNames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">outFolder</span>,</span>
<span>                         <span class="fu"><a href="https://rdrr.io/r/base/formatc.html" class="external-link">formatC</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">nRep</span>, width <span class="op">=</span> <span class="fl">3</span>, format <span class="op">=</span> <span class="st">"d"</span>, flag <span class="op">=</span> <span class="st">"0"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># entomological parameters</span></span>
<span><span class="va">bioParameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>betaK<span class="op">=</span><span class="fl">20</span>, tEgg<span class="op">=</span><span class="fl">5</span>, tLarva<span class="op">=</span><span class="fl">6</span>, tPupa<span class="op">=</span><span class="fl">4</span>, popGrowth<span class="op">=</span><span class="fl">1.175</span>, muAd<span class="op">=</span><span class="fl">0.09</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># a 1-node network where mosquitoes do not leave</span></span>
<span><span class="va">moveMat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># parameters of the population equilibrium</span></span>
<span><span class="va">adultPopEquilibrium</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">sitesNumber</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">moveMat</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Basic Inheritance pattern</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Mendelian cube with standard (default) parameters</span></span>
<span></span>
<span><span class="co"># This time, lets put fitness cost on the homozygotes, giving the heterozygote</span></span>
<span><span class="co">#  an advantage</span></span>
<span></span>
<span><span class="co"># These genotypes correspond to ones in the cube. Look at a base cube first,</span></span>
<span><span class="co">#  then set this.</span></span>
<span><span class="co"># homozygotes are 60% as fit as heterozygote over their entire lifetime</span></span>
<span><span class="co">#  Since omega is the adult daily death rate, we use the built-in function to</span></span>
<span><span class="co">#  calculate our desired lifetime cost as applied daily</span></span>
<span><span class="va">dayOmega</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calcOmega.html">calcOmega</a></span><span class="op">(</span>mu <span class="op">=</span> <span class="va">bioParameters</span><span class="op">$</span><span class="va">muAd</span>, lifespanReduction <span class="op">=</span> <span class="fl">0.60</span><span class="op">)</span></span>
<span><span class="va">omegaNew</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AA"</span><span class="op">=</span><span class="va">dayOmega</span>, <span class="st">"aa"</span><span class="op">=</span><span class="va">dayOmega</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># setup cube</span></span>
<span><span class="va">cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cubeMendelian.html">cubeMendelian</a></span><span class="op">(</span>omega <span class="op">=</span> <span class="va">omegaNew</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Setup releases and batch migration</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># set up the empty release vector</span></span>
<span><span class="co">#  MGDrivE pulls things out by name</span></span>
<span><span class="va">patchReleases</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span>n<span class="op">=</span><span class="va">sitesNumber</span>,</span>
<span>                           expr<span class="op">=</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maleReleases<span class="op">=</span><span class="cn">NULL</span>,femaleReleases<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>                                      eggReleases<span class="op">=</span><span class="cn">NULL</span>,matedFemaleReleases<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span><span class="op">}</span>,</span>
<span>                           simplify<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># choose release parameters</span></span>
<span><span class="co">#  Releases start at time 100, occur every day, for 5 days.</span></span>
<span><span class="co">#  There are 50 mosquitoes released every time.</span></span>
<span><span class="va">releasesParameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>releasesStart<span class="op">=</span><span class="fl">100</span>,</span>
<span>                           releasesNumber<span class="op">=</span><span class="fl">5</span>,</span>
<span>                           releasesInterval<span class="op">=</span><span class="fl">0</span>,</span>
<span>                           releaseProportion<span class="op">=</span><span class="fl">50</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate male release vector</span></span>
<span><span class="va">maleReleasesVector</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateReleaseVector.html">generateReleaseVector</a></span><span class="op">(</span>driveCube<span class="op">=</span><span class="va">cube</span>,</span>
<span>                                            releasesParameters<span class="op">=</span><span class="va">releasesParameters</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate female release vector</span></span>
<span><span class="va">femaleReleasesVector</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateReleaseVector.html">generateReleaseVector</a></span><span class="op">(</span>driveCube<span class="op">=</span><span class="va">cube</span>,</span>
<span>                                              releasesParameters<span class="op">=</span><span class="va">releasesParameters</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># put releases into the proper place in the release list</span></span>
<span><span class="va">patchReleases</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">maleReleases</span> <span class="op">&lt;-</span> <span class="va">maleReleasesVector</span></span>
<span><span class="va">patchReleases</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">femaleReleases</span> <span class="op">&lt;-</span> <span class="va">femaleReleasesVector</span></span>
<span></span>
<span></span>
<span><span class="co"># batch migration is disabled by setting the probability to 0</span></span>
<span><span class="co"># This is required because of the stochastic simulations, but doesn't make sense</span></span>
<span><span class="co">#  in a deterministic simulation.</span></span>
<span><span class="va">batchMigration</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basicBatchMigration.html">basicBatchMigration</a></span><span class="op">(</span>batchProbs<span class="op">=</span><span class="fl">0</span>,</span>
<span>                                      sexProbs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.5</span>,<span class="fl">.5</span><span class="op">)</span>,</span>
<span>                                      numPatches<span class="op">=</span><span class="va">sitesNumber</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Combine parameters and run!</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># set MGDrivE to run stochastic</span></span>
<span><span class="fu"><a href="../reference/setupMGDrivE.html">setupMGDrivE</a></span><span class="op">(</span>stochasticityON <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># setup parameters for the network. This builds a list of parameters required for</span></span>
<span><span class="co">#  every population in the network. In ths case, we have a network of 1 population.</span></span>
<span><span class="va">netPar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/parameterizeMGDrivE.html">parameterizeMGDrivE</a></span><span class="op">(</span>runID<span class="op">=</span><span class="fl">1</span>, simTime<span class="op">=</span><span class="va">tMax</span>, sampTime <span class="op">=</span> <span class="fl">5</span>, nPatch<span class="op">=</span><span class="va">sitesNumber</span>,</span>
<span>                              beta<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">betaK</span>, muAd<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">muAd</span>,</span>
<span>                              popGrowth<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">popGrowth</span>, tEgg<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">tEgg</span>,</span>
<span>                              tLarva<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">tLarva</span>, tPupa<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">tPupa</span>,</span>
<span>                              AdPopEQ<span class="op">=</span><span class="va">adultPopEquilibrium</span>, inheritanceCube <span class="op">=</span> <span class="va">cube</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># build network prior to run</span></span>
<span><span class="va">MGDrivESim</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Network.html">Network</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>params<span class="op">=</span><span class="va">netPar</span>,</span>
<span>                          driveCube<span class="op">=</span><span class="va">cube</span>,</span>
<span>                          patchReleases<span class="op">=</span><span class="va">patchReleases</span>,</span>
<span>                          migrationMale<span class="op">=</span><span class="va">moveMat</span>,</span>
<span>                          migrationFemale<span class="op">=</span><span class="va">moveMat</span>,</span>
<span>                          migrationBatch<span class="op">=</span><span class="va">batchMigration</span>,</span>
<span>                          directory<span class="op">=</span><span class="va">folderNames</span>,</span>
<span>                          verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># run simulation</span></span>
<span><span class="va">MGDrivESim</span><span class="op">$</span><span class="fu">multRun</span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Post Analysis</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># First, split output by patch</span></span>
<span><span class="co"># Second, aggregate females by their mate choice</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nRep</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/splitOutput.html">splitOutput</a></span><span class="op">(</span>readDir <span class="op">=</span> <span class="va">folderNames</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, remFile <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/aggregateFemales.html">aggregateFemales</a></span><span class="op">(</span>readDir <span class="op">=</span> <span class="va">folderNames</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, genotypes <span class="op">=</span> <span class="va">cube</span><span class="op">$</span><span class="va">genotypesID</span>,</span>
<span>                   remFile <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># plot output of first run to see effect</span></span>
<span><span class="fu"><a href="../reference/plotMGDrivESingle.html">plotMGDrivESingle</a></span><span class="op">(</span>readDir <span class="op">=</span> <span class="va">folderNames</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, totalPop <span class="op">=</span> <span class="cn">TRUE</span>, lwd <span class="op">=</span> <span class="fl">3.5</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="mgdrive_examples_files/figure-html/unnamed-chunk-14-1.png" alt="Example of a single, stochastic simulation under Mendelian inheritance, in a single node, with fitness costs." width="672"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># plot all 50 repetitions together</span></span>
<span><span class="fu"><a href="../reference/plotMGDrivEMult.html">plotMGDrivEMult</a></span><span class="op">(</span>readDir <span class="op">=</span> <span class="va">outFolder</span>, lwd <span class="op">=</span> <span class="fl">0.35</span>, alpha <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span></span></code></pre></div>
<p><img src="mgdrive_examples_files/figure-html/unnamed-chunk-14-2.png" alt="Example of 50 repetitions from a stochastic simulation under MEndelian inheritance, in a single node with fitness costs." width="672"></p>
<p>We first plot a single run of our stochastic simulation, and then
plot all 50 runs together. We see that the individual run looks similar
to the deterministic run from before, all genotypes behaving
heuristically the same. However, the dynamics are not as “clean” as the
deterministic version, clearly suffering from the randomness inherent in
an actual population, and the dynamics are slower than the deterministic
version. This is an inherent effect of stochasticity, something that is
important in decision making and with smaller population sizes.</p>
</div>
</div>
<div class="section level3">
<h3 id="mendelian-inheritance-simulations-two-populations">Mendelian Inheritance Simulations, Two Populations<a class="anchor" aria-label="anchor" href="#mendelian-inheritance-simulations-two-populations"></a>
</h3>
<p>Single, panmictic populations are simple to analyze but rarely
encountered in nature. Often, populations of identical individuals are
separated by geography, be it great distances or a road that is
difficult to cross. This creates structures within populations that can
drastically alter how genes spread. Here, we explore how the results of
our first simulation change when we have a structured population where
two halves of the population never mix.</p>
<p><em>MGDrivE</em> handles population structure by considering
separate, panmictic populations with some migration rate between them.
This makes <em>MGDrivE</em> a meta-population model, where individual
populations are part of the same graph, connected via some migration or
mixture rate. In the following simulation, we use two nodes, or two
well-mixed populations, that have no migration between them. Then, we
simulate releases in one population, and analyze what happens.</p>
<div class="section level4">
<h4 id="deterministic-no-migration">Deterministic, No Migration<a class="anchor" aria-label="anchor" href="#deterministic-no-migration"></a>
</h4>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">####################</span></span>
<span><span class="co"># Load libraries</span></span>
<span><span class="co">####################</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://marshalllab.github.io/MGDrivE/" class="external-link">MGDrivE</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Output Folder</span></span>
<span><span class="co">####################</span></span>
<span><span class="va">outFolder</span> <span class="op">&lt;-</span> <span class="st">"mgdrive"</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Simulation Parameters</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># days to run the simulation</span></span>
<span><span class="va">tMax</span> <span class="op">&lt;-</span> <span class="fl">365</span></span>
<span></span>
<span><span class="co"># entomological parameters</span></span>
<span><span class="va">bioParameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>betaK<span class="op">=</span><span class="fl">20</span>, tEgg<span class="op">=</span><span class="fl">5</span>, tLarva<span class="op">=</span><span class="fl">6</span>, tPupa<span class="op">=</span><span class="fl">4</span>, popGrowth<span class="op">=</span><span class="fl">1.175</span>, muAd<span class="op">=</span><span class="fl">0.09</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># a 2-node network where mosquitoes do not leave</span></span>
<span><span class="va">moveMat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">moveMat</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]    1    0</span></span>
<span><span class="co">#&gt; [2,]    0    1</span></span>
<span></span>
<span><span class="co"># parameters of the population equilibrium</span></span>
<span><span class="va">adultPopEquilibrium</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">sitesNumber</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">moveMat</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Basic Inheritance pattern</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Mendelian cube with standard (default) parameters</span></span>
<span><span class="va">cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cubeMendelian.html">cubeMendelian</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Setup releases and batch migration</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># set up the empty release vector</span></span>
<span><span class="co">#  MGDrivE pulls things out by name</span></span>
<span><span class="va">patchReleases</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span>n<span class="op">=</span><span class="va">sitesNumber</span>,</span>
<span>                           expr<span class="op">=</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maleReleases<span class="op">=</span><span class="cn">NULL</span>,femaleReleases<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>                                      eggReleases<span class="op">=</span><span class="cn">NULL</span>,matedFemaleReleases<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span><span class="op">}</span>,</span>
<span>                           simplify<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># choose release parameters</span></span>
<span><span class="co">#  Releases start at time 25, occur every day, for 5 days.</span></span>
<span><span class="co">#  There are 50 mosquitoes released every time.</span></span>
<span><span class="va">releasesParameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>releasesStart<span class="op">=</span><span class="fl">25</span>,</span>
<span>                           releasesNumber<span class="op">=</span><span class="fl">5</span>,</span>
<span>                           releasesInterval<span class="op">=</span><span class="fl">0</span>,</span>
<span>                           releaseProportion<span class="op">=</span><span class="fl">50</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate release vector</span></span>
<span><span class="va">releasesVector</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateReleaseVector.html">generateReleaseVector</a></span><span class="op">(</span>driveCube<span class="op">=</span><span class="va">cube</span>,</span>
<span>                                        releasesParameters<span class="op">=</span><span class="va">releasesParameters</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># put releases into the proper place in the release list</span></span>
<span><span class="va">patchReleases</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">maleReleases</span> <span class="op">&lt;-</span> <span class="va">releasesVector</span></span>
<span><span class="va">patchReleases</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">femaleReleases</span> <span class="op">&lt;-</span> <span class="va">releasesVector</span></span>
<span></span>
<span><span class="co"># batch migration is disabled by setting the probability to 0</span></span>
<span><span class="co"># This is required because of the stochastic simulations, but doesn't make sense</span></span>
<span><span class="co">#  in a deterministic simulation.</span></span>
<span><span class="va">batchMigration</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basicBatchMigration.html">basicBatchMigration</a></span><span class="op">(</span>batchProbs<span class="op">=</span><span class="fl">0</span>,</span>
<span>                                      sexProbs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.5</span>,<span class="fl">.5</span><span class="op">)</span>,</span>
<span>                                      numPatches<span class="op">=</span><span class="va">sitesNumber</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Combine parameters and run!</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># set MGDrivE to run deterministic</span></span>
<span><span class="fu"><a href="../reference/setupMGDrivE.html">setupMGDrivE</a></span><span class="op">(</span>stochasticityON <span class="op">=</span> <span class="cn">FALSE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># setup parameters for the network. This builds a list of parameters required for</span></span>
<span><span class="co">#  every population in the network. In ths case, we have a network of 2 populations.</span></span>
<span><span class="va">netPar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/parameterizeMGDrivE.html">parameterizeMGDrivE</a></span><span class="op">(</span>runID<span class="op">=</span><span class="fl">1</span>, simTime<span class="op">=</span><span class="va">tMax</span>, nPatch<span class="op">=</span><span class="va">sitesNumber</span>,</span>
<span>                              beta<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">betaK</span>, muAd<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">muAd</span>,</span>
<span>                              popGrowth<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">popGrowth</span>, tEgg<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">tEgg</span>,</span>
<span>                              tLarva<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">tLarva</span>, tPupa<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">tPupa</span>,</span>
<span>                              AdPopEQ<span class="op">=</span><span class="va">adultPopEquilibrium</span>, inheritanceCube <span class="op">=</span> <span class="va">cube</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># build network prior to run</span></span>
<span><span class="va">MGDrivESim</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Network.html">Network</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>params<span class="op">=</span><span class="va">netPar</span>,</span>
<span>                          driveCube<span class="op">=</span><span class="va">cube</span>,</span>
<span>                          patchReleases<span class="op">=</span><span class="va">patchReleases</span>,</span>
<span>                          migrationMale<span class="op">=</span><span class="va">moveMat</span>,</span>
<span>                          migrationFemale<span class="op">=</span><span class="va">moveMat</span>,</span>
<span>                          migrationBatch<span class="op">=</span><span class="va">batchMigration</span>,</span>
<span>                          directory<span class="op">=</span><span class="va">outFolder</span>,</span>
<span>                          verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># run simulation</span></span>
<span><span class="va">MGDrivESim</span><span class="op">$</span><span class="fu">oneRun</span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Post Analysis</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># split output by patch</span></span>
<span><span class="co">#  Required for plotting later</span></span>
<span><span class="fu"><a href="../reference/splitOutput.html">splitOutput</a></span><span class="op">(</span>readDir <span class="op">=</span> <span class="va">outFolder</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span>, remFile <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># aggregate females by their mate choice</span></span>
<span><span class="co">#  This reduces the female file to have the same columns as the male file</span></span>
<span><span class="fu"><a href="../reference/aggregateFemales.html">aggregateFemales</a></span><span class="op">(</span>readDir <span class="op">=</span> <span class="va">outFolder</span>, genotypes <span class="op">=</span> <span class="va">cube</span><span class="op">$</span><span class="va">genotypesID</span>,</span>
<span>                 remFile <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot output to see effect</span></span>
<span><span class="fu"><a href="../reference/plotMGDrivESingle.html">plotMGDrivESingle</a></span><span class="op">(</span>readDir <span class="op">=</span> <span class="va">outFolder</span>, lwd <span class="op">=</span> <span class="fl">3.5</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="mgdrive_examples_files/figure-html/unnamed-chunk-16-1.png" alt="An example of a two-node, deterministic simulation where each node is completely independent." width="672"></p>
<p>The plots are now expanded to include both populations in our
simulation, as labeled on the right side of the plot. We performed 5
releases of 50 <em>aa</em> individuals in the first node. However, since
there is no migration between the populations, we see <em>Aa</em>
individuals appear in patch 1 only, while patch 2 remains completely
<em>AA</em>.</p>
</div>
<div class="section level4">
<h4 id="deterministic-small-migration">Deterministic, Small Migration<a class="anchor" aria-label="anchor" href="#deterministic-small-migration"></a>
</h4>
<p>Now, if we increase the migration to 1% per day between the
populations, we should see heterozygous individuals appear in patch 2,
even though we only perform releases in patch 1. (We repeat the entire
code for users’ benefit.)</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">####################</span></span>
<span><span class="co"># Load libraries</span></span>
<span><span class="co">####################</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://marshalllab.github.io/MGDrivE/" class="external-link">MGDrivE</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Output Folder</span></span>
<span><span class="co">####################</span></span>
<span><span class="va">outFolder</span> <span class="op">&lt;-</span> <span class="st">"mgdrive"</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Simulation Parameters</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># days to run the simulation</span></span>
<span><span class="va">tMax</span> <span class="op">&lt;-</span> <span class="fl">365</span></span>
<span></span>
<span><span class="co"># entomological parameters</span></span>
<span><span class="va">bioParameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>betaK<span class="op">=</span><span class="fl">20</span>, tEgg<span class="op">=</span><span class="fl">5</span>, tLarva<span class="op">=</span><span class="fl">6</span>, tPupa<span class="op">=</span><span class="fl">4</span>, popGrowth<span class="op">=</span><span class="fl">1.175</span>, muAd<span class="op">=</span><span class="fl">0.09</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># a 2-node network with 1% per day migration rate</span></span>
<span><span class="va">moveMat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.99</span>,<span class="fl">0.01</span>,<span class="fl">0.01</span>,<span class="fl">0.99</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">moveMat</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,] 0.99 0.01</span></span>
<span><span class="co">#&gt; [2,] 0.01 0.99</span></span>
<span></span>
<span><span class="co"># parameters of the population equilibrium</span></span>
<span><span class="va">adultPopEquilibrium</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">sitesNumber</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">moveMat</span><span class="op">)</span></span>
<span><span class="va">patchPops</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">adultPopEquilibrium</span>,<span class="va">sitesNumber</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Basic Inheritance pattern</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Mendelian cube with standard (default) parameters</span></span>
<span><span class="va">cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cubeMendelian.html">cubeMendelian</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Setup releases and batch migration</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># set up the empty release vector</span></span>
<span><span class="co">#  MGDrivE pulls things out by name</span></span>
<span><span class="va">patchReleases</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span>n<span class="op">=</span><span class="va">sitesNumber</span>,</span>
<span>                           expr<span class="op">=</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maleReleases<span class="op">=</span><span class="cn">NULL</span>,femaleReleases<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>                                      eggReleases<span class="op">=</span><span class="cn">NULL</span>,matedFemaleReleases<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span><span class="op">}</span>,</span>
<span>                           simplify<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># choose release parameters</span></span>
<span><span class="co">#  Releases start at time 25, occur every day, for 5 days.</span></span>
<span><span class="co">#  There are 50 mosquitoes released every time.</span></span>
<span><span class="va">releasesParameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>releasesStart<span class="op">=</span><span class="fl">25</span>,</span>
<span>                           releasesNumber<span class="op">=</span><span class="fl">5</span>,</span>
<span>                           releasesInterval<span class="op">=</span><span class="fl">0</span>,</span>
<span>                           releaseProportion<span class="op">=</span><span class="fl">50</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate male release vector</span></span>
<span><span class="va">maleReleasesVector</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateReleaseVector.html">generateReleaseVector</a></span><span class="op">(</span>driveCube<span class="op">=</span><span class="va">cube</span>,</span>
<span>                                            releasesParameters<span class="op">=</span><span class="va">releasesParameters</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate female release vector</span></span>
<span><span class="va">femaleReleasesVector</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateReleaseVector.html">generateReleaseVector</a></span><span class="op">(</span>driveCube<span class="op">=</span><span class="va">cube</span>,</span>
<span>                                              releasesParameters<span class="op">=</span><span class="va">releasesParameters</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># put releases into the proper place in the release list</span></span>
<span><span class="va">patchReleases</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">maleReleases</span> <span class="op">&lt;-</span> <span class="va">maleReleasesVector</span></span>
<span><span class="va">patchReleases</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">femaleReleases</span> <span class="op">&lt;-</span> <span class="va">femaleReleasesVector</span></span>
<span></span>
<span><span class="co"># batch migration is disabled by setting the probability to 0</span></span>
<span><span class="co"># This is required because of the stochastic simulations, but doesn't make sense</span></span>
<span><span class="co">#  in a deterministic simulation.</span></span>
<span><span class="va">batchMigration</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basicBatchMigration.html">basicBatchMigration</a></span><span class="op">(</span>batchProbs<span class="op">=</span><span class="fl">0</span>,</span>
<span>                                     sexProbs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.5</span>,<span class="fl">.5</span><span class="op">)</span>,</span>
<span>                                     numPatches<span class="op">=</span><span class="va">sitesNumber</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Combine parameters and run!</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># set MGDrivE to run deterministic</span></span>
<span><span class="fu"><a href="../reference/setupMGDrivE.html">setupMGDrivE</a></span><span class="op">(</span>stochasticityON <span class="op">=</span> <span class="cn">FALSE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># setup parameters for the network. This builds a list of parameters required for</span></span>
<span><span class="co">#  every population in the network. In ths case, we have a network of 2 populations.</span></span>
<span><span class="va">netPar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/parameterizeMGDrivE.html">parameterizeMGDrivE</a></span><span class="op">(</span>runID<span class="op">=</span><span class="fl">1</span>, simTime<span class="op">=</span><span class="va">tMax</span>, nPatch<span class="op">=</span><span class="va">sitesNumber</span>,</span>
<span>                             beta<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">betaK</span>, muAd<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">muAd</span>,</span>
<span>                             popGrowth<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">popGrowth</span>, tEgg<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">tEgg</span>,</span>
<span>                             tLarva<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">tLarva</span>, tPupa<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">tPupa</span>,</span>
<span>                             AdPopEQ<span class="op">=</span><span class="va">patchPops</span>, inheritanceCube <span class="op">=</span> <span class="va">cube</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># build network prior to run</span></span>
<span><span class="va">MGDrivESim</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Network.html">Network</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>params<span class="op">=</span><span class="va">netPar</span>,</span>
<span>                         driveCube<span class="op">=</span><span class="va">cube</span>,</span>
<span>                         patchReleases<span class="op">=</span><span class="va">patchReleases</span>,</span>
<span>                         migrationMale<span class="op">=</span><span class="va">moveMat</span>,</span>
<span>                         migrationFemale<span class="op">=</span><span class="va">moveMat</span>,</span>
<span>                         migrationBatch<span class="op">=</span><span class="va">batchMigration</span>,</span>
<span>                         directory<span class="op">=</span><span class="va">outFolder</span>,</span>
<span>                         verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># run simulation</span></span>
<span><span class="va">MGDrivESim</span><span class="op">$</span><span class="fu">oneRun</span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Post Analysis</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># split output by patch</span></span>
<span><span class="co">#  Required for plotting later</span></span>
<span><span class="fu"><a href="../reference/splitOutput.html">splitOutput</a></span><span class="op">(</span>readDir <span class="op">=</span> <span class="va">outFolder</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span>, remFile <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># aggregate females by their mate choice</span></span>
<span><span class="co">#  This reduces the female file to have the same columns as the male file</span></span>
<span><span class="fu"><a href="../reference/aggregateFemales.html">aggregateFemales</a></span><span class="op">(</span>readDir <span class="op">=</span> <span class="va">outFolder</span>, genotypes <span class="op">=</span> <span class="va">cube</span><span class="op">$</span><span class="va">genotypesID</span>,</span>
<span>                remFile <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot output to see effect</span></span>
<span><span class="fu"><a href="../reference/plotMGDrivESingle.html">plotMGDrivESingle</a></span><span class="op">(</span>readDir <span class="op">=</span> <span class="va">outFolder</span>, totalPop <span class="op">=</span> <span class="cn">TRUE</span>, lwd <span class="op">=</span> <span class="fl">3.5</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="mgdrive_examples_files/figure-html/unnamed-chunk-18-1.png" alt="An example of a two-node, deterministic simulation where each node is connected by a 1% daily migration rate." width="672"></p>
<p>As expected, with a 1% daily migration rate, we see heterozygotes in
patch 2 shortly after they begin emerging in patch 1.</p>
</div>
<div class="section level4">
<h4 id="stochastic-small-migration">Stochastic, Small Migration<a class="anchor" aria-label="anchor" href="#stochastic-small-migration"></a>
</h4>
<p>With very small migration rates, it is interesting to see how a
scenario changes using a stochastic simulation. Some repetitions should
take significantly longer for heterozygotes to migrate from patch 1 to
patch 2. So, we keep all of the parameters the same as above, but run 25
stochastic repetitions instead of a deterministic simulation.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">####################</span></span>
<span><span class="co"># Load libraries</span></span>
<span><span class="co">####################</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://marshalllab.github.io/MGDrivE/" class="external-link">MGDrivE</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Output Folder</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># This is slightly obtuse for vignette building reasons</span></span>
<span><span class="co">#  Really, all you need is a base directory, then the repetitions in folders inside that.</span></span>
<span><span class="co">#  Here, our base directory is "mgdrive", and the repetition folders are "001","002", etc.</span></span>
<span><span class="co">#  So, the final structure is "mgdrive/001","mgdrive/002", etc.</span></span>
<span><span class="va">outFolder</span> <span class="op">&lt;-</span> <span class="st">"mgdrive"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">outFolder</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Simulation Parameters</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># days to run the simulation</span></span>
<span><span class="va">tMax</span> <span class="op">&lt;-</span> <span class="fl">365</span></span>
<span></span>
<span><span class="co"># number of Monte Carlo iterations</span></span>
<span><span class="va">nRep</span> <span class="op">&lt;-</span> <span class="fl">25</span></span>
<span></span>
<span><span class="co"># each Monte Carlo iteration gets its own folder</span></span>
<span><span class="va">folderNames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">outFolder</span>,</span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/base/formatc.html" class="external-link">formatC</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">nRep</span>, width <span class="op">=</span> <span class="fl">3</span>, format <span class="op">=</span> <span class="st">"d"</span>, flag <span class="op">=</span> <span class="st">"0"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># entomological parameters</span></span>
<span><span class="va">bioParameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>betaK<span class="op">=</span><span class="fl">20</span>, tEgg<span class="op">=</span><span class="fl">5</span>, tLarva<span class="op">=</span><span class="fl">6</span>, tPupa<span class="op">=</span><span class="fl">4</span>, popGrowth<span class="op">=</span><span class="fl">1.175</span>, muAd<span class="op">=</span><span class="fl">0.09</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># a 2-node network with 1% per day migration rate</span></span>
<span><span class="va">moveMat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.99</span>,<span class="fl">0.01</span>,<span class="fl">0.01</span>,<span class="fl">0.99</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">moveMat</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,] 0.99 0.01</span></span>
<span><span class="co">#&gt; [2,] 0.01 0.99</span></span>
<span></span>
<span><span class="co"># parameters of the population equilibrium</span></span>
<span><span class="va">adultPopEquilibrium</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">sitesNumber</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">moveMat</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Basic Inheritance pattern</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Mendelian cube with standard (default) parameters</span></span>
<span><span class="va">cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cubeMendelian.html">cubeMendelian</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Setup releases and batch migration</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># set up the empty release vector</span></span>
<span><span class="co">#  MGDrivE pulls things out by name</span></span>
<span><span class="va">patchReleases</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span>n<span class="op">=</span><span class="va">sitesNumber</span>,</span>
<span>                           expr<span class="op">=</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maleReleases<span class="op">=</span><span class="cn">NULL</span>,femaleReleases<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>                                      eggReleases<span class="op">=</span><span class="cn">NULL</span>,matedFemaleReleases<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span><span class="op">}</span>,</span>
<span>                           simplify<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># choose release parameters</span></span>
<span><span class="co">#  Releases start at time 25, occur every day, for 5 days.</span></span>
<span><span class="co">#  There are 50 mosquitoes released every time.</span></span>
<span><span class="va">releasesParameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>releasesStart<span class="op">=</span><span class="fl">25</span>,</span>
<span>                          releasesNumber<span class="op">=</span><span class="fl">5</span>,</span>
<span>                          releasesInterval<span class="op">=</span><span class="fl">0</span>,</span>
<span>                          releaseProportion<span class="op">=</span><span class="fl">50</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate release vector</span></span>
<span><span class="va">releasesVector</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateReleaseVector.html">generateReleaseVector</a></span><span class="op">(</span>driveCube<span class="op">=</span><span class="va">cube</span>,</span>
<span>                                        releasesParameters<span class="op">=</span><span class="va">releasesParameters</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># put releases into the proper place in the release list</span></span>
<span><span class="va">patchReleases</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">maleReleases</span> <span class="op">&lt;-</span> <span class="va">releasesVector</span></span>
<span><span class="va">patchReleases</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">femaleReleases</span> <span class="op">&lt;-</span> <span class="va">releasesVector</span></span>
<span></span>
<span><span class="co"># batch migration is disabled by setting the probability to 0</span></span>
<span><span class="co"># This is required because of the stochastic simulations, but doesn't make sense</span></span>
<span><span class="co">#  in a deterministic simulation.</span></span>
<span><span class="va">batchMigration</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basicBatchMigration.html">basicBatchMigration</a></span><span class="op">(</span>batchProbs<span class="op">=</span><span class="fl">0</span>,</span>
<span>                                     sexProbs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.5</span>,<span class="fl">.5</span><span class="op">)</span>,</span>
<span>                                     numPatches<span class="op">=</span><span class="va">sitesNumber</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Combine parameters and run!</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># set MGDrivE to run stochastic</span></span>
<span><span class="fu"><a href="../reference/setupMGDrivE.html">setupMGDrivE</a></span><span class="op">(</span>stochasticityON <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># setup parameters for the network. This builds a list of parameters required for</span></span>
<span><span class="co">#  every population in the network. In ths case, we have a network of 2 populations.</span></span>
<span><span class="va">netPar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/parameterizeMGDrivE.html">parameterizeMGDrivE</a></span><span class="op">(</span>runID<span class="op">=</span><span class="fl">1</span>, simTime<span class="op">=</span><span class="va">tMax</span>, nPatch<span class="op">=</span><span class="va">sitesNumber</span>,</span>
<span>                             beta<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">betaK</span>, muAd<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">muAd</span>,</span>
<span>                             popGrowth<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">popGrowth</span>, tEgg<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">tEgg</span>,</span>
<span>                             tLarva<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">tLarva</span>, tPupa<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">tPupa</span>,</span>
<span>                             AdPopEQ<span class="op">=</span><span class="va">adultPopEquilibrium</span>, inheritanceCube <span class="op">=</span> <span class="va">cube</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># build network prior to run</span></span>
<span><span class="va">MGDrivESim</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Network.html">Network</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>params<span class="op">=</span><span class="va">netPar</span>,</span>
<span>                         driveCube<span class="op">=</span><span class="va">cube</span>,</span>
<span>                         patchReleases<span class="op">=</span><span class="va">patchReleases</span>,</span>
<span>                         migrationMale<span class="op">=</span><span class="va">moveMat</span>,</span>
<span>                         migrationFemale<span class="op">=</span><span class="va">moveMat</span>,</span>
<span>                         migrationBatch<span class="op">=</span><span class="va">batchMigration</span>,</span>
<span>                         directory<span class="op">=</span><span class="va">folderNames</span>,</span>
<span>                         verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># run simulation</span></span>
<span><span class="va">MGDrivESim</span><span class="op">$</span><span class="fu">multRun</span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Post Analysis</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># First, split output by patch</span></span>
<span><span class="co"># Second, aggregate females by their mate choice</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nRep</span><span class="op">)</span><span class="op">{</span></span>
<span> <span class="fu"><a href="../reference/splitOutput.html">splitOutput</a></span><span class="op">(</span>readDir <span class="op">=</span> <span class="va">folderNames</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, remFile <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span> <span class="fu"><a href="../reference/aggregateFemales.html">aggregateFemales</a></span><span class="op">(</span>readDir <span class="op">=</span> <span class="va">folderNames</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, genotypes <span class="op">=</span> <span class="va">cube</span><span class="op">$</span><span class="va">genotypesID</span>,</span>
<span>                  remFile <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># plot output of first run to see effect</span></span>
<span><span class="fu"><a href="../reference/plotMGDrivESingle.html">plotMGDrivESingle</a></span><span class="op">(</span>readDir <span class="op">=</span> <span class="va">folderNames</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, totalPop <span class="op">=</span> <span class="cn">TRUE</span>, lwd <span class="op">=</span> <span class="fl">3.5</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="mgdrive_examples_files/figure-html/unnamed-chunk-20-1.png" alt="A single example of a two-node, stochastic simulation where each node is connected by a 1% daily migration rate." width="672"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># plot all 25 repetitions together</span></span>
<span><span class="fu"><a href="../reference/plotMGDrivEMult.html">plotMGDrivEMult</a></span><span class="op">(</span>readDir <span class="op">=</span> <span class="va">outFolder</span>, lwd <span class="op">=</span> <span class="fl">0.35</span>, alpha <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span></span></code></pre></div>
<p><img src="mgdrive_examples_files/figure-html/unnamed-chunk-20-2.png" alt="25 repetitions of a two-node, stochastic simulation where each node is connected by a 1% daily migration rate." width="672"></p>
<p>Looking at the first plot, of just one repetition from the 25 that we
ran, we see the release at time 25 and then the increase in
heterozygotes after that. If we look closely, there are a few
<em>aa</em> individuals that migrate to the second patch, but very few.
We see how the population of <em>Aa</em> individuals fluctuates near
zero until the end of the simulation, but there are enough that they
never completely drop out of the population. The total population
fluctuates around 500 individuals, 250 each of males and females, as
expected from the parameters provided.</p>
<p>Looking at the second plot with all 25 repetitions provided, we see
how the simulations heuristically agree with the deterministic ones
performed above. The general analysis remains the same here, but with
more noise, accounting for the random fluctuations in real populations.
While not particularly enlightening in this setting, the behavior and
outcome are the same, it’s easy to see how low-frequency genotypes could
be lost from a population.</p>
</div>
<div class="section level4">
<h4 id="stochastic-small-migration-and-fitness-cost">Stochastic, Small Migration and Fitness Cost<a class="anchor" aria-label="anchor" href="#stochastic-small-migration-and-fitness-cost"></a>
</h4>
<p>As a final example, we perform a stochastic, two-population
simulation with the same fitness cost explored previously, i.e., a 60%
reduction in lifetime on <em>AA</em> and <em>aa</em> individuals. We
first explored this in a single, panmictic population using a
deterministic simulation, then explored the effect of stochasticity on
the results. Here, we extend our analysis to a two-population setting,
to explore how population structure might affect our results.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">####################</span></span>
<span><span class="co"># Load libraries</span></span>
<span><span class="co">####################</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://marshalllab.github.io/MGDrivE/" class="external-link">MGDrivE</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Output Folder</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># This is slightly obtuse for vignette building reasons</span></span>
<span><span class="co">#  Really, all you need is a base directory, then the repetitions in folders inside that.</span></span>
<span><span class="co">#  Here, our base directory is "mgdrive", and the repetition folders are "001","002", etc.</span></span>
<span><span class="co">#  So, the final structure is "mgdrive/001","mgdrive/002", etc.</span></span>
<span><span class="va">outFolder</span> <span class="op">&lt;-</span> <span class="st">"mgdrive"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">outFolder</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Simulation Parameters</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># days to run the simulation</span></span>
<span><span class="va">tMax</span> <span class="op">&lt;-</span> <span class="fl">365</span><span class="op">*</span><span class="fl">2</span></span>
<span></span>
<span><span class="co"># number of Monte Carlo iterations</span></span>
<span><span class="va">nRep</span> <span class="op">&lt;-</span> <span class="fl">25</span></span>
<span></span>
<span><span class="co"># each Monte Carlo iteration gets its own folder</span></span>
<span><span class="va">folderNames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">outFolder</span>,</span>
<span>                         <span class="fu"><a href="https://rdrr.io/r/base/formatc.html" class="external-link">formatC</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">nRep</span>, width <span class="op">=</span> <span class="fl">3</span>, format <span class="op">=</span> <span class="st">"d"</span>, flag <span class="op">=</span> <span class="st">"0"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># entomological parameters</span></span>
<span><span class="va">bioParameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>betaK<span class="op">=</span><span class="fl">20</span>, tEgg<span class="op">=</span><span class="fl">5</span>, tLarva<span class="op">=</span><span class="fl">6</span>, tPupa<span class="op">=</span><span class="fl">4</span>, popGrowth<span class="op">=</span><span class="fl">1.175</span>, muAd<span class="op">=</span><span class="fl">0.09</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># a 2-node network with 1% per day migration rate</span></span>
<span><span class="va">moveMat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.99</span>,<span class="fl">0.01</span>,<span class="fl">0.01</span>,<span class="fl">0.99</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># parameters of the population equilibrium</span></span>
<span><span class="va">adultPopEquilibrium</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">sitesNumber</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">moveMat</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Basic Inheritance pattern</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Mendelian cube</span></span>
<span></span>
<span><span class="co"># This time, lets put fitness cost on the homozygotes, giving the heterozygote</span></span>
<span><span class="co">#  an advantage</span></span>
<span></span>
<span><span class="co"># These genotypes correspond to ones in the cube. Look at a base cube first,</span></span>
<span><span class="co">#  then set this.</span></span>
<span><span class="co"># Homozygotes are 60% as fit as heterozygote over their entire lifetime</span></span>
<span><span class="co">#  Since omega is a daily death rate, we use the built-in function to calculate</span></span>
<span><span class="co">#  our desired lifetime cost as applied daily</span></span>
<span><span class="va">dayOmega</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calcOmega.html">calcOmega</a></span><span class="op">(</span>mu <span class="op">=</span> <span class="va">bioParameters</span><span class="op">$</span><span class="va">muAd</span>, lifespanReduction <span class="op">=</span> <span class="fl">0.60</span><span class="op">)</span></span>
<span><span class="va">omegaNew</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AA"</span><span class="op">=</span><span class="va">dayOmega</span>, <span class="st">"aa"</span><span class="op">=</span><span class="va">dayOmega</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># setup cube</span></span>
<span><span class="va">cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cubeMendelian.html">cubeMendelian</a></span><span class="op">(</span>omega <span class="op">=</span> <span class="va">omegaNew</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Setup releases and batch migration</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># set up the empty release vector</span></span>
<span><span class="co">#  MGDrivE pulls things out by name</span></span>
<span><span class="va">patchReleases</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span>n<span class="op">=</span><span class="va">sitesNumber</span>,</span>
<span>                           expr<span class="op">=</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maleReleases<span class="op">=</span><span class="cn">NULL</span>,femaleReleases<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>                                      eggReleases<span class="op">=</span><span class="cn">NULL</span>,matedFemaleReleases<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span><span class="op">}</span>,</span>
<span>                           simplify<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># choose release parameters</span></span>
<span><span class="co">#  Releases start at time 100, occur every day, for 5 days.</span></span>
<span><span class="co">#  There are 50 mosquitoes released every time.</span></span>
<span><span class="va">releasesParameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>releasesStart<span class="op">=</span><span class="fl">100</span>,</span>
<span>                           releasesNumber<span class="op">=</span><span class="fl">5</span>,</span>
<span>                           releasesInterval<span class="op">=</span><span class="fl">0</span>,</span>
<span>                           releaseProportion<span class="op">=</span><span class="fl">50</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate male release vector</span></span>
<span><span class="va">maleReleasesVector</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateReleaseVector.html">generateReleaseVector</a></span><span class="op">(</span>driveCube<span class="op">=</span><span class="va">cube</span>,</span>
<span>                                            releasesParameters<span class="op">=</span><span class="va">releasesParameters</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate female release vector</span></span>
<span><span class="va">femaleReleasesVector</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateReleaseVector.html">generateReleaseVector</a></span><span class="op">(</span>driveCube<span class="op">=</span><span class="va">cube</span>,</span>
<span>                                              releasesParameters<span class="op">=</span><span class="va">releasesParameters</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># put releases into the proper place in the release list</span></span>
<span><span class="va">patchReleases</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">maleReleases</span> <span class="op">&lt;-</span> <span class="va">maleReleasesVector</span></span>
<span><span class="va">patchReleases</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">femaleReleases</span> <span class="op">&lt;-</span> <span class="va">femaleReleasesVector</span></span>
<span></span>
<span><span class="co"># batch migration is disabled by setting the probability to 0</span></span>
<span><span class="co"># This is required because of the stochastic simulations, but doesn't make sense</span></span>
<span><span class="co">#  in a deterministic simulation.</span></span>
<span><span class="va">batchMigration</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basicBatchMigration.html">basicBatchMigration</a></span><span class="op">(</span>batchProbs<span class="op">=</span><span class="fl">0</span>,</span>
<span>                                     sexProbs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.5</span>,<span class="fl">.5</span><span class="op">)</span>,</span>
<span>                                     numPatches<span class="op">=</span><span class="va">sitesNumber</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Combine parameters and run!</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># set MGDrivE to run stochastic</span></span>
<span><span class="fu"><a href="../reference/setupMGDrivE.html">setupMGDrivE</a></span><span class="op">(</span>stochasticityON <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># setup parameters for the network. This builds a list of parameters required for</span></span>
<span><span class="co">#  every population in the network. In ths case, we have a network of 2 populations.</span></span>
<span><span class="va">netPar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/parameterizeMGDrivE.html">parameterizeMGDrivE</a></span><span class="op">(</span>runID<span class="op">=</span><span class="fl">1</span>, simTime<span class="op">=</span><span class="va">tMax</span>, nPatch<span class="op">=</span><span class="va">sitesNumber</span>,</span>
<span>                             beta<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">betaK</span>, muAd<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">muAd</span>,</span>
<span>                             popGrowth<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">popGrowth</span>, tEgg<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">tEgg</span>,</span>
<span>                             tLarva<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">tLarva</span>, tPupa<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">tPupa</span>,</span>
<span>                             AdPopEQ<span class="op">=</span><span class="va">adultPopEquilibrium</span>, inheritanceCube <span class="op">=</span> <span class="va">cube</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># build network prior to run</span></span>
<span><span class="va">MGDrivESim</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Network.html">Network</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>params<span class="op">=</span><span class="va">netPar</span>,</span>
<span>                         driveCube<span class="op">=</span><span class="va">cube</span>,</span>
<span>                         patchReleases<span class="op">=</span><span class="va">patchReleases</span>,</span>
<span>                         migrationMale<span class="op">=</span><span class="va">moveMat</span>,</span>
<span>                         migrationFemale<span class="op">=</span><span class="va">moveMat</span>,</span>
<span>                         migrationBatch<span class="op">=</span><span class="va">batchMigration</span>,</span>
<span>                         directory<span class="op">=</span><span class="va">folderNames</span>,</span>
<span>                         verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># run simulation</span></span>
<span><span class="va">MGDrivESim</span><span class="op">$</span><span class="fu">multRun</span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Post Analysis</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># First, split output by patch</span></span>
<span><span class="co"># Second, aggregate females by their mate choice</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nRep</span><span class="op">)</span><span class="op">{</span></span>
<span> <span class="fu"><a href="../reference/splitOutput.html">splitOutput</a></span><span class="op">(</span>readDir <span class="op">=</span> <span class="va">folderNames</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, remFile <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span> <span class="fu"><a href="../reference/aggregateFemales.html">aggregateFemales</a></span><span class="op">(</span>readDir <span class="op">=</span> <span class="va">folderNames</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, genotypes <span class="op">=</span> <span class="va">cube</span><span class="op">$</span><span class="va">genotypesID</span>,</span>
<span>                  remFile <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># plot output of first run to see effect</span></span>
<span><span class="co">#  per the structure above, we are reading "mgdrive/001" for the single plot</span></span>
<span><span class="fu"><a href="../reference/plotMGDrivESingle.html">plotMGDrivESingle</a></span><span class="op">(</span>readDir <span class="op">=</span> <span class="va">folderNames</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, totalPop <span class="op">=</span> <span class="cn">TRUE</span>, lwd <span class="op">=</span> <span class="fl">3.5</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="mgdrive_examples_files/figure-html/unnamed-chunk-22-1.png" alt="A single example of a two-node, stochastic simulation where each node is connected by a 1% daily migration rate and includes fitness costs." width="672"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># plot all 50 repetitions together</span></span>
<span><span class="co">#  Here, we feed the function "mgdrive/", and it finds all repetition folders</span></span>
<span><span class="co">#   inside that.</span></span>
<span><span class="fu"><a href="../reference/plotMGDrivEMult.html">plotMGDrivEMult</a></span><span class="op">(</span>readDir <span class="op">=</span> <span class="va">outFolder</span>, lwd <span class="op">=</span> <span class="fl">0.35</span>, alpha <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span></span></code></pre></div>
<p><img src="mgdrive_examples_files/figure-html/unnamed-chunk-22-2.png" alt="25 repetitions of a two-node, stochastic simulation where each node is connected by a 1% daily migration rate and includes fitness costs." width="672"></p>
<p>Looking at the first plot, a single repetition of our stochastic
simulation, we see that the results are very similar. The population
size first drops to about 300, 60% of the equilibration population, and
then increases to about 400, as expected from the deterministic
simulation and analysis performed before. Do notice however, the
dynamics are slower in the first population than in the
single-population exploration. This is because we performed the same
releases, but with a second population, there is a small immigration of
<em>AA</em> individuals into the first patch and a small emigration of
<em>aa</em> and <em>Aa</em> individuals out of patch 1 into patch 2.
Thus, there is effectively twice the population size total, even though
there is only a 1% chance of mixing per day.</p>
<p>The second plot shows all 25 repetitions of our simulation. The
results clearly follow the one-node, deterministic simulation performed
before. There is an initial population drop, as both patches are fully
<em>AA</em> until we perform releases, then releases and a small
recovery in population size. The general dynamics remain very similar,
with the shift from <em>AA</em> to <em>Aa</em> individuals in the
population taking a little longer than originally. This is also
something we saw in the one-node stochastic simulation, and is a result
of stochasticity in the population dynamics, as well as migration
to/from the second patch.</p>
</div>
</div>
<div class="section level3">
<h3 id="reciprocal-translocation-gene-drive-simulations-one-population">Reciprocal Translocation Gene Drive Simulations, One Population<a class="anchor" aria-label="anchor" href="#reciprocal-translocation-gene-drive-simulations-one-population"></a>
</h3>
<p><a href="https://pubs.acs.org/doi/10.1021/acssynbio.7b00451" class="external-link">Reciprocal
translocations</a> are a classic form of gene drive, utilizing the
underdominance effects of gene dosage compensation to either suppress a
population or replace a population, depending on fitness costs and
release frequencies. The classic reciprocal translocation involves
breaking two chromosomes, swapping the broken ends, and reattaching the
ends to the opposite chromosomes. Theoretically, this creates a perfect
50% fitness cost on the population, as has been shown previously.
However, previous simulations studying reciprocal translocations have
been panmictic, deterministic, and ignore life-stages. Thus, we start
with two deterministic simulations, to find the critical threshold when
a complete life-history is included, and then explore how that threshold
is affected by stochasticity.</p>
<div class="section level4">
<h4 id="deterministic-below-threshold">Deterministic, Below Threshold<a class="anchor" aria-label="anchor" href="#deterministic-below-threshold"></a>
</h4>
<p>We maintain the same theoretical fitness cost, namely, that
possession of only 1 copy of a reciprocal chromosome is always fatal. We
perform 5 releases of transgenic critters, both male and female, every 7
days starting at day 25. This is not enough to make the population 50%
transgenic, and therefore the transgenic critters should die out.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">####################</span></span>
<span><span class="co"># Load libraries</span></span>
<span><span class="co">####################</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://marshalllab.github.io/MGDrivE/" class="external-link">MGDrivE</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Output Folder</span></span>
<span><span class="co">####################</span></span>
<span><span class="va">outFolder</span> <span class="op">&lt;-</span> <span class="st">"mgdrive"</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Simulation Parameters</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># days to run the simulation, 2 years</span></span>
<span><span class="va">tMax</span> <span class="op">&lt;-</span> <span class="fl">365</span><span class="op">*</span><span class="fl">2</span></span>
<span></span>
<span><span class="co"># entomological parameters</span></span>
<span><span class="va">bioParameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>betaK<span class="op">=</span><span class="fl">20</span>, tEgg<span class="op">=</span><span class="fl">5</span>, tLarva<span class="op">=</span><span class="fl">6</span>, tPupa<span class="op">=</span><span class="fl">4</span>, popGrowth<span class="op">=</span><span class="fl">1.175</span>, muAd<span class="op">=</span><span class="fl">0.09</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># a 1-node network where mosquitoes do not leave</span></span>
<span><span class="va">moveMat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># parameters of the population equilibrium</span></span>
<span><span class="va">adultPopEquilibrium</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">sitesNumber</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">moveMat</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Basic Inheritance pattern</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Reciprocal translocation cube with standard (default) parameters</span></span>
<span><span class="va">cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cubeReciprocalTranslocations.html">cubeReciprocalTranslocations</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Setup releases and batch migration</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># set up the empty release vector</span></span>
<span><span class="co">#  MGDrivE pulls things out by name</span></span>
<span><span class="va">patchReleases</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span>n<span class="op">=</span><span class="va">sitesNumber</span>,</span>
<span>                           expr<span class="op">=</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maleReleases<span class="op">=</span><span class="cn">NULL</span>,femaleReleases<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>                                      eggReleases<span class="op">=</span><span class="cn">NULL</span>,matedFemaleReleases<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span><span class="op">}</span>,</span>
<span>                           simplify<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># choose release parameters</span></span>
<span><span class="co">#  Releases start at time 25, occur once a week, for 5 weeks.</span></span>
<span><span class="co">#  There are 100 mosquitoes released every time.</span></span>
<span><span class="va">releasesParameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>releasesStart<span class="op">=</span><span class="fl">25</span>,</span>
<span>                          releasesNumber<span class="op">=</span><span class="fl">5</span>,</span>
<span>                          releasesInterval<span class="op">=</span><span class="fl">7</span>,</span>
<span>                          releaseProportion<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate male release vector</span></span>
<span><span class="va">maleReleasesVector</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateReleaseVector.html">generateReleaseVector</a></span><span class="op">(</span>driveCube<span class="op">=</span><span class="va">cube</span>,</span>
<span>                                           releasesParameters<span class="op">=</span><span class="va">releasesParameters</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate female release vector</span></span>
<span><span class="va">femaleReleasesVector</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateReleaseVector.html">generateReleaseVector</a></span><span class="op">(</span>driveCube<span class="op">=</span><span class="va">cube</span>,</span>
<span>                                             releasesParameters<span class="op">=</span><span class="va">releasesParameters</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># put releases into the proper place in the release list</span></span>
<span><span class="va">patchReleases</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">maleReleases</span> <span class="op">&lt;-</span> <span class="va">maleReleasesVector</span></span>
<span><span class="va">patchReleases</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">femaleReleases</span> <span class="op">&lt;-</span> <span class="va">femaleReleasesVector</span></span>
<span></span>
<span><span class="co"># batch migration is disabled by setting the probability to 0</span></span>
<span><span class="co"># This is required because of the stochastic simulations, but doesn't make sense</span></span>
<span><span class="co">#  in a deterministic simulation.</span></span>
<span><span class="va">batchMigration</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basicBatchMigration.html">basicBatchMigration</a></span><span class="op">(</span>batchProbs<span class="op">=</span><span class="fl">0</span>,</span>
<span>                                     sexProbs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.5</span>,<span class="fl">.5</span><span class="op">)</span>,</span>
<span>                                     numPatches<span class="op">=</span><span class="va">sitesNumber</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Combine parameters and run!</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># set MGDrivE to run deterministic</span></span>
<span><span class="fu"><a href="../reference/setupMGDrivE.html">setupMGDrivE</a></span><span class="op">(</span>stochasticityON <span class="op">=</span> <span class="cn">FALSE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># setup parameters for the network. This builds a list of parameters required for</span></span>
<span><span class="co">#  every population in the network. In ths case, we have a network of 1 population.</span></span>
<span><span class="va">netPar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/parameterizeMGDrivE.html">parameterizeMGDrivE</a></span><span class="op">(</span>runID<span class="op">=</span><span class="fl">1</span>, simTime<span class="op">=</span><span class="va">tMax</span>, nPatch<span class="op">=</span><span class="va">sitesNumber</span>,</span>
<span>                             beta<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">betaK</span>, muAd<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">muAd</span>,</span>
<span>                             popGrowth<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">popGrowth</span>, tEgg<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">tEgg</span>,</span>
<span>                             tLarva<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">tLarva</span>, tPupa<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">tPupa</span>,</span>
<span>                             AdPopEQ<span class="op">=</span><span class="va">adultPopEquilibrium</span>, inheritanceCube <span class="op">=</span> <span class="va">cube</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># build network prior to run</span></span>
<span><span class="va">MGDrivESim</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Network.html">Network</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>params<span class="op">=</span><span class="va">netPar</span>,</span>
<span>                         driveCube<span class="op">=</span><span class="va">cube</span>,</span>
<span>                         patchReleases<span class="op">=</span><span class="va">patchReleases</span>,</span>
<span>                         migrationMale<span class="op">=</span><span class="va">moveMat</span>,</span>
<span>                         migrationFemale<span class="op">=</span><span class="va">moveMat</span>,</span>
<span>                         migrationBatch<span class="op">=</span><span class="va">batchMigration</span>,</span>
<span>                         directory<span class="op">=</span><span class="va">outFolder</span>,</span>
<span>                         verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># run simulation</span></span>
<span><span class="va">MGDrivESim</span><span class="op">$</span><span class="fu">oneRun</span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Post Analysis</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># split output by patch</span></span>
<span><span class="co">#  Required for plotting later</span></span>
<span><span class="fu"><a href="../reference/splitOutput.html">splitOutput</a></span><span class="op">(</span>readDir <span class="op">=</span> <span class="va">outFolder</span>, remFile <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># aggregate females by their mate choice</span></span>
<span><span class="co">#  This reduces the female file to have the same columns as the male file</span></span>
<span><span class="fu"><a href="../reference/aggregateFemales.html">aggregateFemales</a></span><span class="op">(</span>readDir <span class="op">=</span> <span class="va">outFolder</span>, genotypes <span class="op">=</span> <span class="va">cube</span><span class="op">$</span><span class="va">genotypesID</span>,</span>
<span>                remFile <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot output to see effect</span></span>
<span><span class="fu"><a href="../reference/plotMGDrivESingle.html">plotMGDrivESingle</a></span><span class="op">(</span>readDir <span class="op">=</span> <span class="va">outFolder</span>, totalPop <span class="op">=</span> <span class="cn">TRUE</span>, lwd <span class="op">=</span> <span class="fl">3.5</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="mgdrive_examples_files/figure-html/unnamed-chunk-24-1.png" alt="A deterministic simulation of a reciprocal translocation in a single, panmictic population, where the gene frequency remains below the fitness threshold." width="672"></p>
<p>We plot the number of female (left) and male (right) critters over a
period of two years. The total population is shown in purple, while
wild-type (aabb) individuals are in orange and fully transgenic
individuals (AABB) are in light blue. We see the total population
increase dramatically during the releases, then fall back to a little
below the equilibrium amount. This is because of offspring of transgenic
and wild-type critters than are non-viable. Eventually, the transgenic
individuals completely die out and the population is wild-type again.
This is the expected behavior for reciprocal translocations when the 50%
critical threshold is not achieved.</p>
</div>
<div class="section level4">
<h4 id="deterministic-above-threshold">Deterministic, Above Threshold<a class="anchor" aria-label="anchor" href="#deterministic-above-threshold"></a>
</h4>
<p>Now, we perform the same simulation as above, but increase the number
of releases by one, from 5 releases to 6. This is enough to get over the
critical threshold, so we should see the population turn entirely into
transgenic individuals.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">####################</span></span>
<span><span class="co"># Load libraries</span></span>
<span><span class="co">####################</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://marshalllab.github.io/MGDrivE/" class="external-link">MGDrivE</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Output Folder</span></span>
<span><span class="co">####################</span></span>
<span><span class="va">outFolder</span> <span class="op">&lt;-</span> <span class="st">"mgdrive"</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Simulation Parameters</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># days to run the simulation, 2 years</span></span>
<span><span class="va">tMax</span> <span class="op">&lt;-</span> <span class="fl">365</span><span class="op">*</span><span class="fl">2</span></span>
<span></span>
<span><span class="co"># entomological parameters</span></span>
<span><span class="va">bioParameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>betaK<span class="op">=</span><span class="fl">20</span>, tEgg<span class="op">=</span><span class="fl">5</span>, tLarva<span class="op">=</span><span class="fl">6</span>, tPupa<span class="op">=</span><span class="fl">4</span>, popGrowth<span class="op">=</span><span class="fl">1.175</span>, muAd<span class="op">=</span><span class="fl">0.09</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># a 1-node network where mosquitoes do not leave</span></span>
<span><span class="va">moveMat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># parameters of the population equilibrium</span></span>
<span><span class="va">adultPopEquilibrium</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">sitesNumber</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">moveMat</span><span class="op">)</span></span>
<span><span class="va">patchPops</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">adultPopEquilibrium</span>,<span class="va">sitesNumber</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Basic Inheritance pattern</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Reciprocal translocation cube with standard (default) parameters</span></span>
<span><span class="va">cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cubeReciprocalTranslocations.html">cubeReciprocalTranslocations</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Setup releases and batch migration</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># set up the empty release vector</span></span>
<span><span class="co">#  MGDrivE pulls things out by name</span></span>
<span><span class="va">patchReleases</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span>n<span class="op">=</span><span class="va">sitesNumber</span>,</span>
<span>                           expr<span class="op">=</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maleReleases<span class="op">=</span><span class="cn">NULL</span>,femaleReleases<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>                                      eggReleases<span class="op">=</span><span class="cn">NULL</span>,matedFemaleReleases<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span><span class="op">}</span>,</span>
<span>                           simplify<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># choose release parameters</span></span>
<span><span class="co">#  Releases start at time 25, occur once a week, for 6 weeks.</span></span>
<span><span class="co">#  There are 100 mosquitoes released every time.</span></span>
<span><span class="va">releasesParameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>releasesStart<span class="op">=</span><span class="fl">25</span>,</span>
<span>                           releasesNumber<span class="op">=</span><span class="fl">6</span>,</span>
<span>                           releasesInterval<span class="op">=</span><span class="fl">7</span>,</span>
<span>                           releaseProportion<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate release vector</span></span>
<span><span class="va">releasesVector</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateReleaseVector.html">generateReleaseVector</a></span><span class="op">(</span>driveCube<span class="op">=</span><span class="va">cube</span>,</span>
<span>                                        releasesParameters<span class="op">=</span><span class="va">releasesParameters</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># put releases into the proper place in the release list</span></span>
<span><span class="va">patchReleases</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">maleReleases</span> <span class="op">&lt;-</span> <span class="va">releasesVector</span></span>
<span><span class="va">patchReleases</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">femaleReleases</span> <span class="op">&lt;-</span> <span class="va">releasesVector</span></span>
<span></span>
<span><span class="co"># batch migration is disabled by setting the probability to 0</span></span>
<span><span class="co"># This is required because of the stochastic simulations, but doesn't make sense</span></span>
<span><span class="co">#  in a deterministic simulation.</span></span>
<span><span class="va">batchMigration</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basicBatchMigration.html">basicBatchMigration</a></span><span class="op">(</span>batchProbs<span class="op">=</span><span class="fl">0</span>,</span>
<span>                                      sexProbs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.5</span>,<span class="fl">.5</span><span class="op">)</span>,</span>
<span>                                      numPatches<span class="op">=</span><span class="va">sitesNumber</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Combine parameters and run!</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># set MGDrivE to run deterministic</span></span>
<span><span class="fu"><a href="../reference/setupMGDrivE.html">setupMGDrivE</a></span><span class="op">(</span>stochasticityON <span class="op">=</span> <span class="cn">FALSE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># setup parameters for the network. This builds a list of parameters required for</span></span>
<span><span class="co">#  every population in the network. In ths case, we have a network of 1 population.</span></span>
<span><span class="va">netPar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/parameterizeMGDrivE.html">parameterizeMGDrivE</a></span><span class="op">(</span>runID<span class="op">=</span><span class="fl">1</span>, simTime<span class="op">=</span><span class="va">tMax</span>, nPatch<span class="op">=</span><span class="va">sitesNumber</span>,</span>
<span>                              beta<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">betaK</span>, muAd<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">muAd</span>,</span>
<span>                              popGrowth<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">popGrowth</span>, tEgg<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">tEgg</span>,</span>
<span>                              tLarva<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">tLarva</span>, tPupa<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">tPupa</span>,</span>
<span>                              AdPopEQ<span class="op">=</span><span class="va">patchPops</span>, inheritanceCube <span class="op">=</span> <span class="va">cube</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># build network prior to run</span></span>
<span><span class="va">MGDrivESim</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Network.html">Network</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>params<span class="op">=</span><span class="va">netPar</span>,</span>
<span>                          driveCube<span class="op">=</span><span class="va">cube</span>,</span>
<span>                          patchReleases<span class="op">=</span><span class="va">patchReleases</span>,</span>
<span>                          migrationMale<span class="op">=</span><span class="va">moveMat</span>,</span>
<span>                          migrationFemale<span class="op">=</span><span class="va">moveMat</span>,</span>
<span>                          migrationBatch<span class="op">=</span><span class="va">batchMigration</span>,</span>
<span>                          directory<span class="op">=</span><span class="va">outFolder</span>,</span>
<span>                          verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># run simulation</span></span>
<span><span class="va">MGDrivESim</span><span class="op">$</span><span class="fu">oneRun</span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Post Analysis</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># split output by patch</span></span>
<span><span class="co">#  Required for plotting later</span></span>
<span><span class="fu"><a href="../reference/splitOutput.html">splitOutput</a></span><span class="op">(</span>readDir <span class="op">=</span> <span class="va">outFolder</span>, remFile <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># aggregate females by their mate choice</span></span>
<span><span class="co">#  This reduces the female file to have the same columns as the male file</span></span>
<span><span class="fu"><a href="../reference/aggregateFemales.html">aggregateFemales</a></span><span class="op">(</span>readDir <span class="op">=</span> <span class="va">outFolder</span>, genotypes <span class="op">=</span> <span class="va">cube</span><span class="op">$</span><span class="va">genotypesID</span>,</span>
<span>                 remFile <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot output to see effect</span></span>
<span><span class="fu"><a href="../reference/plotMGDrivESingle.html">plotMGDrivESingle</a></span><span class="op">(</span>readDir <span class="op">=</span> <span class="va">outFolder</span>, totalPop <span class="op">=</span> <span class="cn">TRUE</span>, lwd <span class="op">=</span> <span class="fl">3.5</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="mgdrive_examples_files/figure-html/unnamed-chunk-26-1.png" alt="A deterministic simulation of a reciprocal translocation in a single, panmictic population, where the gene frequency crosses the critical threshold and spreads." width="672"></p>
<p>Analyzing the same plots as above, notice one more release and the
dramatic change it has on the outcome of the simulation. This time, our
releases surpassed the critical threshold and the transgenic critters
took over the population. Again though, we see the slight depression in
population size initially after releases, while the population is a mix
of wild-type and transgenics. However, once the population is entirely
transgenic, the total size returns to the equilibrium value.</p>
</div>
<div class="section level4">
<h4 id="stochastic-above-threshold">Stochastic, “Above” Threshold<a class="anchor" aria-label="anchor" href="#stochastic-above-threshold"></a>
</h4>
<p>The preceding two simulations show dramatically different results
with the addition of a single release. This implies that we are near the
critical threshold but gives a false impression of how distinct or
certain we are of the outcome. Stochastic fluctuations can quickly push
us across a threshold, even when deterministic simulations implied we
had passed/not passed it. Using stochastic simulations, we can put a
probability on an outcome, given that we are near the threshold. Thus,
we perform the same simulation as above, 6 releases, that we think puts
us over the critical threshold. However, as we will see below, this is
not entirely the case.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">####################</span></span>
<span><span class="co"># Load libraries</span></span>
<span><span class="co">####################</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://marshalllab.github.io/MGDrivE/" class="external-link">MGDrivE</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Output Folder</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># This is slightly obtuse for vignette building reasons</span></span>
<span><span class="co">#  Really, all you need is a base directory, then the repetitions in folders inside that.</span></span>
<span><span class="co">#  Here, our base directory is "mgdrive", and the repetition folders are "001","002", etc.</span></span>
<span><span class="co">#  So, the final structure is "mgdrive/001","mgdrive/002", etc.</span></span>
<span><span class="va">outFolder</span> <span class="op">&lt;-</span> <span class="st">"mgdrive"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">outFolder</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Simulation Parameters</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># days to run the simulation, 3 years</span></span>
<span><span class="va">tMax</span> <span class="op">&lt;-</span> <span class="fl">365</span><span class="op">*</span><span class="fl">3</span></span>
<span></span>
<span><span class="co"># number of Monte Carlo iterations</span></span>
<span><span class="va">nRep</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span></span>
<span><span class="co"># each Monte Carlo iteration gets its own folder</span></span>
<span><span class="va">folderNames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">outFolder</span>,</span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/base/formatc.html" class="external-link">formatC</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">nRep</span>, width <span class="op">=</span> <span class="fl">3</span>, format <span class="op">=</span> <span class="st">"d"</span>, flag <span class="op">=</span> <span class="st">"0"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># entomological parameters</span></span>
<span><span class="va">bioParameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>betaK<span class="op">=</span><span class="fl">20</span>, tEgg<span class="op">=</span><span class="fl">5</span>, tLarva<span class="op">=</span><span class="fl">6</span>, tPupa<span class="op">=</span><span class="fl">4</span>, popGrowth<span class="op">=</span><span class="fl">1.175</span>, muAd<span class="op">=</span><span class="fl">0.09</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># a 1-node network where mosquitoes do not leave</span></span>
<span><span class="va">moveMat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># parameters of the population equilibrium</span></span>
<span><span class="va">adultPopEquilibrium</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">sitesNumber</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">moveMat</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Basic Inheritance pattern</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Reciprocal translocation cube with standard (default) parameters</span></span>
<span><span class="va">cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cubeReciprocalTranslocations.html">cubeReciprocalTranslocations</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Setup releases and batch migration</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># set up the empty release vector</span></span>
<span><span class="co">#  MGDrivE pulls things out by name</span></span>
<span><span class="va">patchReleases</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span>n<span class="op">=</span><span class="va">sitesNumber</span>,</span>
<span>                           expr<span class="op">=</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maleReleases<span class="op">=</span><span class="cn">NULL</span>,femaleReleases<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>                                      eggReleases<span class="op">=</span><span class="cn">NULL</span>,matedFemaleReleases<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span><span class="op">}</span>,</span>
<span>                           simplify<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># choose release parameters</span></span>
<span><span class="co">#  Releases start at time 25, occur once a week, for 6 weeks.</span></span>
<span><span class="co">#  There are 100 mosquitoes released every time.</span></span>
<span><span class="va">releasesParameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>releasesStart<span class="op">=</span><span class="fl">25</span>,</span>
<span>                          releasesNumber<span class="op">=</span><span class="fl">6</span>,</span>
<span>                          releasesInterval<span class="op">=</span><span class="fl">7</span>,</span>
<span>                          releaseProportion<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate male release vector</span></span>
<span><span class="va">maleReleasesVector</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateReleaseVector.html">generateReleaseVector</a></span><span class="op">(</span>driveCube<span class="op">=</span><span class="va">cube</span>,</span>
<span>                                           releasesParameters<span class="op">=</span><span class="va">releasesParameters</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate female release vector</span></span>
<span><span class="va">femaleReleasesVector</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateReleaseVector.html">generateReleaseVector</a></span><span class="op">(</span>driveCube<span class="op">=</span><span class="va">cube</span>,</span>
<span>                                             releasesParameters<span class="op">=</span><span class="va">releasesParameters</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># put releases into the proper place in the release list</span></span>
<span><span class="va">patchReleases</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">maleReleases</span> <span class="op">&lt;-</span> <span class="va">maleReleasesVector</span></span>
<span><span class="va">patchReleases</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">femaleReleases</span> <span class="op">&lt;-</span> <span class="va">femaleReleasesVector</span></span>
<span></span>
<span><span class="co"># batch migration is disabled by setting the probability to 0</span></span>
<span><span class="co"># This is required because of the stochastic simulations, but doesn't make sense</span></span>
<span><span class="co">#  in a deterministic simulation.</span></span>
<span><span class="va">batchMigration</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basicBatchMigration.html">basicBatchMigration</a></span><span class="op">(</span>batchProbs<span class="op">=</span><span class="fl">0</span>,</span>
<span>                                     sexProbs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.5</span>,<span class="fl">.5</span><span class="op">)</span>,</span>
<span>                                     numPatches<span class="op">=</span><span class="va">sitesNumber</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Combine parameters and run!</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># set MGDrivE to run stochastic</span></span>
<span><span class="fu"><a href="../reference/setupMGDrivE.html">setupMGDrivE</a></span><span class="op">(</span>stochasticityON <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># setup parameters for the network. This builds a list of parameters required for</span></span>
<span><span class="co">#  every population in the network. In ths case, we have a network of 1 population.</span></span>
<span><span class="va">netPar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/parameterizeMGDrivE.html">parameterizeMGDrivE</a></span><span class="op">(</span>runID<span class="op">=</span><span class="fl">1</span>, simTime<span class="op">=</span><span class="va">tMax</span>, nPatch<span class="op">=</span><span class="va">sitesNumber</span>,</span>
<span>                             beta<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">betaK</span>, muAd<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">muAd</span>,</span>
<span>                             popGrowth<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">popGrowth</span>, tEgg<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">tEgg</span>,</span>
<span>                             tLarva<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">tLarva</span>, tPupa<span class="op">=</span><span class="va">bioParameters</span><span class="op">$</span><span class="va">tPupa</span>,</span>
<span>                             AdPopEQ<span class="op">=</span><span class="va">adultPopEquilibrium</span>, inheritanceCube <span class="op">=</span> <span class="va">cube</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># build network prior to run</span></span>
<span><span class="va">MGDrivESim</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Network.html">Network</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>params<span class="op">=</span><span class="va">netPar</span>,</span>
<span>                         driveCube<span class="op">=</span><span class="va">cube</span>,</span>
<span>                         patchReleases<span class="op">=</span><span class="va">patchReleases</span>,</span>
<span>                         migrationMale<span class="op">=</span><span class="va">moveMat</span>,</span>
<span>                         migrationFemale<span class="op">=</span><span class="va">moveMat</span>,</span>
<span>                         migrationBatch<span class="op">=</span><span class="va">batchMigration</span>,</span>
<span>                         directory<span class="op">=</span><span class="va">folderNames</span>,</span>
<span>                         verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; initializing patch:  1  of  1</span></span>
<span><span class="co"># run simulation</span></span>
<span><span class="va">MGDrivESim</span><span class="op">$</span><span class="fu">multRun</span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># Post Analysis</span></span>
<span><span class="co">####################</span></span>
<span><span class="co"># First, split output by patch</span></span>
<span><span class="co"># Second, aggregate females by their mate choice</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nRep</span><span class="op">)</span><span class="op">{</span></span>
<span> <span class="fu"><a href="../reference/splitOutput.html">splitOutput</a></span><span class="op">(</span>readDir <span class="op">=</span> <span class="va">folderNames</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, remFile <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span> <span class="fu"><a href="../reference/aggregateFemales.html">aggregateFemales</a></span><span class="op">(</span>readDir <span class="op">=</span> <span class="va">folderNames</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, genotypes <span class="op">=</span> <span class="va">cube</span><span class="op">$</span><span class="va">genotypesID</span>,</span>
<span>                  remFile <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># plot output of first run to see effect</span></span>
<span><span class="fu"><a href="../reference/plotMGDrivESingle.html">plotMGDrivESingle</a></span><span class="op">(</span>readDir <span class="op">=</span> <span class="va">folderNames</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">3.5</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="mgdrive_examples_files/figure-html/unnamed-chunk-28-1.png" alt="A stochastic simulation of a reciprocal translocation in a single, panmictic population." width="672"></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># plot all 50 repetitions together</span></span>
<span><span class="fu"><a href="../reference/plotMGDrivEMult.html">plotMGDrivEMult</a></span><span class="op">(</span>readDir <span class="op">=</span> <span class="va">outFolder</span>, lwd <span class="op">=</span> <span class="fl">0.35</span>, alpha <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span></span></code></pre></div>
<p><img src="mgdrive_examples_files/figure-html/unnamed-chunk-28-2.png" alt="20 stochastic repetitions simulating a reciprocal translocation in a single, panmictic population." width="672"></p>
<p>We perform 20 repetitions of our stochastic simulation. In an
experimental setting, we should perform many more repetitions (the
number of repetitions is related to the precision of your estimate. 100
repetitions would provide 1% resolution, while our 20 repetitions here
only provides 5% resolution), but outcome resolution needs to be
balanced against run time.</p>
<p>First we plot a single repetition. Wild-type (aabb) critters are in
orange, and transgenic (AABB) critters are in blue. We see that there is
some fluctuation, and then the final result does not match the
deterministic simulation. This is a little worrisome, as it means we are
so close to the threshold that it is easy to go back under.</p>
<p>Plotting all 20 repetitions, we see that the results are not as clear
as before. We have extended the simulation to 1095 days to allow all of
the repetitions to achieve their final trajectory. First, near the
critical threshold, stochastic fluctuations dramatically slow the
population dynamics. The deterministic simulations were finished in two
years, but stochastic simulations took nearly three years for all of the
trajectories to reach equilibrium. Second, we notice that not all of the
simulations ended with a fully transgenic population. In fact, only 80%
of the repetitions ended with a fully transgenic population. More
repetitions would provide a more precise answer, but now we know that
this set of parameters is only 80 +/-5% effective.</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://chipdelmal.github.io" class="external-link">Héctor Manuel Sánchez Castellanos</a>, <a href="https://github.com/GilChrist19" class="external-link">Jared Bennett</a>, <a href="https://slwu89.github.io" class="external-link">Sean Wu</a>, <a href="https://www.marshalllab.com" class="external-link">John M. Marshall</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
