<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MGDrivE2: SEIR Epidemiological Dynamics • MGDrivE2</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="MGDrivE2: SEIR Epidemiological Dynamics">
<meta property="og:description" content="MGDrivE2">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MGDrivE2</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/advanced_topics.html">MGDrivE2: Advanced Topics</a>
    </li>
    <li>
      <a href="../articles/epi-SEIR.html">MGDrivE2: SEIR Epidemiological Dynamics</a>
    </li>
    <li>
      <a href="../articles/epi-network.html">MGDrivE2: Metapopulation Network Epidemiological Dynamics</a>
    </li>
    <li>
      <a href="../articles/epi-node.html">MGDrivE2: One Node Epidemiological Dynamics</a>
    </li>
    <li>
      <a href="../articles/inhomogeneous.html">MGDrivE2: Simulation of Time-inhomogeneous Stochastic Processes (Seasonality)</a>
    </li>
    <li>
      <a href="../articles/lifecycle-network.html">MGDrivE2: Metapopulation Network Lifecycle Dynamics</a>
    </li>
    <li>
      <a href="../articles/lifecycle-node.html">MGDrivE2: One Node Lifecycle Dynamics</a>
    </li>
    <li>
      <a href="../articles/output-storage.html">MGDrivE2: Data Storage and Analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/MarshallLab/MGDrivE/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="epi-SEIR_files/header-attrs-2.5/header-attrs.js"></script><link href="epi-SEIR_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="epi-SEIR_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>MGDrivE2: SEIR Epidemiological Dynamics</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/MarshallLab/MGDrivE/blob/master/vignettes/epi-SEIR.Rmd"><code>vignettes/epi-SEIR.Rmd</code></a></small>
      <div class="hidden name"><code>epi-SEIR.Rmd</code></div>

    </div>

    
    
<div id="table-of-contents" class="section level2">
<h2 class="hasAnchor">
<a href="#table-of-contents" class="anchor"></a>Table of Contents</h2>
<ol style="list-style-type: decimal">
<li>
<a href="#node">One Node Simulations</a>
<ol style="list-style-type: decimal">
<li><a href="#pars_node">Parameterization</a></li>
<li><a href="#init_pn_node">Initialization of the Petri Net</a></li>
<li><a href="#equilibria_haz_node">Equilibrium Conditions and Hazard Functions</a></li>
<li>
<a href="#sim_node">Simulation of Fully Specified SPN Model</a>
<ol style="list-style-type: decimal">
<li><a href="#soln_ode_node">Deterministic: ODE Solutions</a></li>
<li><a href="#soln_tau_node">Stochastic: Tau-Leaping Solutions</a></li>
</ol>
</li>
</ol>
</li>
<li>
<a href="#net">Metapopulation Network Simulations</a>
<ol style="list-style-type: decimal">
<li><a href="#pars_net">Parameterization</a></li>
<li><a href="#init_pn_net">Initialization of the Petri Net</a></li>
<li><a href="#equilibria_haz_net">Equilibrium Conditions and Hazard Functions</a></li>
<li>
<a href="#sim_net">Simulation of Fully Specified SPN Model</a>
<ol style="list-style-type: decimal">
<li><a href="#soln_ode_net">Deterministic: ODE Solutions</a></li>
<li><a href="#soln_cle_net">Stochastic: CLE Solutions</a></li>
</ol>
</li>
</ol>
</li>
<li><a href="#ref">References</a></li>
</ol>
<div id="preface" class="section level3">
<h3 class="hasAnchor">
<a href="#preface" class="anchor"></a>Preface</h3>
<p>This vignette describes the <strong>SEIR</strong> (Susceptible-Exposed-Infectious-Recovered) human model of epidemiological dynamics. It is intended that readers are already familiar with the content in the vignettes <a href="epi-node.html">“MGDrivE2: One Node Epidemiological Dynamics”</a> and <a href="epi-network.html">“MGDrivE2: Metapopulation Network Epidemiological Dynamics”</a>, as this vignette primarily describes the coupling of the <strong>SEIR</strong> human model to the system. The <strong>SEIR</strong> model is appropriate for strongly immunizing diseases (such as Yellow fever or Japanese Encephalitis) which also have a latent period (<strong>E</strong>). The <strong>E</strong> state represents the time needed for the pathogen to colonize and replicate within the host before the host becomes infectious to mosquitoes. This time where an individual is infected but not infected is called the <em>latent</em> period, or sometimes, the <em>exposed</em> period (Martcheva 2015). Because this vignette assumes familiarity with the other vignettes, we will be brief about any parts of setting up the simulation not specific to the <strong>SEIR</strong> human model.</p>
<p>We start by loading the <strong>MGDrivE2</strong> package, as well as the <strong>MGDrivE</strong> package for access to inheritance cubes, <strong>ggplot2</strong> for graphical analysis, and <strong>Matrix</strong> for sparse matrices used in migration. We will use the basic cube to simulate Mendelian inheritance for this example.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># simulation functions</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://marshalllab.github.io/MGDrivE/">MGDrivE2</a></span><span class="op">)</span>
<span class="co">#&gt; Loading MGDrivE2: Mosquito Gene Drive Explorer Version 2</span>
<span class="co"># inheritance patterns</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://marshalllab.github.io/MGDrivE/">MGDrivE</a></span><span class="op">)</span>
<span class="co">#&gt; Loading MGDrivE: Mosquito Gene Drive Explorer</span>
<span class="co"># plotting</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="co"># sparse migration</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://Matrix.R-forge.R-project.org/">Matrix</a></span><span class="op">)</span>

<span class="co"># basic inheritance pattern</span>
<span class="va">cube</span> <span class="op">&lt;-</span> <span class="fu">MGDrivE</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MGDrivE/man/cubeMendelian.html">cubeMendelian</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="node" class="section level1">
<h1 class="hasAnchor">
<a href="#node" class="anchor"></a>One Node Simulations</h1>
<p>The first section of this vignette describes how to simulate a coupled <strong>SEI-SEIR</strong> mosquito-human model within a single node.</p>
<div id="pars_node" class="section level2">
<h2 class="hasAnchor">
<a href="#pars_node" class="anchor"></a>Parameterization</h2>
<p>The majority of parameters are concerned with the genetic and mosquito lifecycle model, as used in the <strong>SEI-SIS</strong> model, so the setup of the <strong>SIS-SEIR</strong> model is nearly identical, with the addition of a single parameter, <code>delta</code>, the inverse duration of the latent state (the dwell time in <strong>E</strong>). We consider a situation where an equilibrium population of 1000 female mosquitoes exists. For definition of the epidemiological parameters, please see the vignette <a href="epi-node.html">“MGDrivE2: One Node Epidemiological Dynamics”</a> and <a href="lifecycle-node.html">“MGDrivE2: One Node Lifecycle Dynamics”</a> for the entomological (lifecycle) parameters.</p>
<p>Additionally, we set the simulation time to 300 days and store output from each day.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># entomological and epidemiological parameters</span>
<span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="co"># lifecycle parameters</span>
  qE <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">4</span>,
  nE <span class="op">=</span> <span class="fl">2</span>,
  qL <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">3</span>,
  nL <span class="op">=</span> <span class="fl">3</span>,
  qP <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">6</span>,
  nP <span class="op">=</span> <span class="fl">2</span>,
  muE <span class="op">=</span> <span class="fl">0.05</span>,
  muL <span class="op">=</span> <span class="fl">0.15</span>,
  muP <span class="op">=</span> <span class="fl">0.05</span>,
  muF <span class="op">=</span> <span class="fl">0.09</span>,
  muM <span class="op">=</span> <span class="fl">0.09</span>,
  beta <span class="op">=</span> <span class="fl">16</span>,
  nu <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">4</span><span class="op">/</span><span class="fl">24</span><span class="op">)</span>,
  <span class="co"># epidemiological parameters</span>
  NH <span class="op">=</span> <span class="fl">250</span>,
  X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, <span class="co"># 0% disease incidence</span>
  NFX <span class="op">=</span> <span class="fl">1000</span>,
  f <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">3</span>,
  Q <span class="op">=</span> <span class="fl">0.9</span>,
  b <span class="op">=</span> <span class="fl">0.55</span>,
  c <span class="op">=</span> <span class="fl">0.15</span>,
  delta <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">5</span>,
  r <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">14</span>,
  muH <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">62</span><span class="op">*</span><span class="fl">365</span><span class="op">)</span>,
  qEIP <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">11</span>,
  nEIP <span class="op">=</span> <span class="fl">3</span>
<span class="op">)</span>

<span class="co"># simulation parameters</span>
<span class="va">tmax</span> <span class="op">&lt;-</span> <span class="fl">250</span>
<span class="va">dt</span> <span class="op">&lt;-</span> <span class="fl">1</span></code></pre></div>
<p>Next, we need to augment the cube with genotype specific transmission efficiencies; <code>b</code> and <code>c</code>, the mosquito to human and human to mosquito transmission efficiencies. We assume that transmission from human to mosquito is not impacted in modified mosquitoes, but mosquito to human transmission is significantly reduced in modified mosquitoes. For detailed descriptions of these parameters for modelling malaria transmission, see Smith &amp; McKenzie (2004) for extensive discussion.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># augment the cube with RM transmission parameters</span>
<span class="va">cube</span><span class="op">$</span><span class="va">c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span>object <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">theta</span><span class="op">$</span><span class="va">c</span>, times <span class="op">=</span> <span class="va">cube</span><span class="op">$</span><span class="va">genotypesN</span><span class="op">)</span>, nm <span class="op">=</span> <span class="va">cube</span><span class="op">$</span><span class="va">genotypesID</span><span class="op">)</span>
<span class="va">cube</span><span class="op">$</span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"AA"</span> <span class="op">=</span> <span class="va">theta</span><span class="op">$</span><span class="va">b</span>, <span class="st">"Aa"</span> <span class="op">=</span> <span class="fl">0.35</span>, <span class="st">"aa"</span> <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></code></pre></div>
</div>
<div id="init_pn_node" class="section level2">
<h2 class="hasAnchor">
<a href="#init_pn_node" class="anchor"></a>Initialization of the Petri Net</h2>
<p>Just like the <strong>SEI-SIS</strong> disease transmission model, the <strong>SIS-SEIR</strong> sits “on top” of the existing <strong>MGDrivE2</strong> structure. The only difference between these two models are the human dynamics. See the <a href="epi-node.html">“MGDrivE2: One Node Epidemiological Dynamics”</a> vignette for more details about how this is done.</p>
<p>With the parameters defined, we use <strong>SIS-SEIR</strong> model specific functions to setup the places and transitions in the Petri Net.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Places and transitions</span>
<span class="va">SPN_P</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spn_P_epiSEIR_node.html">spn_P_epiSEIR_node</a></span><span class="op">(</span>params <span class="op">=</span> <span class="va">theta</span>, cube <span class="op">=</span> <span class="va">cube</span><span class="op">)</span>
<span class="va">SPN_T</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spn_T_epiSEIR_node.html">spn_T_epiSEIR_node</a></span><span class="op">(</span>spn_P <span class="op">=</span> <span class="va">SPN_P</span>, params <span class="op">=</span> <span class="va">theta</span>, cube <span class="op">=</span> <span class="va">cube</span><span class="op">)</span>

<span class="co"># Stoichiometry matrix</span>
<span class="va">S</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spn_S.html">spn_S</a></span><span class="op">(</span>spn_P <span class="op">=</span> <span class="va">SPN_P</span>, spn_T <span class="op">=</span> <span class="va">SPN_T</span><span class="op">)</span></code></pre></div>
</div>
<div id="equilibria_haz_node" class="section level2">
<h2 class="hasAnchor">
<a href="#equilibria_haz_node" class="anchor"></a>Equilibrium Conditions and Hazard Functions</h2>
<p>Once the initial markings of the Petri Net are setup, we can combine them with the parameters defined above to calculate the population distribution, at equilibrium, and the initial conditions.</p>
<p>It should be noted that for realistic parameter values, this model only has a non-trivial equilibrium when <span class="math inline">\(\mu_{H} &lt; \frac{\mu_{H} \cdot N_{H} - r \cdot I_{H}}{I_{H}}\)</span>, which results in extremely unrealistic (short) lifespans. The other two equilibrium points are the trivial disease free equilibrium when <span class="math inline">\(\lambda_{H}=0\)</span> and the normal <span class="math inline">\((\lambda_{H} &gt; 0)\)</span> case when <span class="math inline">\(R_{H}(\infty)\rightarrow N_{H}\)</span>, that is, for realistic values of parameters, all surviving individuals will become infected. For that reason we do not explicitly calculate the endemic equilibrium (where <span class="math inline">\(\lambda_{H} = a \cdot b \cdot \frac{1}{N_{H}} \cdot I_{V}\)</span> is the force of infection on humans). In general the SEIR human model should be used to evaluate the impact of gene drive interventions on one-off <em>epidemic</em> situations (e.g.; does releasing large numbers of modified mosquitoes 10 days after initial cases appear make a significant difference in final outcome), rather than for investigating <em>endemic</em> diseases, which require more complex models with waning immunity.</p>
<p>The function <code><a href="../reference/equilibrium_SEI_SEIR.html">equilibrium_SEI_SEIR()</a></code> calculates the equilibrium distribution of female mosquitoes across <strong>SEI</strong> stages, based on human populations and force-of-infection, then calculates all other equilibria. We set the logistic form for larval density-dependence in these examples by specify <code>log_dd = TRUE</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># SEI mosquitoes and SEIR humans equilibrium</span>
<span class="co">#  outputs required parameters in the named list "params"</span>
<span class="co">#  outputs initial equilibrium for adv users, "init</span>
<span class="co">#  outputs properly filled initial markings, "M0"</span>
<span class="va">initialCons</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/equilibrium_SEI_SEIR.html">equilibrium_SEI_SEIR</a></span><span class="op">(</span>params <span class="op">=</span> <span class="va">theta</span>, log_dd <span class="op">=</span> <span class="cn">TRUE</span>, spn_P <span class="op">=</span> <span class="va">SPN_P</span>,
                                    cube <span class="op">=</span> <span class="va">cube</span><span class="op">)</span></code></pre></div>
<p>Finally, we make the hazard functions for the ODE approximation and the discrete stochastic model.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># approximate hazards for continous approximation</span>
<span class="va">approx_hazards</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spn_hazards.html">spn_hazards</a></span><span class="op">(</span>spn_P <span class="op">=</span> <span class="va">SPN_P</span>, spn_T <span class="op">=</span> <span class="va">SPN_T</span>, cube <span class="op">=</span> <span class="va">cube</span>,
                              params <span class="op">=</span> <span class="va">initialCons</span><span class="op">$</span><span class="va">params</span>, type <span class="op">=</span> <span class="st">"SEIR"</span>,
                              log_dd <span class="op">=</span> <span class="cn">TRUE</span>, exact <span class="op">=</span> <span class="cn">FALSE</span>, tol <span class="op">=</span> <span class="fl">1e-8</span>,
                              verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># exact hazards for integer-valued state space</span>
<span class="va">exact_hazards</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spn_hazards.html">spn_hazards</a></span><span class="op">(</span>spn_P <span class="op">=</span> <span class="va">SPN_P</span>, spn_T <span class="op">=</span> <span class="va">SPN_T</span>, cube <span class="op">=</span> <span class="va">cube</span>,
                             params <span class="op">=</span> <span class="va">initialCons</span><span class="op">$</span><span class="va">params</span>, type <span class="op">=</span> <span class="st">"SEIR"</span>,
                             log_dd <span class="op">=</span> <span class="cn">TRUE</span>, exact <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
</div>
<div id="sim_node" class="section level2">
<h2 class="hasAnchor">
<a href="#sim_node" class="anchor"></a>Simulation of Fully Specified SPN Model</h2>
<p>In order to simulate an epidemic, we will introduce 100 exposed humans at day 5. We will assume that by day 25 the decision is made to release modified mosquitoes. Five releases are preformed every other day. Remember, it is critically important that <strong>the event names match a place name</strong> in the simulation. The simulation function checks this and will throw an error if the event name does not exist as a place in the simulation. This format is used in <strong>MGDrivE2</strong> for consistency with solvers in <code>deSolve</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># releases</span>
<span class="va">r_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">25</span>, length.out <span class="op">=</span> <span class="fl">5</span>, by <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="va">r_size</span> <span class="op">&lt;-</span> <span class="fl">50</span>
<span class="va">m_events</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="st">"var"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"F_"</span>, <span class="va">cube</span><span class="op">$</span><span class="va">releaseType</span>, <span class="st">"_"</span>, <span class="va">cube</span><span class="op">$</span><span class="va">wildType</span>, <span class="st">"_S"</span><span class="op">)</span>,
                       <span class="st">"time"</span> <span class="op">=</span> <span class="va">r_times</span>,
                       <span class="st">"value"</span> <span class="op">=</span> <span class="va">r_size</span>,
                       <span class="st">"method"</span> <span class="op">=</span> <span class="st">"add"</span>,
                       stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="va">h_events</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="st">"var"</span> <span class="op">=</span> <span class="st">"H_E"</span>,
                       <span class="st">"time"</span> <span class="op">=</span> <span class="fl">5</span>,
                       <span class="st">"value"</span> <span class="op">=</span> <span class="fl">100</span>,
                       <span class="st">"method"</span> <span class="op">=</span> <span class="st">"add"</span>,
                       stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="va">events</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">m_events</span>, <span class="va">h_events</span><span class="op">)</span></code></pre></div>
<div id="soln_ode_node" class="section level3">
<h3 class="hasAnchor">
<a href="#soln_ode_node" class="anchor"></a>Deterministic: ODE Solutions</h3>
<p>As in the <a href="lifecycle-node.html">“MGDrivE2: One Node Lifecycle Dynamics”</a> vignette, we will first numerically simulate the mean-field ODE approximation to the stochastic trajectory, using the approximate hazards suitable for continuous-state approximation (see <code>?spn_hazards()</code>). We then look at the disease dynamics in humans and female mosquitoes.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># run deterministic simulation</span>
<span class="va">ODE_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_trajectory_R.html">sim_trajectory_R</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">initialCons</span><span class="op">$</span><span class="va">M0</span>, tmax <span class="op">=</span> <span class="va">tmax</span>, dt <span class="op">=</span> <span class="va">dt</span>, S <span class="op">=</span> <span class="va">S</span>,
                            hazards <span class="op">=</span> <span class="va">approx_hazards</span>, sampler <span class="op">=</span> <span class="st">"ode"</span>, method <span class="op">=</span> <span class="st">"lsoda"</span>,
                            events <span class="op">=</span> <span class="va">events</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># summarize females/humans by genotype</span>
<span class="va">ODE_female</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_females_epi.html">summarize_females_epi</a></span><span class="op">(</span>out <span class="op">=</span> <span class="va">ODE_out</span><span class="op">$</span><span class="va">state</span>,spn_P <span class="op">=</span> <span class="va">SPN_P</span><span class="op">)</span>
<span class="va">ODE_humans</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_humans_epiSEIR.html">summarize_humans_epiSEIR</a></span><span class="op">(</span>out <span class="op">=</span> <span class="va">ODE_out</span><span class="op">$</span><span class="va">state</span><span class="op">)</span>

<span class="co"># add species for plotting</span>
<span class="va">ODE_female</span><span class="op">$</span><span class="va">species</span> <span class="op">&lt;-</span> <span class="st">"Mosquitoes"</span>
<span class="va">ODE_humans</span><span class="op">$</span><span class="va">species</span> <span class="op">&lt;-</span> <span class="st">"Humans"</span>

<span class="co"># plot</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">ODE_female</span>, <span class="va">ODE_humans</span><span class="op">)</span> <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">genotype</span>, linetype <span class="op">=</span> <span class="va">inf</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">species</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"SPN: ODE solution"</span><span class="op">)</span></code></pre></div>
<p><img src="epi-SEIR_files/figure-html/unnamed-chunk-9-1.png" width="691.2"></p>
<p>We see the initial influx of humans with latent infections, then the quick spread until most of the population has been infected and recovers. However, only a small portion of the mosquito population gets infected and transmits disease. We see the release of modified female mosquitoes at <code>time = 25</code>, and their quick spread into the population. As more humans enter the recovered state, and do not transmit disease anymore, we see the amount of infected mosquitoes decline as well.</p>
</div>
<div id="soln_tau_node" class="section level3">
<h3 class="hasAnchor">
<a href="#soln_tau_node" class="anchor"></a>Stochastic: Tau-leaping Solutions</h3>
<p>As a further example, we run a single stochastic realization of the same simulation, using the <code>tau</code> sampler with <span class="math inline">\(\Delta t = 0.2\)</span>, approximating 5 jumps per day, and plotting the same output for comparison.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># delta t</span>
<span class="va">dt_stoch</span> <span class="op">&lt;-</span> <span class="fl">0.2</span>

<span class="co"># run tau-leaping simulation</span>
<span class="va">PTS_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_trajectory_R.html">sim_trajectory_R</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">initialCons</span><span class="op">$</span><span class="va">M0</span>, tmax <span class="op">=</span> <span class="va">tmax</span>, dt <span class="op">=</span> <span class="va">dt</span>,
                            dt_stoch <span class="op">=</span> <span class="va">dt_stoch</span>, S <span class="op">=</span> <span class="va">S</span>, hazards <span class="op">=</span> <span class="va">exact_hazards</span>,
                            sampler <span class="op">=</span> <span class="st">"tau"</span>, events <span class="op">=</span> <span class="va">events</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># summarize females/humans by genotype</span>
<span class="va">PTS_female</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_females_epi.html">summarize_females_epi</a></span><span class="op">(</span>out <span class="op">=</span> <span class="va">PTS_out</span><span class="op">$</span><span class="va">state</span>,spn_P <span class="op">=</span> <span class="va">SPN_P</span><span class="op">)</span>
<span class="va">PTS_humans</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_humans_epiSEIR.html">summarize_humans_epiSEIR</a></span><span class="op">(</span>out <span class="op">=</span> <span class="va">PTS_out</span><span class="op">$</span><span class="va">state</span><span class="op">)</span>

<span class="co"># add species for plotting</span>
<span class="va">PTS_female</span><span class="op">$</span><span class="va">species</span> <span class="op">&lt;-</span> <span class="st">"Mosquitoes"</span>
<span class="va">PTS_humans</span><span class="op">$</span><span class="va">species</span> <span class="op">&lt;-</span> <span class="st">"Humans"</span>

<span class="co"># plot</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">PTS_female</span>, <span class="va">PTS_humans</span><span class="op">)</span> <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">genotype</span>, linetype <span class="op">=</span> <span class="va">inf</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">species</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"SPN: Tau-leaping Approximation"</span><span class="op">)</span></code></pre></div>
<p><img src="epi-SEIR_files/figure-html/unnamed-chunk-10-1.png" width="691.2"></p>
<p>Encouragingly, we see very similar dynamics from this stochastic realization as we saw in the ODE solution. This implies that <span class="math inline">\(\Delta t = 0.2\)</span> is a good approximation, though one should do many more repetitions before drawing any conclusions.</p>
</div>
</div>
</div>
<div id="net" class="section level1">
<h1 class="hasAnchor">
<a href="#net" class="anchor"></a>Metapopulation Network Simulations</h1>
<p>The second section of this vignette describes how to simulate a coupled <strong>SEI-SEIR</strong> mosquito-human model in a metapopulation network. This section largely follows the vignette <a href="epi-network.html">“MGDrivE2: Metapopulation Network Epidemiological Dynamics”</a>.</p>
<div id="pars_net" class="section level2">
<h2 class="hasAnchor">
<a href="#pars_net" class="anchor"></a>Parameterization</h2>
<p>To setup a three-node metapopulation network, with 1000 females in the mosquito-only node, 500 adult female mosquitoes and 250 humans in the shared location, and 250 humans in the human-only node, we first update the parameter object (<code>theta</code>) to reflect the new populations. We then set the simulation time to 300 days, but store output every other day this time.</p>
<p>We will be using the same inheritance cube for these simulations, so none of the parameters for that need updated.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 3-population entomological and epidemiological parameters</span>
<span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="co"># lifecycle parameters</span>
  qE <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">4</span>,
  nE <span class="op">=</span> <span class="fl">2</span>,
  qL <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">3</span>,
  nL <span class="op">=</span> <span class="fl">3</span>,
  qP <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">6</span>,
  nP <span class="op">=</span> <span class="fl">2</span>,
  muE <span class="op">=</span> <span class="fl">0.05</span>,
  muL <span class="op">=</span> <span class="fl">0.15</span>,
  muP <span class="op">=</span> <span class="fl">0.05</span>,
  muF <span class="op">=</span> <span class="fl">0.09</span>,
  muM <span class="op">=</span> <span class="fl">0.09</span>,
  beta <span class="op">=</span> <span class="fl">16</span>,
  <span class="co"># epidemiological parameters</span>
  NH <span class="op">=</span> <span class="fl">250</span>,
  X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,
  NFX <span class="op">=</span> <span class="fl">500</span>, <span class="co"># needed if any X[ ,3] == 0</span>
  f <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">3</span>,
  Q <span class="op">=</span> <span class="fl">0.9</span>,
  b <span class="op">=</span> <span class="fl">0.55</span>,
  c <span class="op">=</span> <span class="fl">0.15</span>,
  delta <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">5</span>,
  nu <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">5</span>,
  r <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">14</span>,
  muH <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">62</span><span class="op">*</span><span class="fl">365</span><span class="op">)</span>,
  qEIP <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">11</span>,
  nEIP <span class="op">=</span> <span class="fl">3</span>
<span class="op">)</span>

<span class="co"># simulation parameters</span>
<span class="va">tmax</span> <span class="op">&lt;-</span> <span class="fl">250</span>
<span class="va">dt</span> <span class="op">&lt;-</span> <span class="fl">2</span></code></pre></div>
</div>
<div id="init_pn_net" class="section level2">
<h2 class="hasAnchor">
<a href="#init_pn_net" class="anchor"></a>Initialization of the Petri Net</h2>
<p>Next, we create the markings for a three-node Petri Net. We specify edges in the movement network separately for humans and mosquitoes (in <code>h_move</code> and <code>m_move</code>, respectively). Humans can move back and forth between the humans-only and both nodes, and mosquitoes between the mosquitoes-only and both nodes. These matrices are needed to generate the set of transitions. For more information, see the <a href="epi-network.html">“MGDrivE2: Metapopulation Network Epidemiological Dynamics”</a> vignette. Once the movement is specified, we can setup the places and transitions for the Petri Net.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># nodetypes</span>
<span class="va">node_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"h"</span>, <span class="st">"b"</span>, <span class="st">"m"</span><span class="op">)</span>
<span class="va">num_nodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">node_list</span><span class="op">)</span>

<span class="co"># human movement</span>
<span class="va">h_move</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="cn">FALSE</span>, nrow <span class="op">=</span> <span class="va">num_nodes</span>, ncol <span class="op">=</span> <span class="va">num_nodes</span>,
                 dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">node_list</span>, <span class="va">node_list</span><span class="op">)</span><span class="op">)</span>
<span class="va">h_move</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span>
<span class="va">h_move</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span>

<span class="co"># mosquito movement</span>
<span class="va">m_move</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="cn">FALSE</span>, nrow <span class="op">=</span> <span class="va">num_nodes</span>, ncol <span class="op">=</span> <span class="va">num_nodes</span>,
                 dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">node_list</span>, <span class="va">node_list</span><span class="op">)</span><span class="op">)</span>
<span class="va">m_move</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span>
<span class="va">m_move</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span>

<span class="co"># Places and transitions</span>
<span class="va">SPN_P</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spn_P_epiSEIR_network.html">spn_P_epiSEIR_network</a></span><span class="op">(</span>node_list <span class="op">=</span> <span class="va">node_list</span>, params <span class="op">=</span> <span class="va">theta</span>, cube <span class="op">=</span> <span class="va">cube</span><span class="op">)</span>
<span class="va">SPN_T</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spn_T_epiSEIR_network.html">spn_T_epiSEIR_network</a></span><span class="op">(</span>node_list <span class="op">=</span> <span class="va">node_list</span>, spn_P <span class="op">=</span> <span class="va">SPN_P</span>, params <span class="op">=</span> <span class="va">theta</span>,
                               cube <span class="op">=</span> <span class="va">cube</span>, h_move <span class="op">=</span> <span class="va">h_move</span>, m_move <span class="op">=</span> <span class="va">m_move</span><span class="op">)</span>

<span class="co"># Stoichiometry matrix</span>
<span class="va">S</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spn_S.html">spn_S</a></span><span class="op">(</span>spn_P <span class="op">=</span> <span class="va">SPN_P</span>, spn_T <span class="op">=</span> <span class="va">SPN_T</span><span class="op">)</span></code></pre></div>
</div>
<div id="equilibria_haz_net" class="section level2">
<h2 class="hasAnchor">
<a href="#equilibria_haz_net" class="anchor"></a>Equilibrium Conditions and Hazard Functions</h2>
<p>Now that we have set up the structural properties of the Petri Net, we can calculate the population equilibrium, and the initial conditions, from parameters defined earlier ( <a href="#pars_net">theta</a> ). Remember, these are node-by-node equilibria, not an equilibrium over the entire network.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># SEI mosquitoes and SEIR humans equilibrium</span>
<span class="co">#  outputs required parameters in the named list "params"</span>
<span class="co">#  outputs initial equilibrium for adv users, "init</span>
<span class="co">#  outputs properly filled initial markings, "M0"</span>
<span class="va">initialCons</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/equilibrium_SEI_SEIR.html">equilibrium_SEI_SEIR</a></span><span class="op">(</span>params <span class="op">=</span> <span class="va">theta</span>,node_list <span class="op">=</span> <span class="va">node_list</span>,
                                    NF <span class="op">=</span> <span class="fl">1000</span>,
                                    phi<span class="op">=</span><span class="fl">0.5</span>,
                                    NH <span class="op">=</span> <span class="fl">250</span>,
                                    log_dd<span class="op">=</span><span class="cn">TRUE</span>,
                                    spn_P<span class="op">=</span><span class="va">SPN_P</span>,
                                    pop_ratio_Aq<span class="op">=</span><span class="cn">NULL</span>, pop_ratio_F<span class="op">=</span><span class="cn">NULL</span>,
                                    pop_ratio_M<span class="op">=</span><span class="cn">NULL</span>, cube<span class="op">=</span><span class="va">cube</span><span class="op">)</span></code></pre></div>
<p>We’ll make the movement matrices using the same parameters as <a href="epi-network.html">“MGDrivE2: Metapopulation Network Epidemiological Dynamics”</a>. Reminder, for both humans and mosquitoes, the vector of movement rates must be of length equal to the number of nodes in the matrix, and nodes from which no movement is possible (for mosquitoes, human-only nodes and vice versa for humans), should have value <code>NaN</code>. If you have made the logical matrices specifying allowed movement, the following code can help ascertain which elements should be <code>NaN</code>: <code><a href="https://rdrr.io/r/base/apply.html">apply(X = m_move, MARGIN = 1, FUN = Negate(any))</a></code>. Finally we append the movement objects to the vector of parameters <code>initialCons$params</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># calculate movement rates and movement probabilities</span>
<span class="va">gam</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_move_rate.html">calc_move_rate</a></span><span class="op">(</span>mu <span class="op">=</span> <span class="va">initialCons</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">muF</span>, P <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>

<span class="co"># set mosquito movement rates/probabilities</span>
<span class="co">#  mosquitoes exist in nodes 2 and 3, not 1</span>
<span class="va">mr_mosy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NaN</span>, <span class="va">gam</span>, <span class="va">gam</span><span class="op">)</span>
<span class="va">mp_mosy</span> <span class="op">&lt;-</span> <span class="fu">Matrix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/sparseMatrix.html">sparseMatrix</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>, j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span>, x <span class="op">=</span> <span class="fl">1</span>, dims <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">m_move</span><span class="op">)</span><span class="op">)</span>

<span class="co"># set human movement rates/probabilities</span>
<span class="co">#  humans exist in nodes 1 and 2, not 3</span>
<span class="va">mr_human</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">7</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">7</span>, <span class="cn">NaN</span><span class="op">)</span>
<span class="va">mp_human</span> <span class="op">&lt;-</span> <span class="fu">Matrix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/sparseMatrix.html">sparseMatrix</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, x <span class="op">=</span> <span class="fl">1</span>, dims <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">h_move</span><span class="op">)</span><span class="op">)</span>

<span class="co"># put rates and probs into the parameter list</span>
<span class="va">initialCons</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">mosquito_move_rates</span> <span class="op">&lt;-</span> <span class="va">mr_mosy</span>
<span class="va">initialCons</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">mosquito_move_probs</span> <span class="op">&lt;-</span> <span class="va">mp_mosy</span>
<span class="va">initialCons</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">human_move_rates</span> <span class="op">&lt;-</span> <span class="va">mr_human</span>
<span class="va">initialCons</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">human_move_probs</span> <span class="op">&lt;-</span> <span class="va">mp_human</span></code></pre></div>
<p>Now that all the necessary parameters have been added to the named list <code>initialCons$params</code>, we generate the hazard functions, using the function <code><a href="../reference/spn_hazards.html">spn_hazards()</a></code>. By specifying <code>log_dd = TRUE</code>, we use logistic density dependence for these simulations.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># approximate hazards for continous approximation</span>
<span class="va">approx_hazards</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spn_hazards.html">spn_hazards</a></span><span class="op">(</span>spn_P <span class="op">=</span> <span class="va">SPN_P</span>, spn_T <span class="op">=</span> <span class="va">SPN_T</span>, cube <span class="op">=</span> <span class="va">cube</span>,
                              params <span class="op">=</span> <span class="va">initialCons</span><span class="op">$</span><span class="va">params</span> , type <span class="op">=</span> <span class="st">"SEIR"</span>,
                              log_dd <span class="op">=</span> <span class="cn">TRUE</span>, exact <span class="op">=</span> <span class="cn">FALSE</span>, tol <span class="op">=</span> <span class="fl">1e-8</span>,
                              verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
</div>
<div id="sim_net" class="section level2">
<h2 class="hasAnchor">
<a href="#sim_net" class="anchor"></a>Simulation of Fully Specified SPN Model</h2>
<p>In order to simulate an epidemic, we will introduce 100 exposed humans at day 5 into node 1. We will assume that by day 25 the decision is made to release modified mosquitoes, but into node 3 only. Five releases are preformed every other day. This will allow us to see migration between human nodes, and mosquito nodes, before seeing interactions that cause disease dynamics. Remember, it is critically important that <strong>the event names match a place name</strong> in the simulation. The simulation function checks this and will throw an error if the event name does not exist as a place in the simulation. This format is used in <strong>MGDrivE2</strong> for consistency with solvers in <code>deSolve</code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># releases</span>
<span class="va">r_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">25</span>, length.out <span class="op">=</span> <span class="fl">5</span>, by <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="va">r_size</span> <span class="op">&lt;-</span> <span class="fl">50</span>
<span class="va">m_events</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="st">"var"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"F_"</span>, <span class="va">cube</span><span class="op">$</span><span class="va">releaseType</span>, <span class="st">"_"</span>, <span class="va">cube</span><span class="op">$</span><span class="va">wildType</span>, <span class="st">"_S_3"</span><span class="op">)</span>,
                       <span class="st">"time"</span> <span class="op">=</span> <span class="va">r_times</span>,
                       <span class="st">"value"</span> <span class="op">=</span> <span class="va">r_size</span>,
                       <span class="st">"method"</span> <span class="op">=</span> <span class="st">"add"</span>,
                       stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="va">h_events</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="st">"var"</span> <span class="op">=</span> <span class="st">"H_E_1"</span>,
                       <span class="st">"time"</span> <span class="op">=</span> <span class="fl">5</span>,
                       <span class="st">"value"</span> <span class="op">=</span> <span class="fl">100</span>,
                       <span class="st">"method"</span> <span class="op">=</span> <span class="st">"add"</span>,
                       <span class="st">"stringsAsFactors"</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="va">events</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">m_events</span>,  <span class="va">h_events</span><span class="op">)</span></code></pre></div>
<div id="soln_ode_net" class="section level3">
<h3 class="hasAnchor">
<a href="#soln_ode_net" class="anchor"></a>Deterministic: ODE Solutions</h3>
<p>As in the <a href="epi-network.html">“MGDrivE2: Metapopulation Network Epidemiological Dynamics”</a> vignette, we will first numerically simulate the mean-field ODE approximation to the stochastic trajectory, using the approximate hazards suitable for continuous-state approximation (see <code>?spn_hazards()</code>). Additionally, we will plot several aspects of the population using helper functions provided by <strong>MGDrivE2</strong>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># run deterministic simulation</span>
<span class="va">ODE_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_trajectory_R.html">sim_trajectory_R</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">initialCons</span><span class="op">$</span><span class="va">M0</span>, tmax <span class="op">=</span> <span class="va">tmax</span>, dt <span class="op">=</span> <span class="va">dt</span>, S <span class="op">=</span> <span class="va">S</span>,
                            hazards <span class="op">=</span> <span class="va">approx_hazards</span>, sampler <span class="op">=</span> <span class="st">"ode"</span>, method <span class="op">=</span> <span class="st">"lsoda"</span>,
                            events <span class="op">=</span> <span class="va">events</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; Warning in base_events(x0 = x0, events = events, dt = dt): event times do not correspond to a multiple of dt.</span>
<span class="co">#&gt; event times will be rounded up to the nearest time-step!</span>

<span class="co"># summarize aquatic stages by genotype</span>
<span class="va">ODE_e</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_eggs_geno.html">summarize_eggs_geno</a></span><span class="op">(</span>out <span class="op">=</span> <span class="va">ODE_out</span><span class="op">$</span><span class="va">state</span>, spn_P <span class="op">=</span> <span class="va">SPN_P</span><span class="op">)</span>
<span class="va">ODE_l</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_larvae_geno.html">summarize_larvae_geno</a></span><span class="op">(</span>out <span class="op">=</span> <span class="va">ODE_out</span><span class="op">$</span><span class="va">state</span>, spn_P <span class="op">=</span> <span class="va">SPN_P</span><span class="op">)</span>
<span class="va">ODE_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_pupae_geno.html">summarize_pupae_geno</a></span><span class="op">(</span>out <span class="op">=</span> <span class="va">ODE_out</span><span class="op">$</span><span class="va">state</span>, spn_P <span class="op">=</span> <span class="va">SPN_P</span><span class="op">)</span>

<span class="co"># add stage name</span>
<span class="va">ODE_e</span><span class="op">$</span><span class="va">stage</span> <span class="op">&lt;-</span> <span class="st">"Egg"</span>
<span class="va">ODE_l</span><span class="op">$</span><span class="va">stage</span> <span class="op">&lt;-</span> <span class="st">"Larvae"</span>
<span class="va">ODE_p</span><span class="op">$</span><span class="va">stage</span> <span class="op">&lt;-</span> <span class="st">"Pupae"</span>

<span class="co"># plot by genotype</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">ODE_e</span>, <span class="va">ODE_l</span>,<span class="va">ODE_p</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">genotype</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">stage</span> <span class="op">~</span> <span class="va">node</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"SPN: ODE Solution - Genotypes"</span><span class="op">)</span></code></pre></div>
<p><img src="epi-SEIR_files/figure-html/unnamed-chunk-17-1.png" width="691.2"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># summarize aquatic stages by Erlang stage</span>
<span class="va">ODE_e</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_eggs_stage.html">summarize_eggs_stage</a></span><span class="op">(</span>out <span class="op">=</span> <span class="va">ODE_out</span><span class="op">$</span><span class="va">state</span>, spn_P <span class="op">=</span> <span class="va">SPN_P</span><span class="op">)</span>
<span class="va">ODE_l</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_larvae_stage.html">summarize_larvae_stage</a></span><span class="op">(</span>out <span class="op">=</span> <span class="va">ODE_out</span><span class="op">$</span><span class="va">state</span>, spn_P <span class="op">=</span> <span class="va">SPN_P</span><span class="op">)</span>
<span class="va">ODE_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_pupae_stage.html">summarize_pupae_stage</a></span><span class="op">(</span>out <span class="op">=</span> <span class="va">ODE_out</span><span class="op">$</span><span class="va">state</span>, spn_P <span class="op">=</span> <span class="va">SPN_P</span><span class="op">)</span>

<span class="co"># add stage name</span>
<span class="va">ODE_e</span><span class="op">$</span><span class="va">stage</span> <span class="op">&lt;-</span> <span class="st">"Egg"</span>
<span class="va">ODE_l</span><span class="op">$</span><span class="va">stage</span> <span class="op">&lt;-</span> <span class="st">"Larvae"</span>
<span class="va">ODE_p</span><span class="op">$</span><span class="va">stage</span> <span class="op">&lt;-</span> <span class="st">"Pupae"</span>

<span class="co"># plot by Erlang stage</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">ODE_e</span>, <span class="va">ODE_l</span>,<span class="va">ODE_p</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">`Erlang-stage`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">stage</span> <span class="op">~</span> <span class="va">node</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"SPN: ODE Solution - Erlang Dwell Stage"</span><span class="op">)</span></code></pre></div>
<p><img src="epi-SEIR_files/figure-html/unnamed-chunk-18-1.png" width="691.2"></p>
<p>First, notice the warnings about releases. Releases are added to the state vector at the beginning of each scheduled time-point, which implies that the time-points need to match the time-step for storing output. If the releases are not timed with output, the simulation provides the above warning and then shifts them to the nearest, higher time-point.</p>
<p>Looking at both summaries for the aquatic stages, we see the small initial burn-in from the network reaching equilibrium, the distribution between Erlang-stages (primarily stage one), and the significant reduction in population size from density dependent and independent death. Initial egg batches from the released adult females are clearly seen in the first plot, and the effects of density dependence smoothing out that population increase can be seen in the second. We can also observe the slow migration of adults from node 3 to node 2, and the concomitant increase in heterozygous individuals in node 2.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># summarize females/males</span>
<span class="va">ODE_f</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_females_epi.html">summarize_females_epi</a></span><span class="op">(</span>out <span class="op">=</span> <span class="va">ODE_out</span><span class="op">$</span><span class="va">state</span>, spn_P <span class="op">=</span> <span class="va">SPN_P</span><span class="op">)</span>
<span class="va">ODE_m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_males.html">summarize_males</a></span><span class="op">(</span>out <span class="op">=</span> <span class="va">ODE_out</span><span class="op">$</span><span class="va">state</span><span class="op">)</span>

<span class="co"># add sex for plotting</span>
<span class="va">ODE_f</span><span class="op">$</span><span class="va">sex</span> <span class="op">&lt;-</span> <span class="st">"Female"</span>
<span class="va">ODE_m</span><span class="op">$</span><span class="va">sex</span> <span class="op">&lt;-</span> <span class="st">"Male"</span>
<span class="va">ODE_m</span><span class="op">$</span><span class="va">inf</span> <span class="op">&lt;-</span> <span class="st">"S"</span>

<span class="co"># plot adults</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">ODE_f</span>, <span class="va">ODE_m</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">genotype</span>, linetype <span class="op">=</span> <span class="va">inf</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">~</span> <span class="va">node</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"SPN: ODE Solution - Adult Stages"</span><span class="op">)</span></code></pre></div>
<p><img src="epi-SEIR_files/figure-html/unnamed-chunk-19-1.png" width="691.2"></p>
<p>It is easy to read the genotypes from this plot, the initial releases of adult females, their migration from node 3 to node 2, and the spread of alleles into adult males from the offspring. However, it is more difficult to see the infection dynamics in this plot. That is because there are so few infected mosquitoes, due to the low amount of infected humans, and the steady progression from infected to recovered and thus lack of humans to transmit disease to mosquitoes. Additionally, we see that males do not not participate in disease transmission dynamics, and we will not plot them hereafter.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># summarize females/humans by genotype</span>
<span class="va">ODE_female</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_females_epi.html">summarize_females_epi</a></span><span class="op">(</span>out <span class="op">=</span> <span class="va">ODE_out</span><span class="op">$</span><span class="va">state</span>, spn_P <span class="op">=</span> <span class="va">SPN_P</span><span class="op">)</span>
<span class="va">ODE_humans</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_humans_epiSEIR.html">summarize_humans_epiSEIR</a></span><span class="op">(</span>out <span class="op">=</span> <span class="va">ODE_out</span><span class="op">$</span><span class="va">state</span><span class="op">)</span>

<span class="co"># plot</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">ODE_female</span>,<span class="va">ODE_humans</span><span class="op">)</span> <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">genotype</span>, linetype <span class="op">=</span> <span class="va">inf</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">node</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"SPN: ODE Solution"</span><span class="op">)</span></code></pre></div>
<p><img src="epi-SEIR_files/figure-html/unnamed-chunk-20-1.png" width="691.2"></p>
<p>Here, we observe disease dynamics in humans and adult female mosquitoes. We see the influx of humans with latent infections at the beginning, in node 1, and then the release of modified mosquitoes in node 3, and their spread into node 2. Notice, since migration is faster than recovery, the disease finds an intermediate equilibrium, where the transmission in node 2 keeps a fraction of humans infected, while a small fraction of them recover.</p>
</div>
<div id="soln_cle_net" class="section level3">
<h3 class="hasAnchor">
<a href="#soln_cle_net" class="anchor"></a>Stochastic: CLE Solutions</h3>
<p>As a further example, we run a single stochastic realization of the same simulation, using the <code>cle</code> sampler with <span class="math inline">\(\Delta t = 0.1\)</span>, approximating 10 jumps per day. We will only plot the adult female mosquitoes and humans to see the infection dynamics.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># delta t</span>
<span class="va">dt_stoch</span> <span class="op">&lt;-</span> <span class="fl">0.1</span>

<span class="co"># run cle simulation</span>
<span class="va">CLE_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_trajectory_R.html">sim_trajectory_R</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">initialCons</span><span class="op">$</span><span class="va">M0</span>, tmax <span class="op">=</span> <span class="va">tmax</span>, dt <span class="op">=</span> <span class="va">dt</span>,
                            dt_stoch <span class="op">=</span> <span class="va">dt_stoch</span>, S <span class="op">=</span> <span class="va">S</span>, hazards <span class="op">=</span> <span class="va">approx_hazards</span>,
                            sampler <span class="op">=</span> <span class="st">"cle"</span>, events <span class="op">=</span> <span class="va">events</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; Warning in base_events(x0 = x0, events = events, dt = dt): event times do not correspond to a multiple of dt.</span>
<span class="co">#&gt; event times will be rounded up to the nearest time-step!</span>

<span class="co"># summarize females/humans by genotype</span>
<span class="va">CLE_female</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_females_epi.html">summarize_females_epi</a></span><span class="op">(</span>out <span class="op">=</span> <span class="va">CLE_out</span><span class="op">$</span><span class="va">state</span>, spn_P <span class="op">=</span> <span class="va">SPN_P</span><span class="op">)</span>
<span class="va">CLE_humans</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_humans_epiSEIR.html">summarize_humans_epiSEIR</a></span><span class="op">(</span>out <span class="op">=</span> <span class="va">CLE_out</span><span class="op">$</span><span class="va">state</span><span class="op">)</span>

<span class="co"># plot</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">CLE_female</span>,<span class="va">CLE_humans</span><span class="op">)</span> <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">genotype</span>, linetype <span class="op">=</span> <span class="va">inf</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">node</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"SPN: CLE Approximation"</span><span class="op">)</span></code></pre></div>
<p><img src="epi-SEIR_files/figure-html/unnamed-chunk-21-1.png" width="691.2"></p>
<p>Again, acknowledge the warning about release times. This is not a problem, just a warning that times will be shifted in comparison to how they were set.</p>
<p>We plot the same view of human and mosquito disease dynamics, for one stochastic realization, so that we may compare with the ODE solution above. This time, there are very different dynamics. The disease steadily transmits through the population, so that when we cut the simulations short, it is clear that eventually most of the population will be in a recovered state and few will remain susceptible. In this instance, we would expect the disease to eventually die out. For a proper analysis, one should run this simulations longer (to equilibrium, we cut them short for time considerations), and perform multiple repetitions.</p>
</div>
<div id="ref" class="section level3">
<h3 class="hasAnchor">
<a href="#ref" class="anchor"></a>References</h3>
<ul>
<li><p>Martcheva, Maia. An introduction to mathematical epidemiology. Vol. 61. New York: Springer, 2015.</p></li>
<li><p>Smith, D. L., &amp; McKenzie, F. E. (2004). Statics and dynamics of malaria infection in Anopheles mosquitoes. Malaria journal, 3(1), 13.</p></li>
</ul>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="http://www.slwu89.com">Sean L. Wu</a>, <a href="https://github.com/GilChrist19">Jared B. Bennett</a>, <a href="https://www.marshalllab.com">John M. Marshall</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
