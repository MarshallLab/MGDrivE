<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MGDrivE2: Metapopulation Network Epidemiological Dynamics • MGDrivE2</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="MGDrivE2: Metapopulation Network Epidemiological Dynamics">
<meta property="og:description" content="MGDrivE2">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MGDrivE2</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/advanced_topics.html">MGDrivE2: Advanced Topics</a>
    </li>
    <li>
      <a href="../articles/epi-SEIR.html">MGDrivE2: SEIR Epidemiological Dynamics</a>
    </li>
    <li>
      <a href="../articles/epi-network.html">MGDrivE2: Metapopulation Network Epidemiological Dynamics</a>
    </li>
    <li>
      <a href="../articles/epi-node.html">MGDrivE2: One Node Epidemiological Dynamics</a>
    </li>
    <li>
      <a href="../articles/inhomogeneous.html">MGDrivE2: Simulation of Time-inhomogeneous Stochastic Processes (Seasonality)</a>
    </li>
    <li>
      <a href="../articles/lifecycle-network.html">MGDrivE2: Metapopulation Network Lifecycle Dynamics</a>
    </li>
    <li>
      <a href="../articles/lifecycle-node.html">MGDrivE2: One Node Lifecycle Dynamics</a>
    </li>
    <li>
      <a href="../articles/output-storage.html">MGDrivE2: Data Storage and Analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/MarshallLab/MGDrivE/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="epi-network_files/header-attrs-2.5/header-attrs.js"></script><link href="epi-network_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="epi-network_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>MGDrivE2: Metapopulation Network Epidemiological Dynamics</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/MarshallLab/MGDrivE/blob/master/vignettes/epi-network.Rmd"><code>vignettes/epi-network.Rmd</code></a></small>
      <div class="hidden name"><code>epi-network.Rmd</code></div>

    </div>

    
    
<div id="table-of-contents" class="section level2">
<h2 class="hasAnchor">
<a href="#table-of-contents" class="anchor"></a>Table of Contents</h2>
<ol style="list-style-type: decimal">
<li><a href="#pars">Parameterization</a></li>
<li><a href="#init_spn">Initialization of the Petri Net</a></li>
<li><a href="#equilibria_haz">Equilibrium Conditions and Hazard Functions</a></li>
<li>
<a href="#sim">Simulation of Fully Specified SPN Model</a>
<ol style="list-style-type: decimal">
<li><a href="#soln_ode">Deterministic: ODE Solutions</a></li>
<li><a href="#soln_tau">Stochastic: Tau-leaping Solutions</a></li>
</ol>
</li>
<li><a href="#ref">References</a></li>
</ol>
<div id="preface" class="section level3">
<h3 class="hasAnchor">
<a href="#preface" class="anchor"></a>Preface</h3>
<p>This vignette describes how to use the facilities provided by <strong>MGDrivE2</strong> to run simulations of joint gene drive and epidemiological (specifically an <strong>SIS</strong> model) dynamics on metapopulation networks; nodes may contain humans only (such as high altitude regions), mosquitoes only (such as uninhabited swamp), or humans and mosquitoes (inhabited regions with breeding mosquito populations). Infection events (mosquito to human or human to mosquito) can only occur in nodes where both humans and mosquitoes are allowed to interact. For more information on how these models are coupled, see the <a href="epi-node.html">“MGDrivE2: One Node Epidemiological Dynamics”</a> vignette.</p>
<p>We start by loading the <strong>MGDrivE2</strong> package, as well as the <strong>MGDrivE</strong> package for access to inheritance cubes, <strong>ggplot2</strong> for graphical analysis, and <strong>Matrix</strong> for sparse matrices used in migration. We will use the basic cube to simulate Mendelian inheritance for this example.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># simulation functions</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://marshalllab.github.io/MGDrivE/">MGDrivE2</a></span><span class="op">)</span>
<span class="co">#&gt; Loading MGDrivE2: Mosquito Gene Drive Explorer Version 2</span>
<span class="co"># inheritance patterns</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://marshalllab.github.io/MGDrivE/">MGDrivE</a></span><span class="op">)</span>
<span class="co">#&gt; Loading MGDrivE: Mosquito Gene Drive Explorer</span>
<span class="co"># plotting</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="co"># sparse migration</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://Matrix.R-forge.R-project.org/">Matrix</a></span><span class="op">)</span>

<span class="co"># basic inheritance pattern</span>
<span class="va">cube</span> <span class="op">&lt;-</span> <span class="fu">MGDrivE</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MGDrivE/man/cubeMendelian.html">cubeMendelian</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="pars" class="section level2">
<h2 class="hasAnchor">
<a href="#pars" class="anchor"></a>Parameterization</h2>
<p>Before setting up the simulations, we define the parameters used to calculate equilibrium populations and generate hazards during the simulation. We define the list of entomological and epidemiological parameters, <code>theta</code>. For a table of epidemiological parameter descriptions, see the <a href="epi-node.html">“MGDrivE2: One Node Epidemiological Dynamics”</a> vignette.</p>
<p>The chunk of code below defines parameters used to setup the <a href="#init_spn">Petri Net</a> and for calculating the <a href="#equilibria_haz">equilibria and initial conditions</a>.</p>
<p>Additionally, we specify a total simulation time of 300 days, and to demonstrate additional functionality, we store output every other day.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># entomological and epidemiological parameters</span>
<span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="co"># lifecycle parameters</span>
  qE <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">4</span>,
  nE <span class="op">=</span> <span class="fl">2</span>,
  qL <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">3</span>,
  nL <span class="op">=</span> <span class="fl">3</span>,
  qP <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">6</span>,
  nP <span class="op">=</span> <span class="fl">2</span>,
  muE <span class="op">=</span> <span class="fl">0.05</span>,
  muL <span class="op">=</span> <span class="fl">0.15</span>,
  muP <span class="op">=</span> <span class="fl">0.05</span>,
  muF <span class="op">=</span> <span class="fl">0.09</span>,
  muM <span class="op">=</span> <span class="fl">0.09</span>,
  beta <span class="op">=</span> <span class="fl">16</span>,
  nu <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">4</span><span class="op">/</span><span class="fl">24</span><span class="op">)</span>,
  <span class="co"># epidemiological parameters</span>
  NH <span class="op">=</span> <span class="fl">1000</span>,
  X <span class="op">=</span> <span class="fl">0.25</span>,
  f <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">3</span>,
  Q <span class="op">=</span> <span class="fl">0.9</span>,
  b <span class="op">=</span> <span class="fl">0.55</span>,
  c <span class="op">=</span> <span class="fl">0.15</span>,
  r <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">200</span>,
  muH <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">62</span><span class="op">*</span><span class="fl">365</span><span class="op">)</span>,
  qEIP <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">11</span>,
  nEIP <span class="op">=</span> <span class="fl">2</span>
<span class="op">)</span>

<span class="co"># simulation parameters</span>
<span class="va">tmax</span> <span class="op">&lt;-</span> <span class="fl">250</span>
<span class="va">dt</span> <span class="op">&lt;-</span> <span class="fl">2</span></code></pre></div>
<p>We also need to augment the cube with genotype specific transmission efficiencies; this allows simulations of gene drive systems that confer pathogen-refractory characteristics to mosquitoes depending on genotype. The specific parameters we want to attach to the cube are <code>b</code> and <code>c</code>, the mosquito to human and human to mosquito transmission efficiencies. We assume that transmission from human to mosquito is not impacted in modified mosquitoes, but mosquito to human transmission is significantly reduced in modified mosquitoes. For detailed descriptions of these parameters for modelling malaria transmission, see Smith &amp; McKenzie (2004) for extensive discussion.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># augment the cube with RM transmission parameters</span>
<span class="va">cube</span><span class="op">$</span><span class="va">c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span>object <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">theta</span><span class="op">$</span><span class="va">c</span>, times <span class="op">=</span> <span class="va">cube</span><span class="op">$</span><span class="va">genotypesN</span><span class="op">)</span>, nm <span class="op">=</span> <span class="va">cube</span><span class="op">$</span><span class="va">genotypesID</span><span class="op">)</span>
<span class="va">cube</span><span class="op">$</span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"AA"</span> <span class="op">=</span> <span class="va">theta</span><span class="op">$</span><span class="va">b</span>, <span class="st">"Aa"</span> <span class="op">=</span> <span class="fl">0.35</span>, <span class="st">"aa"</span> <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></code></pre></div>
</div>
<div id="init_spn" class="section level2">
<h2 class="hasAnchor">
<a href="#init_spn" class="anchor"></a>Initialization of the Petri Net</h2>
<p>Like previous examples, we begin by constructing the Petri Net (places and transitions). We will make a 3 node metapopulation network; the first node will contain mosquitoes only, a breeding ground outside a city, the second node will contain both humans and mosquitoes, a location at the edge of a city, and the third node will contain only humans, a location deep in the city and far from mosquito breeding grounds. We specify the node types in the character vector <code>node_list</code>; <code>"m"</code> refers to mosquito-only nodes, <code>"h"</code> to human-only nodes, and <code>"b"</code> refers to human and mosquito nodes. It is important to note that equilibrium calculations are done on a node-by-node basis, not over the whole network (that is, each node’s initial condition is calculated without taking movement into account). Thus, when we start a simulation with different levels of disease incidence or population amounts in each node, the dynamics on the network will still exhibit a burn-in period before reaching equilibrium.</p>
<p>We specify edges in the movement network separately for humans and mosquitoes (in <code>h_move</code> and <code>m_move</code>, respectively). These should be either logical matrices or integer matrices that can be coerced to logical values. Humans can move back and forth between the humans-only and both nodes, and mosquitoes between the mosquitoes-only and both nodes. These matrices are needed to generate the set of transitions. While we use base <code>matrix</code> objects in this example, sparse logical matrices from the <code>Matrix</code> library are supported for large networks.</p>
<p>Once the possible movements between nodes are specified, we setup the places and transitions for the Petri Net, and the summarize those transitions that apply to each place, the stoichiometry matrix. This is handled by the <code><a href="../reference/spn_S.html">spn_S()</a></code> function, which calls <code><a href="../reference/spn_Pre.html">spn_Pre()</a></code> and <code><a href="../reference/spn_Post.html">spn_Post()</a></code> internally for each half of the calculation.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># nodetypes</span>
<span class="va">node_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"m"</span>, <span class="st">"b"</span>, <span class="st">"h"</span><span class="op">)</span>
<span class="va">num_nodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">node_list</span><span class="op">)</span>

<span class="co"># human movement</span>
<span class="va">h_move</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="cn">FALSE</span>, nrow <span class="op">=</span> <span class="va">num_nodes</span>, ncol <span class="op">=</span> <span class="va">num_nodes</span>,
                 dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">node_list</span>, <span class="va">node_list</span><span class="op">)</span><span class="op">)</span>
<span class="va">h_move</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span>
<span class="va">h_move</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span>

<span class="co"># mosquito movement</span>
<span class="va">m_move</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="cn">FALSE</span>, nrow <span class="op">=</span> <span class="va">num_nodes</span>, ncol <span class="op">=</span> <span class="va">num_nodes</span>,
                 dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">node_list</span>, <span class="va">node_list</span><span class="op">)</span><span class="op">)</span>
<span class="va">m_move</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span>
<span class="va">m_move</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span>

<span class="co"># Places and transitions</span>
<span class="va">SPN_P</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spn_P_epiSIS_network.html">spn_P_epiSIS_network</a></span><span class="op">(</span>node_list <span class="op">=</span> <span class="va">node_list</span>, params <span class="op">=</span> <span class="va">theta</span>, cube <span class="op">=</span> <span class="va">cube</span><span class="op">)</span>
<span class="va">SPN_T</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spn_T_epiSIS_network.html">spn_T_epiSIS_network</a></span><span class="op">(</span>node_list <span class="op">=</span> <span class="va">node_list</span>, spn_P <span class="op">=</span> <span class="va">SPN_P</span>, params <span class="op">=</span> <span class="va">theta</span>,
                              cube <span class="op">=</span> <span class="va">cube</span>, h_move <span class="op">=</span> <span class="va">h_move</span>, m_move <span class="op">=</span> <span class="va">m_move</span><span class="op">)</span>

<span class="co"># Stoichiometry matrix</span>
<span class="va">S</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spn_S.html">spn_S</a></span><span class="op">(</span>spn_P <span class="op">=</span> <span class="va">SPN_P</span>, spn_T <span class="op">=</span> <span class="va">SPN_T</span><span class="op">)</span></code></pre></div>
</div>
<div id="equilibria_haz" class="section level2">
<h2 class="hasAnchor">
<a href="#equilibria_haz" class="anchor"></a>Equilibrium Conditions and Hazard Functions</h2>
<p>Now that we have set up the structural properties of the Petri Net, we can calculate the population equilibrium, and the initial conditions, from parameters defined earlier ( <a href="#pars">theta</a> ). Remember, these are node-by-node equilibria, not an equilibrium over the entire network. Because each node is independent, we need to set the number of female mosquitoes in the mosquito-only node, and the number of humans in the human-only node, at equilibrium. Additionally, we need to set disease prevalence in the human-only node. We will begin at a slightly lower prevalence than the human/mosquito node, acknowledging the migration between those nodes and the lack of transmission in the human-only node.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># SEI mosquitoes and SIS humans equilibrium</span>
<span class="co">#  outputs required parameters in the named list "params"</span>
<span class="co">#  outputs intial equilibrium for adv users, "init</span>
<span class="co">#  outputs properly filled initial markings, "M0"</span>
<span class="va">initialCons</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/equilibrium_SEI_SIS.html">equilibrium_SEI_SIS</a></span><span class="op">(</span>params <span class="op">=</span> <span class="va">theta</span>, node_list <span class="op">=</span> <span class="va">node_list</span>,
                                   NF <span class="op">=</span> <span class="fl">500</span>, phi <span class="op">=</span> <span class="fl">0.5</span>, NH <span class="op">=</span> <span class="fl">1000</span>, pop_ratio_H <span class="op">=</span> <span class="fl">0.15</span>,
                                   log_dd <span class="op">=</span> <span class="cn">TRUE</span>, spn_P <span class="op">=</span> <span class="va">SPN_P</span>, cube <span class="op">=</span> <span class="va">cube</span><span class="op">)</span></code></pre></div>
<p>Next, we make the movement matrix. Because <strong>MGDrivE2</strong> is a continuous-time model, unlike <strong>MGDrivE</strong>, the movement matrix is a stochastic rate matrix (or infinitesimal generator, in probability theory parlance), meaning that it should have rows that sum to 0, and the diagonal is the negative sum of off-diagonal elements in each row. For ease of specification, we separate the stochastic rate matrix into two parts; a vector of rates (the <em>positive</em> diagonal), and the matrix of renormalized off-diagonal elements (a probability matrix). We use the function <code><a href="../reference/calc_move_rate.html">calc_move_rate()</a></code> to calculate the total movement rate from mortality rate and lifetime probability of movement (which we assume to be <code>0.05</code>). For humans, we assume that everyone moves between nodes on average once a week, or at a rate of <code>1/7</code>.</p>
<p>For both humans and mosquitoes, the vector of movement rates must be of length equal to the number of nodes in the matrix, and nodes from which no movement is possible (for mosquitoes, human-only nodes and vice versa for humans), should have value <code>NaN</code>. If you have made the logical matrices specifying allowed movement, the following code can help ascertain which elements should be <code>NaN</code>: <code><a href="https://rdrr.io/r/base/apply.html">apply(X = m_move, MARGIN = 1, FUN = Negate(any))</a></code>. Finally we append the movement objects to the vector of parameters <code>initialCons$params</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># calculate movement rates and movement probabilities</span>
<span class="va">gam</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_move_rate.html">calc_move_rate</a></span><span class="op">(</span>mu <span class="op">=</span> <span class="va">initialCons</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">muF</span>, P <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>

<span class="co"># set mosquito movement rates/probabilities</span>
<span class="co">#  mosquitoes exist in nodes 1 and 2, not 3</span>
<span class="va">mr_mosy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">gam</span>, <span class="va">gam</span>, <span class="cn">NaN</span><span class="op">)</span>
<span class="va">mp_mosy</span> <span class="op">&lt;-</span> <span class="fu">Matrix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/sparseMatrix.html">sparseMatrix</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, x <span class="op">=</span> <span class="fl">1</span>, dims <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">m_move</span><span class="op">)</span><span class="op">)</span>

<span class="co"># set human movement rates/probabilities</span>
<span class="co">#  humans exist in nodes 2 and 3, not 1</span>
<span class="va">mr_human</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NaN</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">7</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">7</span><span class="op">)</span>
<span class="va">mp_human</span> <span class="op">&lt;-</span> <span class="fu">Matrix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/sparseMatrix.html">sparseMatrix</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>, j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span>, x <span class="op">=</span> <span class="fl">1</span>, dims <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">h_move</span><span class="op">)</span><span class="op">)</span>

<span class="co"># put rates and probs into the parameter list</span>
<span class="va">initialCons</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">mosquito_move_rates</span> <span class="op">&lt;-</span> <span class="va">mr_mosy</span>
<span class="va">initialCons</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">mosquito_move_probs</span> <span class="op">&lt;-</span> <span class="va">mp_mosy</span>
<span class="va">initialCons</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">human_move_rates</span> <span class="op">&lt;-</span> <span class="va">mr_human</span>
<span class="va">initialCons</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">human_move_probs</span> <span class="op">&lt;-</span> <span class="va">mp_human</span></code></pre></div>
<p>Now that all the necessary parameters have been added to the named list <code>initialCons$params</code>, we generate the hazard functions, using the function <code><a href="../reference/spn_hazards.html">spn_hazards()</a></code>. By specifying <code>log_dd = TRUE</code>, we use logistic density dependence for these simulations.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># approximate hazards for continous approximation</span>
<span class="va">approx_hazards</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spn_hazards.html">spn_hazards</a></span><span class="op">(</span>spn_P <span class="op">=</span> <span class="va">SPN_P</span>, spn_T <span class="op">=</span> <span class="va">SPN_T</span>, cube <span class="op">=</span> <span class="va">cube</span>,
                              params <span class="op">=</span> <span class="va">initialCons</span><span class="op">$</span><span class="va">params</span>, type <span class="op">=</span> <span class="st">"SIS"</span>,
                              log_dd <span class="op">=</span> <span class="cn">TRUE</span>, exact <span class="op">=</span> <span class="cn">FALSE</span>, tol <span class="op">=</span> <span class="fl">1e-8</span>,
                              verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># exact hazards for integer-valued state space</span>
<span class="va">exact_hazards</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spn_hazards.html">spn_hazards</a></span><span class="op">(</span>spn_P <span class="op">=</span> <span class="va">SPN_P</span>, spn_T <span class="op">=</span> <span class="va">SPN_T</span>, cube <span class="op">=</span> <span class="va">cube</span>,
                             params <span class="op">=</span> <span class="va">initialCons</span><span class="op">$</span><span class="va">params</span>, type <span class="op">=</span> <span class="st">"SIS"</span>,
                             log_dd <span class="op">=</span> <span class="cn">TRUE</span>, exact <span class="op">=</span> <span class="cn">TRUE</span>, tol <span class="op">=</span> <span class="cn">NaN</span>,
                             verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
</div>
<div id="sim" class="section level2">
<h2 class="hasAnchor">
<a href="#sim" class="anchor"></a>Simulation of Fully Specified SPN Model</h2>
<p>Now that we have generated the Petri Net and associated hazard functions we are ready to proceed with simulations.</p>
<p>Similar to previous simulations, we will release 50 adult females with homozygous recessive alleles 5 times, every 10 days, starting at day 20, in node 1 (this allows us to see movement from node 1 to node 2, before we see an impact on human disease transmission). Remember, it is critically important that <strong>the event names match a place name</strong> in the simulation. The simulation function checks this and will throw an error if the event name does not exist as a place in the simulation. This format is used in <strong>MGDrivE2</strong> for consistency with solvers in <code>deSolve</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># releases</span>
<span class="va">r_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">20</span>, length.out <span class="op">=</span> <span class="fl">5</span>, by <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
<span class="va">r_size</span> <span class="op">&lt;-</span> <span class="fl">50</span>
<span class="va">events</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="st">"var"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"F_"</span>, <span class="va">cube</span><span class="op">$</span><span class="va">releaseType</span>, <span class="st">"_"</span>, <span class="va">cube</span><span class="op">$</span><span class="va">wildType</span>, <span class="st">"_S_1"</span><span class="op">)</span>,
                     <span class="st">"time"</span> <span class="op">=</span> <span class="va">r_times</span>,
                     <span class="st">"value"</span> <span class="op">=</span> <span class="va">r_size</span>,
                     <span class="st">"method"</span> <span class="op">=</span> <span class="st">"add"</span>,
                     stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<div id="soln_ode" class="section level3">
<h3 class="hasAnchor">
<a href="#soln_ode" class="anchor"></a>Deterministic: ODE Solutions</h3>
<p>As in the <a href="epi-node.html">“MGDrivE2: One Node Epidemiological Dynamics”</a> vignette, we will first numerically simulate the mean-field ODE approximation to the stochastic trajectory, using the approximate hazards suitable for continuous-state approximation (see <code>?spn_hazards()</code>). Internally, <strong>MGDrivE2</strong> uses the high quality numerical solvers in from <code>deSolve</code> to integrate a mean-field approximation to the stochastic model. We will then plot several aspects of the population using helper functions provided by <strong>MGDrivE2</strong>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># run deterministic simulation</span>
<span class="va">ODE_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_trajectory_R.html">sim_trajectory_R</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">initialCons</span><span class="op">$</span><span class="va">M0</span>, tmax <span class="op">=</span> <span class="va">tmax</span>, dt <span class="op">=</span> <span class="va">dt</span>, S <span class="op">=</span> <span class="va">S</span>,
                            hazards <span class="op">=</span> <span class="va">approx_hazards</span>, sampler <span class="op">=</span> <span class="st">"ode"</span>, method <span class="op">=</span> <span class="st">"lsoda"</span>,
                            events <span class="op">=</span> <span class="va">events</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># summarize aquatic stages by genotype</span>
<span class="va">ODE_e</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_eggs_geno.html">summarize_eggs_geno</a></span><span class="op">(</span>out <span class="op">=</span> <span class="va">ODE_out</span><span class="op">$</span><span class="va">state</span>, spn_P <span class="op">=</span> <span class="va">SPN_P</span><span class="op">)</span>
<span class="va">ODE_l</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_larvae_geno.html">summarize_larvae_geno</a></span><span class="op">(</span>out <span class="op">=</span> <span class="va">ODE_out</span><span class="op">$</span><span class="va">state</span>, spn_P <span class="op">=</span> <span class="va">SPN_P</span><span class="op">)</span>
<span class="va">ODE_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_pupae_geno.html">summarize_pupae_geno</a></span><span class="op">(</span>out <span class="op">=</span> <span class="va">ODE_out</span><span class="op">$</span><span class="va">state</span>, spn_P <span class="op">=</span> <span class="va">SPN_P</span><span class="op">)</span>

<span class="co"># add stage name</span>
<span class="va">ODE_e</span><span class="op">$</span><span class="va">stage</span> <span class="op">&lt;-</span> <span class="st">"Egg"</span>
<span class="va">ODE_l</span><span class="op">$</span><span class="va">stage</span> <span class="op">&lt;-</span> <span class="st">"Larvae"</span>
<span class="va">ODE_p</span><span class="op">$</span><span class="va">stage</span> <span class="op">&lt;-</span> <span class="st">"Pupae"</span>

<span class="co"># plot by genotype</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">ODE_e</span>, <span class="va">ODE_l</span>,<span class="va">ODE_p</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">genotype</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">stage</span> <span class="op">~</span> <span class="va">node</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"SPN: ODE Solution - Genotypes"</span><span class="op">)</span></code></pre></div>
<p><img src="epi-network_files/figure-html/unnamed-chunk-10-1.png" width="691.2"></p>
<p>Our first plot looks at the aquatic stage distributions, in the 2 nodes with mosquitoes, nodes 1 and 2. At equilibrium, there are significantly more eggs than larvae, and larvae than pupae. Additionally, we see the difference in population size between the nodes, with node 1 carrying around 66% more mosquitoes than node 2. Releases were performed in node 1, and then we see some migration to node 2.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># summarize aquatic stages by Erlang stage</span>
<span class="va">ODE_e</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_eggs_stage.html">summarize_eggs_stage</a></span><span class="op">(</span>out <span class="op">=</span> <span class="va">ODE_out</span><span class="op">$</span><span class="va">state</span>, spn_P <span class="op">=</span> <span class="va">SPN_P</span><span class="op">)</span>
<span class="va">ODE_l</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_larvae_stage.html">summarize_larvae_stage</a></span><span class="op">(</span>out <span class="op">=</span> <span class="va">ODE_out</span><span class="op">$</span><span class="va">state</span>, spn_P <span class="op">=</span> <span class="va">SPN_P</span><span class="op">)</span>
<span class="va">ODE_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_pupae_stage.html">summarize_pupae_stage</a></span><span class="op">(</span>out <span class="op">=</span> <span class="va">ODE_out</span><span class="op">$</span><span class="va">state</span>, spn_P <span class="op">=</span> <span class="va">SPN_P</span><span class="op">)</span>

<span class="co"># add stage name</span>
<span class="va">ODE_e</span><span class="op">$</span><span class="va">stage</span> <span class="op">&lt;-</span> <span class="st">"Egg"</span>
<span class="va">ODE_l</span><span class="op">$</span><span class="va">stage</span> <span class="op">&lt;-</span> <span class="st">"Larvae"</span>
<span class="va">ODE_p</span><span class="op">$</span><span class="va">stage</span> <span class="op">&lt;-</span> <span class="st">"Pupae"</span>

<span class="co"># plot by Erlang stage</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">ODE_e</span>, <span class="va">ODE_l</span>,<span class="va">ODE_p</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">`Erlang-stage`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">stage</span> <span class="op">~</span> <span class="va">node</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"SPN: ODE Solution - Erlang Dwell Stage"</span><span class="op">)</span></code></pre></div>
<p><img src="epi-network_files/figure-html/unnamed-chunk-11-1.png" width="691.2"></p>
<p>We can look at the aquatic stages another way. Time spent in each stage is described by an Erlang distribution, with varying number of states. From the figure, we see that eggs and pupae only have 2 stages, while larvae have 3. We see the effect of releases in the first node, but we do not see the effect on the second node. Since we do not show genotypes here, we cannot see the release of new alleles into the population. Looking at the egg stage, near time = 0, we see a dip in the population of node 1, and a corresponding rise in the population of node 2. This also appeared in the previous plot, and is from the metapopulation coming to equilibrium. This is an artifact of how the <a href="#equilibria_haz">equilibrium</a> is calculated.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># summarize females/males</span>
<span class="va">ODE_f</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_females_epi.html">summarize_females_epi</a></span><span class="op">(</span>out <span class="op">=</span> <span class="va">ODE_out</span><span class="op">$</span><span class="va">state</span>, spn_P <span class="op">=</span> <span class="va">SPN_P</span><span class="op">)</span>
<span class="va">ODE_m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_males.html">summarize_males</a></span><span class="op">(</span>out <span class="op">=</span> <span class="va">ODE_out</span><span class="op">$</span><span class="va">state</span><span class="op">)</span>

<span class="co"># add sex for plotting</span>
<span class="va">ODE_f</span><span class="op">$</span><span class="va">sex</span> <span class="op">&lt;-</span> <span class="st">"Female"</span>
<span class="va">ODE_m</span><span class="op">$</span><span class="va">sex</span> <span class="op">&lt;-</span> <span class="st">"Male"</span>
<span class="va">ODE_m</span><span class="op">$</span><span class="va">inf</span> <span class="op">&lt;-</span> <span class="st">"S"</span>

<span class="co"># plot adults</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">ODE_f</span>, <span class="va">ODE_m</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">genotype</span>, linetype <span class="op">=</span> <span class="va">inf</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">~</span> <span class="va">node</span>, scales <span class="op">=</span> <span class="st">"fixed"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"SPN: ODE Solution - Adult Stages"</span><span class="op">)</span></code></pre></div>
<p><img src="epi-network_files/figure-html/unnamed-chunk-12-1.png" width="691.2"></p>
<p>Looking at the adult population, it is easy to see the difference in population size between nodes 1 and 2. We see modified female mosquito releases in node 1, the propagation of those alleles into the male population of node one, and then migration of those alleles into node 2. Additionally, we see how few mosquitoes in node 2 are actually infected, and a tiny migration of them into node 1. It is also apparent that male mosquitoes are not part of the disease dynamics (and will be left out of further plots). Again, looking closely near time = 0, we see the burn-in of the network prior to reaching equilibrium.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># summarize females/humans by genotype</span>
<span class="va">ODE_female</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_females_epi.html">summarize_females_epi</a></span><span class="op">(</span>out <span class="op">=</span> <span class="va">ODE_out</span><span class="op">$</span><span class="va">state</span>, spn_P <span class="op">=</span> <span class="va">SPN_P</span><span class="op">)</span>
<span class="va">ODE_humans</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_humans_epiSIS.html">summarize_humans_epiSIS</a></span><span class="op">(</span>out <span class="op">=</span> <span class="va">ODE_out</span><span class="op">$</span><span class="va">state</span><span class="op">)</span>

<span class="co"># plot</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">ODE_female</span>,<span class="va">ODE_humans</span><span class="op">)</span> <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">genotype</span>, linetype <span class="op">=</span> <span class="va">inf</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">node</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"SPN: ODE Solution"</span><span class="op">)</span></code></pre></div>
<p><img src="epi-network_files/figure-html/unnamed-chunk-13-1.png" width="691.2"></p>
<p>We now breakdown the network by node, showing female mosquitoes and humans, so that we can watch the infection dynamics. First, we look at the humans, where the burn-in near time = 0 is extremely apparent. This was deliberate, as disease incidence is different between the nodes, to remind us of the issues with metapopulation-level equilibrium. As a positive, there is significant reduction in disease incidence in humans. This stems from 2 places: first, as there are no mosquitoes in node 3, there is no disease transmission and disease incidence should fall, and second, release of modified mosquitoes that do not transmit disease aids in incidence reduction. In this setting, more disease incidence reduction is due to lack of transmission in node 3 than modified mosquitoes. However, further simulations could test these differences and determine how much reduction is due to both causes.</p>
</div>
<div id="soln_tau" class="section level3">
<h3 class="hasAnchor">
<a href="#soln_tau" class="anchor"></a>Stochastic: Tau-leaping Solutions</h3>
<p>As a further example, we run a single stochastic realization of the same simulation, using the <code>tau</code> sampler with <span class="math inline">\(\Delta t = 0.1\)</span>, approximating 10 jumps per day. As the adult male mosquitoes do not contribute to infection dynamics, we will only view the adult female mosquito and human dynamics here.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># delta t</span>
<span class="va">dt_stoch</span> <span class="op">&lt;-</span> <span class="fl">0.1</span>

<span class="co"># run tau-leaping simulation</span>
<span class="va">PTS_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_trajectory_R.html">sim_trajectory_R</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">initialCons</span><span class="op">$</span><span class="va">M0</span>, tmax <span class="op">=</span> <span class="va">tmax</span>, dt <span class="op">=</span> <span class="va">dt</span>,
                            dt_stoch <span class="op">=</span> <span class="va">dt_stoch</span>, S <span class="op">=</span> <span class="va">S</span>, hazards <span class="op">=</span> <span class="va">exact_hazards</span>,
                            sampler <span class="op">=</span> <span class="st">"tau"</span>, events <span class="op">=</span> <span class="va">events</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># summarize females/humans by genotype</span>
<span class="va">PTS_female</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_females_epi.html">summarize_females_epi</a></span><span class="op">(</span>out <span class="op">=</span> <span class="va">PTS_out</span><span class="op">$</span><span class="va">state</span>, spn_P <span class="op">=</span> <span class="va">SPN_P</span><span class="op">)</span>
<span class="va">PTS_humans</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_humans_epiSIS.html">summarize_humans_epiSIS</a></span><span class="op">(</span>out <span class="op">=</span> <span class="va">PTS_out</span><span class="op">$</span><span class="va">state</span><span class="op">)</span>

<span class="co"># plot</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">PTS_female</span>,<span class="va">PTS_humans</span><span class="op">)</span> <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">genotype</span>, linetype <span class="op">=</span> <span class="va">inf</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">node</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"SPN: Tau-leaping Approximation"</span><span class="op">)</span></code></pre></div>
<p><img src="epi-network_files/figure-html/unnamed-chunk-14-1.png" width="691.2"></p>
<p>Looking at one stochastic realization of our female/human disease incidence plot, we see quite similar dynamics to the ODE solution. Dynamics are slightly slower, but otherwise similar, indicating that incidence reduction is primarily due to recovery in humans. We hypothesize this (but should still test it) because <a href="lifecycle-node.html">previous simulations</a> have shown a reduction in the <code>a</code> allele due to drift, which we can assume occurs here, but we see similar rates of disease reduction, indicating that our modified allele is not of major importance for disease incidence reduction.</p>
</div>
<div id="ref" class="section level3">
<h3 class="hasAnchor">
<a href="#ref" class="anchor"></a>References</h3>
<ul>
<li>Smith, D. L., &amp; McKenzie, F. E. (2004). Statics and dynamics of malaria infection in Anopheles mosquitoes. Malaria journal, 3(1), 13.</li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="http://www.slwu89.com">Sean L. Wu</a>, <a href="https://github.com/GilChrist19">Jared B. Bennett</a>, <a href="https://www.marshalllab.com">John M. Marshall</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
