<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MGDrivE2: One Node Epidemiological Dynamics • MGDrivE2</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="MGDrivE2: One Node Epidemiological Dynamics">
<meta property="og:description" content="MGDrivE2">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MGDrivE2</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/advanced_topics.html">MGDrivE2: Advanced Topics</a>
    </li>
    <li>
      <a href="../articles/epi-SEIR.html">MGDrivE2: SEIR Epidemiological Dynamics</a>
    </li>
    <li>
      <a href="../articles/epi-network.html">MGDrivE2: Metapopulation Network Epidemiological Dynamics</a>
    </li>
    <li>
      <a href="../articles/epi-node.html">MGDrivE2: One Node Epidemiological Dynamics</a>
    </li>
    <li>
      <a href="../articles/inhomogeneous.html">MGDrivE2: Simulation of Time-inhomogeneous Stochastic Processes (Seasonality)</a>
    </li>
    <li>
      <a href="../articles/lifecycle-network.html">MGDrivE2: Metapopulation Network Lifecycle Dynamics</a>
    </li>
    <li>
      <a href="../articles/lifecycle-node.html">MGDrivE2: One Node Lifecycle Dynamics</a>
    </li>
    <li>
      <a href="../articles/output-storage.html">MGDrivE2: Data Storage and Analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/MarshallLab/MGDrivE/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="epi-node_files/header-attrs-2.5/header-attrs.js"></script><link href="epi-node_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="epi-node_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>MGDrivE2: One Node Epidemiological Dynamics</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/MarshallLab/MGDrivE/blob/master/vignettes/epi-node.Rmd"><code>vignettes/epi-node.Rmd</code></a></small>
      <div class="hidden name"><code>epi-node.Rmd</code></div>

    </div>

    
    
<div id="table-of-contents" class="section level2">
<h2 class="hasAnchor">
<a href="#table-of-contents" class="anchor"></a>Table of Contents</h2>
<ol style="list-style-type: decimal">
<li><a href="#pars">Parameterization</a></li>
<li><a href="#init_pn">Initialization of the Petri Net</a></li>
<li><a href="#equilibria_haz">Equilibrium Conditions and Hazard Functions</a></li>
<li>
<a href="#sim">Simulation of Fully Specified SPN Model</a>
<ol style="list-style-type: decimal">
<li><a href="#soln_ode">Deterministic: ODE Solutions</a></li>
<li><a href="#soln_cle">Stochastic: CLE Solutions</a></li>
</ol>
</li>
<li><a href="#ref">References</a></li>
</ol>
<div id="preface" class="section level3">
<h3 class="hasAnchor">
<a href="#preface" class="anchor"></a>Preface</h3>
<p>In this vignette, we show how to set up and run <strong>MGDrivE2</strong> simulations that utilize the <strong>SEI</strong> (Susceptible-Exposed-Infectious) mosquito model of epidemiological dynamics coupled to the <strong>SIS</strong> (Susceptible-Infectious-Susceptible) human model of epidemiological dynamics. The <strong>SEI</strong> mosquito model uses an Erlang-distributed incubation (<strong>E</strong>) period to approximate general non-exponential dwell times in the <strong>E</strong> state. The <strong>SIS</strong> human model on the other hand, is a deliberate simplifying caricature of infection dynamics in the human population; despite this, it is widely used and provides a useful base case due to analytically tractable dynamics as well as a foundation from which more complex models can be built. This vignette shows examples of transmission dynamics interacting with population genetic dynamics in a single well-mixed node.</p>
<p>We start by loading the <strong>MGDrivE2</strong> package, as well as the <strong>MGDrivE</strong> package for access to inheritance cubes and <strong>ggplot2</strong> for graphical analysis. We will use the basic cube to simulate Mendelian inheritance for this example.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># simulation functions</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://marshalllab.github.io/MGDrivE/">MGDrivE2</a></span><span class="op">)</span>
<span class="co">#&gt; Loading MGDrivE2: Mosquito Gene Drive Explorer Version 2</span>
<span class="co"># inheritance patterns</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://marshalllab.github.io/MGDrivE/">MGDrivE</a></span><span class="op">)</span>
<span class="co">#&gt; Loading MGDrivE: Mosquito Gene Drive Explorer</span>
<span class="co"># plotting</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>

<span class="co"># basic inheritance pattern</span>
<span class="va">cube</span> <span class="op">&lt;-</span> <span class="fu">MGDrivE</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MGDrivE/man/cubeMendelian.html">cubeMendelian</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="pars" class="section level2">
<h2 class="hasAnchor">
<a href="#pars" class="anchor"></a>Parameterization</h2>
<p>Several parameters are necessary to setup the structural properties of the Petri Net, as well as calculate the population distribution at equilibrium, setup initial conditions, and calculate hazards. Again, we specify all entomological parameters as for the mosquito-only simulation (see <a href="lifecycle-node.html">“MGDrivE2: One Node Lifecycle Dynamics”</a>) as well as additional parameters for the <strong>SEI-SIS</strong> dynamics. Like the aquatic stages, <span class="math inline">\(\frac{1}{q_{\mathit{EIP}}}\)</span> will give the mean dwell time for incubating mosquitoes, and variance by <span class="math inline">\(\frac{1}{n_{\mathit{EIP}} \cdot q_{\mathit{EIP}}^{2}}\)</span>. The model requires <code>muH</code>, mortality rate in humans, because equilibrium dynamics are simulated (that is, human populations follow an “open cohort” with equal birth and death rates). A table of (case-sensitive) epidemiological parameters the user needs to specify is given below. Note that all parameters must be specified as a rate per day. For a detailed discussion of these parameters in the context of malaria models, see Smith and McKenzie (2004).</p>
<table class="table">
<colgroup>
<col width="44%">
<col width="56%">
</colgroup>
<thead><tr class="header">
<th align="center">Parameter</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center"><code>NH</code></td>
<td align="left">total human population size</td>
</tr>
<tr class="even">
<td align="center"><code>X</code></td>
<td align="left">equilibrium prevalence of disease in humans</td>
</tr>
<tr class="odd">
<td align="center"><code>f</code></td>
<td align="left">mosquito feeding rate</td>
</tr>
<tr class="even">
<td align="center"><code>Q</code></td>
<td align="left">proportion of blood meals taken on humans (human blood index in field literature)</td>
</tr>
<tr class="odd">
<td align="center"><code>b</code></td>
<td align="left">mosquito to human transmission efficiency</td>
</tr>
<tr class="even">
<td align="center"><code>c</code></td>
<td align="left">human to mosquito transmission efficiency</td>
</tr>
<tr class="odd">
<td align="center"><code>r</code></td>
<td align="left">rate of recovery in humans</td>
</tr>
<tr class="even">
<td align="center"><code>muH</code></td>
<td align="left">mortality rate in humans</td>
</tr>
<tr class="odd">
<td align="center"><code>qEIP</code></td>
<td align="left">inverse of mean duration of EIP</td>
</tr>
<tr class="even">
<td align="center"><code>nEIP</code></td>
<td align="left">shape parameter of Erlang-distributed EIP</td>
</tr>
</tbody>
</table>
<p>Please note that <code>f</code> and <code>Q</code> must be specified; this is because future versions of <strong>MGDrivE2</strong> will include additional vector control methods such as IRS (indoor residual spraying) and ITN (insecticide treated nets). In the presence of ITNs/IRS <code>f</code> will vary independently as a function of time depending on intervention coverage.</p>
<p>Additionally, we specify a total simulation length of 300 days, with output stored daily.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># entomological and epidemiological parameters</span>
<span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="co"># lifecycle parameters</span>
  qE <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">4</span>,
  nE <span class="op">=</span> <span class="fl">2</span>,
  qL <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">3</span>,
  nL <span class="op">=</span> <span class="fl">3</span>,
  qP <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">6</span>,
  nP <span class="op">=</span> <span class="fl">2</span>,
  muE <span class="op">=</span> <span class="fl">0.05</span>,
  muL <span class="op">=</span> <span class="fl">0.15</span>,
  muP <span class="op">=</span> <span class="fl">0.05</span>,
  muF <span class="op">=</span> <span class="fl">0.09</span>,
  muM <span class="op">=</span> <span class="fl">0.09</span>,
  beta <span class="op">=</span> <span class="fl">16</span>,
  nu <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">4</span><span class="op">/</span><span class="fl">24</span><span class="op">)</span>,
  <span class="co"># epidemiological parameters</span>
  NH <span class="op">=</span> <span class="fl">1000</span>,
  X <span class="op">=</span> <span class="fl">0.25</span>,
  f <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">3</span>,
  Q <span class="op">=</span> <span class="fl">0.9</span>,
  b <span class="op">=</span> <span class="fl">0.55</span>,
  c <span class="op">=</span> <span class="fl">0.15</span>,
  r <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">200</span>,
  muH <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">62</span><span class="op">*</span><span class="fl">365</span><span class="op">)</span>,
  qEIP <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">11</span>,
  nEIP <span class="op">=</span> <span class="fl">6</span>
<span class="op">)</span>

<span class="co"># simulation parameters</span>
<span class="va">tmax</span> <span class="op">&lt;-</span> <span class="fl">250</span>
<span class="va">dt</span> <span class="op">&lt;-</span> <span class="fl">1</span></code></pre></div>
<p>We also need to augment the cube with genotype specific transmission efficiencies; this allows simulations of gene drive systems that confer pathogen-refractory characteristics to mosquitoes depending on genotype. The specific parameters we want to attach to the cube are <code>b</code> and <code>c</code>, the mosquito to human and human to mosquito transmission efficiencies. We assume that transmission from human to mosquito is not impacted in modified mosquitoes, but mosquito to human transmission is significantly reduced in modified mosquitoes. For detailed descriptions of these parameters for modelling malaria transmission, see Smith &amp; McKenzie (2004) for extensive discussion.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># augment the cube with RM transmission parameters</span>
<span class="va">cube</span><span class="op">$</span><span class="va">c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span>object <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">theta</span><span class="op">$</span><span class="va">c</span>, times <span class="op">=</span> <span class="va">cube</span><span class="op">$</span><span class="va">genotypesN</span><span class="op">)</span>, nm <span class="op">=</span> <span class="va">cube</span><span class="op">$</span><span class="va">genotypesID</span><span class="op">)</span>
<span class="va">cube</span><span class="op">$</span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"AA"</span> <span class="op">=</span> <span class="va">theta</span><span class="op">$</span><span class="va">b</span>, <span class="st">"Aa"</span> <span class="op">=</span> <span class="fl">0.35</span>, <span class="st">"aa"</span> <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></code></pre></div>
</div>
<div id="init_pn" class="section level2">
<h2 class="hasAnchor">
<a href="#init_pn" class="anchor"></a>Initialization of the Petri Net</h2>
<p>The <strong>SEI-SIS</strong> disease transmission model sits “on top” of the existing <strong>MGDrivE2</strong> structure, using the default aquatic and male “places”, but expanding adult female “places” to follow an Erlang-distributed pathogen incubation period (called the extrinsic incubation period, <strong>EIP</strong>) and adding <strong>SIS</strong> human states as well. Information on how to choose the proper <strong>EIP</strong> distribution can be found in the help file for <code>?makeQ_SEI()</code>.</p>
<p>The transitions between states is also expanded, providing transitions for females to progress in infection status, adding human dynamics, and allowing interaction between mosquito and human states. All of these additions are handled internally by <code><a href="../reference/spn_T_epiSIS_node.html">spn_T_epiSIS_node()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Places and transitions</span>
<span class="va">SPN_P</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spn_P_epiSIS_node.html">spn_P_epiSIS_node</a></span><span class="op">(</span>params <span class="op">=</span> <span class="va">theta</span>, cube <span class="op">=</span> <span class="va">cube</span><span class="op">)</span>
<span class="va">SPN_T</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spn_T_epiSIS_node.html">spn_T_epiSIS_node</a></span><span class="op">(</span>spn_P <span class="op">=</span> <span class="va">SPN_P</span>, params <span class="op">=</span> <span class="va">theta</span>, cube <span class="op">=</span> <span class="va">cube</span><span class="op">)</span>

<span class="co"># Stoichiometry matrix</span>
<span class="va">S</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spn_S.html">spn_S</a></span><span class="op">(</span>spn_P <span class="op">=</span> <span class="va">SPN_P</span>, spn_T <span class="op">=</span> <span class="va">SPN_T</span><span class="op">)</span></code></pre></div>
</div>
<div id="equilibria_haz" class="section level2">
<h2 class="hasAnchor">
<a href="#equilibria_haz" class="anchor"></a>Equilibrium Conditions and Hazard Functions</h2>
<p>Now that we have set up the structural properties of the Petri Net, we need to calculate the population distribution at equilibrium and define the initial conditions for the simulation.</p>
<p>The function <code><a href="../reference/equilibrium_SEI_SIS.html">equilibrium_SEI_SIS()</a></code> calculates the equilibrium distribution of female mosquitoes across <strong>SEI</strong> stages, based on human populations and force-of-infection, then calculates all other equilibria. We set the logistic form for larval density-dependence in these examples by specify <code>log_dd = TRUE</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># SEI mosquitoes and SIS humans equilibrium</span>
<span class="co">#  outputs required parameters in the named list "params"</span>
<span class="co">#  outputs initial equilibrium for adv users, "init</span>
<span class="co">#  outputs properly filled initial markings, "M0"</span>
<span class="va">initialCons</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/equilibrium_SEI_SIS.html">equilibrium_SEI_SIS</a></span><span class="op">(</span>params <span class="op">=</span> <span class="va">theta</span>, phi <span class="op">=</span> <span class="fl">0.5</span>, log_dd <span class="op">=</span> <span class="cn">TRUE</span>,
                                   spn_P <span class="op">=</span> <span class="va">SPN_P</span>, cube <span class="op">=</span> <span class="va">cube</span><span class="op">)</span></code></pre></div>
<p>With the equilibrium conditions calculated (see <code>?equilibrium_SEI_SIS()</code>), and the list of possible transitions provided by <code><a href="../reference/spn_T_epiSIS_node.html">spn_T_epiSIS_node()</a></code>, we can now calculate the rates of those transitions between states.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># approximate hazards for continous approximation</span>
<span class="va">approx_hazards</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spn_hazards.html">spn_hazards</a></span><span class="op">(</span>spn_P <span class="op">=</span> <span class="va">SPN_P</span>, spn_T <span class="op">=</span> <span class="va">SPN_T</span>, cube <span class="op">=</span> <span class="va">cube</span>,
                              params <span class="op">=</span> <span class="va">initialCons</span><span class="op">$</span><span class="va">params</span>, type <span class="op">=</span> <span class="st">"SIS"</span>,
                              log_dd <span class="op">=</span> <span class="cn">TRUE</span>, exact <span class="op">=</span> <span class="cn">FALSE</span>, tol <span class="op">=</span> <span class="fl">1e-8</span>,
                              verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
</div>
<div id="sim" class="section level2">
<h2 class="hasAnchor">
<a href="#sim" class="anchor"></a>Simulation of Fully Specified SPN Model</h2>
<p>Similar to previous simulations, we will release 50 adult females with homozygous recessive alleles 5 times, every 10 days, but starting at day 20. Remember, it is critically important that <strong>the event names match a place name</strong> in the simulation. The simulation function checks this and will throw an error if the event name does not exist as a place in the simulation. This format is used in <strong>MGDrivE2</strong> for consistency with solvers in <code>deSolve</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># releases</span>
<span class="va">r_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">20</span>, length.out <span class="op">=</span> <span class="fl">5</span>, by <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
<span class="va">r_size</span> <span class="op">&lt;-</span> <span class="fl">50</span>
<span class="va">events</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="st">"var"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"F_"</span>, <span class="va">cube</span><span class="op">$</span><span class="va">releaseType</span>, <span class="st">"_"</span>, <span class="va">cube</span><span class="op">$</span><span class="va">wildType</span>, <span class="st">"_S"</span><span class="op">)</span>,
                     <span class="st">"time"</span> <span class="op">=</span> <span class="va">r_times</span>,
                     <span class="st">"value"</span> <span class="op">=</span> <span class="va">r_size</span>,
                     <span class="st">"method"</span> <span class="op">=</span> <span class="st">"add"</span>,
                     stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<div id="soln_ode" class="section level3">
<h3 class="hasAnchor">
<a href="#soln_ode" class="anchor"></a>Deterministic: ODE Solutions</h3>
<p>As in the <a href="lifecycle-node.html">“MGDrivE2: One Node Lifecycle Dynamics”</a> vignette, we will first numerically simulate the mean-field ODE approximation to the stochastic trajectory, using the approximate hazards suitable for continuous-state approximation (see <code>?spn_hazards()</code>). Internally, <strong>MGDrivE2</strong> uses the high quality numerical solvers in from <code>deSolve</code> to integrate a mean-field approximation to the stochastic model. We also plot the adult mosquito and human dynamics to see the impact on disease incidence in humans as our released allele spreads through the mosquitoes.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># run deterministic simulation</span>
<span class="va">ODE_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_trajectory_R.html">sim_trajectory_R</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">initialCons</span><span class="op">$</span><span class="va">M0</span>, tmax <span class="op">=</span> <span class="va">tmax</span>, dt <span class="op">=</span> <span class="va">dt</span>, S <span class="op">=</span> <span class="va">S</span>,
                            hazards <span class="op">=</span> <span class="va">approx_hazards</span>, sampler <span class="op">=</span> <span class="st">"ode"</span>, method <span class="op">=</span> <span class="st">"lsoda"</span>,
                            events <span class="op">=</span> <span class="va">events</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># summarize females/males by genotype</span>
<span class="va">ODE_female</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_females_epi.html">summarize_females_epi</a></span><span class="op">(</span>out <span class="op">=</span> <span class="va">ODE_out</span><span class="op">$</span><span class="va">state</span>, spn_P <span class="op">=</span> <span class="va">SPN_P</span><span class="op">)</span>
<span class="va">ODE_male</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_males.html">summarize_males</a></span><span class="op">(</span>out <span class="op">=</span> <span class="va">ODE_out</span><span class="op">$</span><span class="va">state</span><span class="op">)</span>

<span class="co"># add sex for plotting</span>
<span class="va">ODE_female</span><span class="op">$</span><span class="va">sex</span> <span class="op">&lt;-</span> <span class="st">"Female"</span>
<span class="va">ODE_male</span><span class="op">$</span><span class="va">sex</span> <span class="op">&lt;-</span> <span class="st">"Male"</span>
<span class="va">ODE_male</span><span class="op">$</span><span class="va">inf</span> <span class="op">&lt;-</span> <span class="st">"S"</span>

<span class="co"># plot</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">ODE_female</span>, <span class="va">ODE_male</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">genotype</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">inf</span> <span class="op">~</span> <span class="va">sex</span>, scales <span class="op">=</span> <span class="st">"fixed"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"SPN: ODE solution - Mosquitoes"</span><span class="op">)</span></code></pre></div>
<p><img src="epi-node_files/figure-html/unnamed-chunk-9-1.png" width="691.2"></p>
<p>The most obvious point of these plots is that males never exhibit latent or infectious stages. As males do not bite humans, and vertical transmission of most diseases is exceedingly rare or unknown, male mosquitoes do not participate in epidemiological dynamics. Looking at the females, we see our releases, starting at day 50, in the susceptible compartment. Notice that it takes a very low proportion of latent/infected female mosquitoes to contribute to disease incidence in humans. However, it is clear that disease incidence is reduced after releases of modified, and thus non-transmitting, mosquitoes.</p>
<p>Further, we can observe the disease dynamics in female mosquitoes and compare that to what is happening in the human population.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># summarize females/humans by genotype</span>
<span class="va">ODE_female</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_females_epi.html">summarize_females_epi</a></span><span class="op">(</span>out <span class="op">=</span> <span class="va">ODE_out</span><span class="op">$</span><span class="va">state</span>, spn_P <span class="op">=</span> <span class="va">SPN_P</span><span class="op">)</span>
<span class="va">ODE_humans</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_humans_epiSIS.html">summarize_humans_epiSIS</a></span><span class="op">(</span>out <span class="op">=</span> <span class="va">ODE_out</span><span class="op">$</span><span class="va">state</span><span class="op">)</span>

<span class="co"># add species for plotting</span>
<span class="va">ODE_female</span><span class="op">$</span><span class="va">species</span> <span class="op">&lt;-</span> <span class="st">"Mosquitoes"</span>
<span class="va">ODE_humans</span><span class="op">$</span><span class="va">species</span> <span class="op">&lt;-</span> <span class="st">"Humans"</span>

<span class="co"># plot</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">ODE_female</span>,<span class="va">ODE_humans</span><span class="op">)</span> <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">genotype</span>, linetype <span class="op">=</span> <span class="va">inf</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">species</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"SPN: ODE solution"</span><span class="op">)</span></code></pre></div>
<p><img src="epi-node_files/figure-html/unnamed-chunk-10-1.png" width="691.2"></p>
<p>We see the initial equilibrium of <strong>SEI</strong> mosquitoes and <strong>SIS</strong> humans. Then, as releases are performed, we see disease incidence fall quickly in mosquitoes and that slowly impact incidence in humans.</p>
</div>
<div id="soln_cle" class="section level3">
<h3 class="hasAnchor">
<a href="#soln_cle" class="anchor"></a>Stochastic: Chemical Langevin Equation Solutions</h3>
<p>As a further example, we run a single stochastic realization of the same simulation, using the <code>cle</code> sampler with <span class="math inline">\(\Delta t = 0.1\)</span>, approximating 10 jumps per day. As the adult male mosquitoes do not contribute to infection dynamics, we will only view the adult female mosquito and human dynamics here.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># delta t</span>
<span class="va">dt_stoch</span> <span class="op">&lt;-</span> <span class="fl">0.1</span>

<span class="co"># run CLE simulation</span>
<span class="va">CLE_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_trajectory_R.html">sim_trajectory_R</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">initialCons</span><span class="op">$</span><span class="va">M0</span>, tmax <span class="op">=</span> <span class="va">tmax</span>, dt <span class="op">=</span> <span class="va">dt</span>,
                            dt_stoch <span class="op">=</span> <span class="va">dt_stoch</span>, S <span class="op">=</span> <span class="va">S</span>, hazards <span class="op">=</span> <span class="va">approx_hazards</span>,
                            sampler <span class="op">=</span> <span class="st">"cle"</span>, events <span class="op">=</span> <span class="va">events</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># summarize females/humans by genotype</span>
<span class="va">CLE_female</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_females_epi.html">summarize_females_epi</a></span><span class="op">(</span>out <span class="op">=</span> <span class="va">CLE_out</span><span class="op">$</span><span class="va">state</span>, spn_P <span class="op">=</span> <span class="va">SPN_P</span><span class="op">)</span>
<span class="va">CLE_humans</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_humans_epiSIS.html">summarize_humans_epiSIS</a></span><span class="op">(</span>out <span class="op">=</span> <span class="va">CLE_out</span><span class="op">$</span><span class="va">state</span><span class="op">)</span>

<span class="co"># plot</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">CLE_female</span>,<span class="va">CLE_humans</span><span class="op">)</span> <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">inf</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">genotype</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"SPN: CLE Approximation"</span><span class="op">)</span></code></pre></div>
<p><img src="epi-node_files/figure-html/unnamed-chunk-11-1.png" width="691.2"></p>
<p>Analyzing one stochastic realization of this system, we see some similarities and some striking differences. The releases are clearly visible, lower left-hand plot, and we see that the initial dynamics are similar to the ODE dynamics. However, it is quickly apparent that the releases are not reducing transmission adequately, that in fact, disease incidence is increasing rapidly in human and female mosquitoes. There are two main possibilities for this: first, that the stochastic simulation just happens to drift like this, a visual reminder that there can be significant differences when the well-mixed, mean-field assumptions are relaxed, or that the step size (<span class="math inline">\(\Delta t\)</span>) is too large, and the stochastic simulation is a poor approximation of the ODE solution. Further tests, with <span class="math inline">\(\Delta t = 0.05\)</span> and <span class="math inline">\(\Delta t = 0.15\)</span>, returned similar results, indicating that this is an accurate approximation but still highlighting the importance of testing several values of <span class="math inline">\(\Delta t\)</span> for consistency.</p>
</div>
<div id="ref" class="section level3">
<h3 class="hasAnchor">
<a href="#ref" class="anchor"></a>References</h3>
<ul>
<li>Smith, D. L., &amp; McKenzie, F. E. (2004). Statics and dynamics of malaria infection in Anopheles mosquitoes. Malaria journal, 3(1), 13.</li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="http://www.slwu89.com">Sean L. Wu</a>, <a href="https://github.com/GilChrist19">Jared B. Bennett</a>, <a href="https://www.marshalllab.com">John M. Marshall</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
