<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MGDrivE2: Data Storage and Analysis • MGDrivE2</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="MGDrivE2: Data Storage and Analysis">
<meta property="og:description" content="MGDrivE2">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MGDrivE2</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/advanced_topics.html">MGDrivE2: Advanced Topics</a>
    </li>
    <li>
      <a href="../articles/epi-SEIR.html">MGDrivE2: SEIR Epidemiological Dynamics</a>
    </li>
    <li>
      <a href="../articles/epi-network.html">MGDrivE2: Metapopulation Network Epidemiological Dynamics</a>
    </li>
    <li>
      <a href="../articles/epi-node.html">MGDrivE2: One Node Epidemiological Dynamics</a>
    </li>
    <li>
      <a href="../articles/inhomogeneous.html">MGDrivE2: Simulation of Time-inhomogeneous Stochastic Processes (Seasonality)</a>
    </li>
    <li>
      <a href="../articles/lifecycle-network.html">MGDrivE2: Metapopulation Network Lifecycle Dynamics</a>
    </li>
    <li>
      <a href="../articles/lifecycle-node.html">MGDrivE2: One Node Lifecycle Dynamics</a>
    </li>
    <li>
      <a href="../articles/output-storage.html">MGDrivE2: Data Storage and Analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/MarshallLab/MGDrivE/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="output-storage_files/header-attrs-2.5/header-attrs.js"></script><link href="output-storage_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="output-storage_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>MGDrivE2: Data Storage and Analysis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/MarshallLab/MGDrivE/blob/master/vignettes/output-storage.Rmd"><code>vignettes/output-storage.Rmd</code></a></small>
      <div class="hidden name"><code>output-storage.Rmd</code></div>

    </div>

    
    
<div id="table-of-contents" class="section level2">
<h2 class="hasAnchor">
<a href="#table-of-contents" class="anchor"></a>Table of Contents</h2>
<ol style="list-style-type: decimal">
<li><a href="#pars">Parameterization</a></li>
<li><a href="#init_spn">Initialization of the Petri Net</a></li>
<li><a href="#equilibria_haz">Equilibrium Conditions and Hazard Functions</a></li>
<li>
<a href="#sim">Simulation of Fully Specified SPN Model</a>
<ol style="list-style-type: decimal">
<li><a href="#soln_tau">Tau-leaping Simulation</a></li>
<li><a href="#split_agg">Trace Analysis</a></li>
<li><a href="#summary">Summary Analysis</a></li>
</ol>
</li>
<li><a href="#ref">References</a></li>
</ol>
<div id="preface" class="section level3">
<h3 class="hasAnchor">
<a href="#preface" class="anchor"></a>Preface</h3>
<p>There are several vignettes explaining simulation setup, for basic lifecycle simulations <a href="lifecycle-node.html">here</a> and <a href="lifecycle-network.html">here</a>, as well as for human/mosquito epidemiological studies, <a href="epi-node.html">here</a> and <a href="epi-network.html">here</a> for <strong>SEI</strong>/<strong>SIS</strong> models and <a href="epi-SEIR.html">here</a> for <strong>SEI</strong>/<strong>SEIR</strong> models. However, for actual explorations, many stochastic realizations are needed, as well as summary statistics of those simulations. <strong>MGDrivE2</strong> provides tools for storing output, as well as analyzing and summarizing that output. This vignette will use the <a href="epi-network.html">network <strong>SEI</strong>/<strong>SIS</strong></a> simulation as the example simulation to showcase data storage and analysis.</p>
<p>We start by loading the <strong>MGDrivE2</strong> package, as well as the <strong>MGDrivE</strong> package for access to inheritance cubes, and <strong>Matrix</strong> for sparse matrices used in migration. We will use the basic cube to simulate Mendelian inheritance for this example.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># simulation functions</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://marshalllab.github.io/MGDrivE/">MGDrivE2</a></span><span class="op">)</span>
<span class="co">#&gt; Loading MGDrivE2: Mosquito Gene Drive Explorer Version 2</span>
<span class="co"># inheritance patterns</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://marshalllab.github.io/MGDrivE/">MGDrivE</a></span><span class="op">)</span>
<span class="co">#&gt; Loading MGDrivE: Mosquito Gene Drive Explorer</span>
<span class="co"># sparse migration</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://Matrix.R-forge.R-project.org/">Matrix</a></span><span class="op">)</span>

<span class="co"># basic inheritance pattern</span>
<span class="va">cube</span> <span class="op">&lt;-</span> <span class="fu">MGDrivE</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MGDrivE/man/cubeMendelian.html">cubeMendelian</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="pars" class="section level2">
<h2 class="hasAnchor">
<a href="#pars" class="anchor"></a>Parameterization</h2>
<p>These are the same parameters found in the <a href="epi-network.html">epi-network</a> vignette, and are also explained in the <a href="lifecycle-node.html">lifecycle-node</a> vignette.</p>
<p>We will store output every other day (<code>dt = 2</code>), as writing to disk can be slow and this reduces the amount of data to store by half. The rate that one needs to store data will depend on the accuracy of one’s parameters - i.e., if your parameters are highly questionable, storing data every other day will not lose much information, but if your parameters are very well defined, daily storage may be necessary for accuracy. Note we set <code>tmax</code> artifically low in this vignette to reduce build times as the goal of this article is to demonstrate CSV processing capabilities of <strong>MGDrivE2</strong>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># entomological and epidemiological parameters</span>
<span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="co"># lifecycle parameters</span>
  qE <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">4</span>,
  nE <span class="op">=</span> <span class="fl">2</span>,
  qL <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">3</span>,
  nL <span class="op">=</span> <span class="fl">3</span>,
  qP <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">6</span>,
  nP <span class="op">=</span> <span class="fl">2</span>,
  muE <span class="op">=</span> <span class="fl">0.05</span>,
  muL <span class="op">=</span> <span class="fl">0.15</span>,
  muP <span class="op">=</span> <span class="fl">0.05</span>,
  muF <span class="op">=</span> <span class="fl">0.09</span>,
  muM <span class="op">=</span> <span class="fl">0.09</span>,
  beta <span class="op">=</span> <span class="fl">16</span>,
  nu <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">4</span><span class="op">/</span><span class="fl">24</span><span class="op">)</span>,
  <span class="co"># epidemiological parameters</span>
  NH <span class="op">=</span> <span class="fl">1000</span>,
  X <span class="op">=</span> <span class="fl">0.25</span>,
  f <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">3</span>,
  Q <span class="op">=</span> <span class="fl">0.9</span>,
  b <span class="op">=</span> <span class="fl">0.55</span>,
  c <span class="op">=</span> <span class="fl">0.15</span>,
  r <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">200</span>,
  muH <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">62</span><span class="op">*</span><span class="fl">365</span><span class="op">)</span>,
  qEIP <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">11</span>,
  nEIP <span class="op">=</span> <span class="fl">2</span>
<span class="op">)</span>

<span class="co"># simulation parameters</span>
<span class="va">tmax</span> <span class="op">&lt;-</span> <span class="fl">50</span>
<span class="va">dt</span> <span class="op">&lt;-</span> <span class="fl">2</span></code></pre></div>
<p>Additionally, we augment the cube with transmission efficiencies; see Smith &amp; McKenzie (2004) for an extensive discussion of these parameters.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># augment the cube with RM transmission parameters</span>
<span class="va">cube</span><span class="op">$</span><span class="va">c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span>object <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">theta</span><span class="op">$</span><span class="va">c</span>, times <span class="op">=</span> <span class="va">cube</span><span class="op">$</span><span class="va">genotypesN</span><span class="op">)</span>, nm <span class="op">=</span> <span class="va">cube</span><span class="op">$</span><span class="va">genotypesID</span><span class="op">)</span>
<span class="va">cube</span><span class="op">$</span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"AA"</span> <span class="op">=</span> <span class="va">theta</span><span class="op">$</span><span class="va">b</span>, <span class="st">"Aa"</span> <span class="op">=</span> <span class="fl">0.35</span>, <span class="st">"aa"</span> <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></code></pre></div>
</div>
<div id="init_spn" class="section level2">
<h2 class="hasAnchor">
<a href="#init_spn" class="anchor"></a>Initialization of the Petri Net</h2>
<p>With the basic parameters finished, we setup the types of nodes in our network, their movement in relation to each other, and finally the structure of the Petri Net.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># nodetypes</span>
<span class="va">node_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"m"</span>, <span class="st">"b"</span>, <span class="st">"h"</span><span class="op">)</span>
<span class="va">num_nodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">node_list</span><span class="op">)</span>

<span class="co"># human movement</span>
<span class="va">h_move</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="cn">FALSE</span>, nrow <span class="op">=</span> <span class="va">num_nodes</span>, ncol <span class="op">=</span> <span class="va">num_nodes</span>,
                 dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">node_list</span>, <span class="va">node_list</span><span class="op">)</span><span class="op">)</span>
<span class="va">h_move</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span>
<span class="va">h_move</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span>

<span class="co"># mosquito movement</span>
<span class="va">m_move</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="cn">FALSE</span>, nrow <span class="op">=</span> <span class="va">num_nodes</span>, ncol <span class="op">=</span> <span class="va">num_nodes</span>,
                 dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">node_list</span>, <span class="va">node_list</span><span class="op">)</span><span class="op">)</span>
<span class="va">m_move</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span>
<span class="va">m_move</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span>

<span class="co"># Places and transitions</span>
<span class="va">SPN_P</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spn_P_epiSIS_network.html">spn_P_epiSIS_network</a></span><span class="op">(</span>node_list <span class="op">=</span> <span class="va">node_list</span>, params <span class="op">=</span> <span class="va">theta</span>, cube <span class="op">=</span> <span class="va">cube</span><span class="op">)</span>
<span class="va">SPN_T</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spn_T_epiSIS_network.html">spn_T_epiSIS_network</a></span><span class="op">(</span>node_list <span class="op">=</span> <span class="va">node_list</span>, spn_P <span class="op">=</span> <span class="va">SPN_P</span>, params <span class="op">=</span> <span class="va">theta</span>,
                              cube <span class="op">=</span> <span class="va">cube</span>, h_move <span class="op">=</span> <span class="va">h_move</span>, m_move <span class="op">=</span> <span class="va">m_move</span><span class="op">)</span>

<span class="co"># Stoichiometry matrix</span>
<span class="va">S</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spn_S.html">spn_S</a></span><span class="op">(</span>spn_P <span class="op">=</span> <span class="va">SPN_P</span>, spn_T <span class="op">=</span> <span class="va">SPN_T</span><span class="op">)</span></code></pre></div>
<p>The <code>spn_P_*</code> functions (<code><a href="../reference/spn_P_epiSIS_network.html">spn_P_epiSIS_network()</a></code> used here) all return length 2 lists.The first index (<code>ix</code>) is a list equal to the number of nodes (so here, <code>length(ix) =</code> 3), which returns the uniquely numbered “places” for every life/infection/Erlang stage for the entire network. These correspond to every location in the state vector used during the simulation.</p>
<p>The second item in those lists (<code>u</code>) is the name for every “place”. It is a combination of genotype and node number for eggs, larvae, pupae, unmated females, and male stages. For females, it is a combination of their genotype, their mate genotype, their infection status, and the node number. For humans, it is just infection status and node number.</p>
<p>The <code>spn_T_*</code> functions (<code><a href="../reference/spn_T_epiSIS_network.html">spn_T_epiSIS_network()</a></code> used here) returns a length 2 list. The first element (<code>T</code>) is a list of parameters for every possible state transition. These are not the rates of transition, just the fact that it is possible and parameters necessary to describe them. The second element (<code>v</code>) is the name for each of those transitions.</p>
</div>
<div id="equilibria_haz" class="section level2">
<h2 class="hasAnchor">
<a href="#equilibria_haz" class="anchor"></a>Equilibrium Conditions and Hazard Functions</h2>
<p>Remember, these are node-by-node equilibria, not an equilibrium over the entire network. We expect some burn-in at the beginning of the simulation as the network reaches equilibrium.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># SEI mosquitoes and SIS humans equilibrium</span>
<span class="co">#  outputs required parameters in the named list "params"</span>
<span class="co">#  outputs intial equilibrium for adv users, "init</span>
<span class="co">#  outputs properly filled initial markings, "M0"</span>
<span class="va">initialCons</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/equilibrium_SEI_SIS.html">equilibrium_SEI_SIS</a></span><span class="op">(</span>params <span class="op">=</span> <span class="va">theta</span>, node_list <span class="op">=</span> <span class="va">node_list</span>,
                                   NF <span class="op">=</span> <span class="fl">500</span>, phi <span class="op">=</span> <span class="fl">0.5</span>, NH <span class="op">=</span> <span class="fl">1000</span>, pop_ratio_H <span class="op">=</span> <span class="fl">0.15</span>,
                                   log_dd <span class="op">=</span> <span class="cn">TRUE</span>, spn_P <span class="op">=</span> <span class="va">SPN_P</span>, cube <span class="op">=</span> <span class="va">cube</span><span class="op">)</span></code></pre></div>
<p>The <code>equilibrium_*</code> functions (<code><a href="../reference/equilibrium_SEI_SIS.html">equilibrium_SEI_SIS()</a></code> used here) return a length 3 list. The first element (<code>params</code>) are all of the parameters required for the simulation. These include user-supplied parameters from before (<code>theta</code>), as well as derived parameters, such as the density-dependent parameter. The second element is a matrix of equilibrium populations. The rows are nodes, the columns are life stages. Any stage that does not exist in a node (human stages in mosquito-only nodes, mosquito stages in human-only nodes) have <code>NA</code> values. The final element is <code>M0</code>, the initial marking for the Petri Net. This takes all of the equilibrium values from the second element, and using the places indices, distributes populations to their appropriate location in the Petri Net framework.</p>
<p>Next, we setup the movement rates for mosquitoes and humans, to their respective nodes. See the <a href="epi-network.html">epi-network</a> vignette for a detailed explanation.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># calculate movement rates and movement probabilities</span>
<span class="va">gam</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_move_rate.html">calc_move_rate</a></span><span class="op">(</span>mu <span class="op">=</span> <span class="va">initialCons</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">muF</span>, P <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>

<span class="co"># set mosquito movement rates/probabilities</span>
<span class="co">#  mosquitoes exist in nodes 1 and 2, not 3</span>
<span class="va">mr_mosy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">gam</span>, <span class="va">gam</span>, <span class="cn">NaN</span><span class="op">)</span>
<span class="va">mp_mosy</span> <span class="op">&lt;-</span> <span class="fu">Matrix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/sparseMatrix.html">sparseMatrix</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, x <span class="op">=</span> <span class="fl">1</span>, dims <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">m_move</span><span class="op">)</span><span class="op">)</span>

<span class="co"># set human movement rates/probabilities</span>
<span class="co">#  humans exist in nodes 2 and 3, not 1</span>
<span class="va">mr_human</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NaN</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">7</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">7</span><span class="op">)</span>
<span class="va">mp_human</span> <span class="op">&lt;-</span> <span class="fu">Matrix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/sparseMatrix.html">sparseMatrix</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>, j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span>, x <span class="op">=</span> <span class="fl">1</span>, dims <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">h_move</span><span class="op">)</span><span class="op">)</span>

<span class="co"># put rates and probs into the parameter list</span>
<span class="va">initialCons</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">mosquito_move_rates</span> <span class="op">&lt;-</span> <span class="va">mr_mosy</span>
<span class="va">initialCons</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">mosquito_move_probs</span> <span class="op">&lt;-</span> <span class="va">mp_mosy</span>
<span class="va">initialCons</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">human_move_rates</span> <span class="op">&lt;-</span> <span class="va">mr_human</span>
<span class="va">initialCons</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">human_move_probs</span> <span class="op">&lt;-</span> <span class="va">mp_human</span></code></pre></div>
<p>Now that all the necessary parameters have been added to the named list <code>initialCons$params</code>, we generate the hazard functions, using the function <code><a href="../reference/spn_hazards.html">spn_hazards()</a></code>. By specifying <code>log_dd = TRUE</code>, we use logistic density dependence for these simulations.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># exact hazards for integer-valued state space</span>
<span class="va">exact_hazards</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spn_hazards.html">spn_hazards</a></span><span class="op">(</span>spn_P <span class="op">=</span> <span class="va">SPN_P</span>, spn_T <span class="op">=</span> <span class="va">SPN_T</span>, cube <span class="op">=</span> <span class="va">cube</span>,
                             params <span class="op">=</span> <span class="va">initialCons</span><span class="op">$</span><span class="va">params</span>, type <span class="op">=</span> <span class="st">"SIS"</span>,
                             log_dd <span class="op">=</span> <span class="cn">TRUE</span>, exact <span class="op">=</span> <span class="cn">TRUE</span>, tol <span class="op">=</span> <span class="cn">NaN</span>,
                             verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>The hazard function (<code><a href="../reference/spn_hazards.html">spn_hazards()</a></code>) returns a list of functions that define the rates of every transition. It is the same length as the first element of the <code>SPN_T</code>, i.e., one rate for every possible transition in the Petri Net.</p>
</div>
<div id="sim" class="section level2">
<h2 class="hasAnchor">
<a href="#sim" class="anchor"></a>Simulation of Fully Specified SPN Model</h2>
<p>Before running any simulations, we need to create some releases, and then setup the folder structure.</p>
<p>We will release 50 adult females with homozygous recessive alleles 2 times, every 7 days, starting at day 10, in node 1 (this allows us to see movement from node 1 to node 2, before we see an impact on human disease transmission). Remember, it is critically important that <strong>the event names match a place name</strong> in the simulation. The simulation function checks this and will throw an error if the event name does not exist as a place in the simulation. This format is used in <strong>MGDrivE2</strong> for consistency with solvers in <code>deSolve</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># releases</span>
<span class="va">r_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">10</span>, length.out <span class="op">=</span> <span class="fl">2</span>, by <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>
<span class="va">r_size</span> <span class="op">&lt;-</span> <span class="fl">50</span>
<span class="va">events</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="st">"var"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"F_"</span>, <span class="va">cube</span><span class="op">$</span><span class="va">releaseType</span>, <span class="st">"_"</span>, <span class="va">cube</span><span class="op">$</span><span class="va">wildType</span>, <span class="st">"_S_1"</span><span class="op">)</span>,
                     <span class="st">"time"</span> <span class="op">=</span> <span class="va">r_times</span>,
                     <span class="st">"value"</span> <span class="op">=</span> <span class="va">r_size</span>,
                     <span class="st">"method"</span> <span class="op">=</span> <span class="st">"add"</span>,
                     stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>Next, we need to setup the file structure for CSV simulations.</p>
<p>We <strong>recommend</strong> setting up a new folder for any simulations. This ensures a clean location, and in the chance someone deletes everything in the folder, there is nothing important there. Inside the main folder (<code>main_out</code>), we need three folders, for each stage of the analysis. We generally call these <code>raw</code>, <code>traces</code>, and <code>analyzed</code>, to describe their purpose. The <code>raw</code> folder holds all of the raw output from the simulation. It is further divided into repetition folders. These can be named anything, we use a numeric naming scheme that sorts properly in file systems. The <code>traces</code> folder holds the first set analysis output. It starts empty, the provided functions setup the necessary folders, and each repetition will be split into the appropriate life-stage and node designation. The final folder, <code>analyzed</code>, holds the summary statistics from our simulations.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># main output folder</span>
<span class="va">main_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># folders for each stage of analysis</span>
<span class="va">analysis_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"raw"</span>, <span class="st">"traces"</span>, <span class="st">"analyzed"</span><span class="op">)</span>

<span class="co"># repetitions, 3 of them</span>
<span class="va">rep_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/formatc.html">formatC</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, width<span class="op">=</span><span class="fl">3</span>, format<span class="op">=</span><span class="st">'d'</span>, flag<span class="op">=</span><span class="st">'0'</span><span class="op">)</span>

<span class="co"># build analysis folders</span>
<span class="va">analysis_folders</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">main_out</span>, <span class="va">analysis_out</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">analysis_folders</span><span class="op">)</span><span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">i</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">}</span>

<span class="co"># build repetition folders</span>
<span class="va">rep_folders</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">analysis_folders</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">rep_out</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">rep_folders</span><span class="op">)</span><span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">}</span></code></pre></div>
<div id="soln_tau" class="section level3">
<h3 class="hasAnchor">
<a href="#soln_tau" class="anchor"></a>Tau-leaping Simulation</h3>
<p>We start by running the simulations. As explained in the <a href="inhomogeneous.html">inhomogeneous</a> vignette, there are two ways to perform repetitions - using the internal repetition wrapper, or using a parallel loop. By providing output folders to <code><a href="../reference/sim_trajectory_CSV.html">sim_trajectory_CSV()</a></code>, we can make use of both methods simultaneously. However, for this example, we only use the internal repetitions wrapper.</p>
<p>Additionally, we need to specify what life-stages to store. For this example, we will output all of the stages. However, we recommend only saving the stages necessary for the experiment at hand. Each stage to print has a one-letter designation for the function.</p>
<table class="table">
<thead><tr class="header">
<th align="center">One-Letter Designation</th>
<th align="left">Stage Name</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center"><code>E</code></td>
<td align="left">Egg stage</td>
</tr>
<tr class="even">
<td align="center"><code>L</code></td>
<td align="left">Larval stage</td>
</tr>
<tr class="odd">
<td align="center"><code>P</code></td>
<td align="left">Pupal stage</td>
</tr>
<tr class="even">
<td align="center"><code>M</code></td>
<td align="left">Adult male stage</td>
</tr>
<tr class="odd">
<td align="center"><code>U</code></td>
<td align="left">Adult, unmated female stage</td>
</tr>
<tr class="even">
<td align="center"><code>F</code></td>
<td align="left">Adult, mated female stage</td>
</tr>
<tr class="odd">
<td align="center"><code>H</code></td>
<td align="left">Adult humans</td>
</tr>
</tbody>
</table>
<p>The mated female stage (<code>F</code>) will print infection states to different files. This keeps individual files from becoming too unwieldy.</p>
<p>Finally, we run three stochastic realizations of the simulation, using the <code>tau</code> sampler with <span class="math inline">\(\Delta t = 0.1\)</span>, approximating 10 jumps per day.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># delta t</span>
<span class="va">dt_stoch</span> <span class="op">&lt;-</span> <span class="fl">0.1</span>

<span class="co"># run tau-leaping simulation</span>
<span class="fu"><a href="../reference/sim_trajectory_CSV.html">sim_trajectory_CSV</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">initialCons</span><span class="op">$</span><span class="va">M0</span>, tmax <span class="op">=</span> <span class="va">tmax</span>, dt <span class="op">=</span> <span class="va">dt</span>,
                   dt_stoch <span class="op">=</span> <span class="va">dt_stoch</span>, folders <span class="op">=</span> <span class="va">rep_folders</span>,
                   stage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"E"</span>, <span class="st">"L"</span>, <span class="st">"P"</span>, <span class="st">"M"</span>, <span class="st">"U"</span>, <span class="st">"F"</span>, <span class="st">"H"</span><span class="op">)</span>, S <span class="op">=</span> <span class="va">S</span>,
                   hazards <span class="op">=</span> <span class="va">exact_hazards</span>, events <span class="op">=</span> <span class="va">events</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; Warning in base_events(x0 = x0, events = events, dt = dt): event times do not correspond to a multiple of dt.</span>
<span class="co">#&gt; event times will be rounded up to the nearest time-step!</span></code></pre></div>
<p>We can see all of the files returned by the simulation.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># list all files from the first repetition</span>
<span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">rep_folders</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, full.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; [1] "E.csv"  "FE.csv" "FI.csv" "FS.csv" "H.csv"  "L.csv"  "M.csv"  "P.csv" </span>
<span class="co">#&gt; [9] "U.csv"</span></code></pre></div>
<p>Each file begins with the one-letter signifier. Notice that the female stage (<code>F</code>) has been expanded into three stages, one for each infection (<strong>SEI</strong>) stage. These names must stay the same, as the following analysis only matches the outputs from <code><a href="../reference/sim_trajectory_CSV.html">sim_trajectory_CSV()</a></code>.</p>
<p>To see how the files are organized, we will open two of them: the egg stage (<code>E.csv</code>) and the susceptible female stage (<code>FS.csv</code>).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># read the eggs from repetition 1</span>
<span class="va">egg_stage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">rep_folders</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"E.csv"</span><span class="op">)</span>, header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># read susceptible females from repetition 1</span>
<span class="va">fs_stage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">rep_folders</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"FS.csv"</span><span class="op">)</span>, header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>First, we will look at the dimensions of each file. Everything is printed at the same rate, <code>dt</code>, so the length of the files should match, but the number of columns is significantly different.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># eggs</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">egg_stage</span><span class="op">)</span>
<span class="co">#&gt; [1] 26 13</span>

<span class="co"># susceptible females</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">fs_stage</span><span class="op">)</span>
<span class="co">#&gt; [1] 26 19</span></code></pre></div>
<p>Every file begins with a “Time” column, followed by the stage designations. It is these stage designations that explain why female files are so much larger than the rest. As described earlier, the names for each place are a combination of genotypes and node for most stages, but for adult females, places are labeled by 3 designations. The column labels in the egg file are:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">egg_stage</span><span class="op">)</span>
<span class="co">#&gt;  [1] "Time"    "E1_AA_1" "E2_AA_1" "E1_Aa_1" "E2_Aa_1" "E1_aa_1" "E2_aa_1"</span>
<span class="co">#&gt;  [8] "E1_AA_2" "E2_AA_2" "E1_Aa_2" "E2_Aa_2" "E1_aa_2" "E2_aa_2"</span></code></pre></div>
<p>First column is “Time”, and each subsequent column is the Erlang-stage, genotype, and node. These labels correspond to the labels in the <code>SPN_P$u</code> list, and the labels on the state vector, <code>M0</code>.</p>
<p>Looking at the females output, we see how this state space gets large quickly.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">fs_stage</span><span class="op">)</span>
<span class="co">#&gt;  [1] "Time"        "F_AA_AA_S_1" "F_AA_Aa_S_1" "F_AA_aa_S_1" "F_Aa_AA_S_1"</span>
<span class="co">#&gt;  [6] "F_Aa_Aa_S_1" "F_Aa_aa_S_1" "F_aa_AA_S_1" "F_aa_Aa_S_1" "F_aa_aa_S_1"</span>
<span class="co">#&gt; [11] "F_AA_AA_S_2" "F_AA_Aa_S_2" "F_AA_aa_S_2" "F_Aa_AA_S_2" "F_Aa_Aa_S_2"</span>
<span class="co">#&gt; [16] "F_Aa_aa_S_2" "F_aa_AA_S_2" "F_aa_Aa_S_2" "F_aa_aa_S_2"</span></code></pre></div>
<p>Again, the “Time” column is first, followed by female genotypes, mate genotypes, infection stage, and node location. This is why female files have been split into different infection stages.</p>
</div>
<div id="split_agg" class="section level3">
<h3 class="hasAnchor">
<a href="#split_agg" class="anchor"></a>Trace Analysis</h3>
<p>The raw analysis is large, and difficult to work with. So, as a first reduction, <strong>MGDrivE2</strong> provides the function <code><a href="../reference/split_aggregate_CSV.html">split_aggregate_CSV()</a></code> to organize the raw output. This function takes the <code>raw</code> folder, duplicates the folder structure in the <code>traces</code> folder, and reduces the raw output by several metrics. The aquatic stages are summarized by genotype, with the option to summarize them by Erlang-stage if desired, and split into patches. Adult female stages are summarized by female genotype, summing over male mates, and then split by patch as well. This function expects file names output from the previous function, and by default looks for all of the output. If anything is not found, it is skipped. Additionally, the user can specify subsets of the <code>raw</code> output and run different analyses over each.</p>
<p>We designate the folder <code>traces</code> because we can plot population traces from the output. These are the individual dynamics of each genotype and each stage for every simulation.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># split everything by patch, aggregate by genotype</span>
<span class="fu"><a href="../reference/split_aggregate_CSV.html">split_aggregate_CSV</a></span><span class="op">(</span>read_dir <span class="op">=</span> <span class="va">analysis_folders</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, write_dir <span class="op">=</span> <span class="va">analysis_folders</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,
                    spn_P <span class="op">=</span> <span class="va">SPN_P</span>, tmax <span class="op">=</span> <span class="va">tmax</span>, dt <span class="op">=</span> <span class="va">dt</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>Looking at the <code>traces</code> folder, we see the folder structure is identical to the <code>raw</code> folder.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># don't list parent directory</span>
<span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.dirs</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">analysis_folders</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, recursive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; [1] "/var/folders/qv/y1wxv5g94gsgkt5dm8c08vy00000gn/T//RtmpZq2Iav/traces/001"</span>
<span class="co">#&gt; [2] "/var/folders/qv/y1wxv5g94gsgkt5dm8c08vy00000gn/T//RtmpZq2Iav/traces/002"</span>
<span class="co">#&gt; [3] "/var/folders/qv/y1wxv5g94gsgkt5dm8c08vy00000gn/T//RtmpZq2Iav/traces/003"</span></code></pre></div>
<p>We can look at the output in the first repetition folder.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">analysis_folders</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">rep_out</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;  [1] "E_0001.csv"  "E_0002.csv"  "FE_0001.csv" "FE_0002.csv" "FI_0001.csv"</span>
<span class="co">#&gt;  [6] "FI_0002.csv" "FS_0001.csv" "FS_0002.csv" "H_0002.csv"  "H_0003.csv" </span>
<span class="co">#&gt; [11] "L_0001.csv"  "L_0002.csv"  "M_0001.csv"  "M_0002.csv"  "P_0001.csv" </span>
<span class="co">#&gt; [16] "P_0002.csv"  "U_0001.csv"  "U_0002.csv"</span></code></pre></div>
<p>Notice, every file begins with our one/two letter stage designation. The number following it is the node number. Remember, our network has 3 nodes, m, b, h. We expect that mosquito stages are found in nodes one and two, while humans are found in nodes 2 and 3.</p>
<p>We look at the reduced versions of the same two files we opened previously to compare the differences.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># read the eggs from repetition 1</span>
<span class="va">egg_stage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">analysis_folders</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">rep_out</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"E_0001.csv"</span><span class="op">)</span>,
                      header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># read susceptible females from repetition 1</span>
<span class="va">fs_stage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">analysis_folders</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">rep_out</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"FS_0001.csv"</span><span class="op">)</span>,
                     header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>The length of each file is the same, since we need every time point, but the number of columns is significantly less.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># eggs</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">egg_stage</span><span class="op">)</span>
<span class="co">#&gt; [1] 26  4</span>

<span class="co"># susceptible females</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">fs_stage</span><span class="op">)</span>
<span class="co">#&gt; [1] 26  4</span></code></pre></div>
<p>Again, every file begins with a “Time” column, but now all files have the same remaining columns as well, just the genotypes.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># eggs</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">egg_stage</span><span class="op">)</span>
<span class="co">#&gt; [1] "Time" "AA"   "Aa"   "aa"</span>

<span class="co"># females</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">fs_stage</span><span class="op">)</span>
<span class="co">#&gt; [1] "Time" "AA"   "Aa"   "aa"</span></code></pre></div>
<p>Since our genotypes stay the same throughout the population, every mosquito file now has the same columns names, “Time” and then genotypes. Humans are still separated by infection stage, since that is the only way we keep track of them.</p>
</div>
<div id="summary" class="section level3">
<h3 class="hasAnchor">
<a href="#summary" class="anchor"></a>Summary Analysis</h3>
<p>Traces make nice squiggly plots, but are not particularly helpful otherwise. Our final step is calculating summary statistics from the simulations. <strong>MGDrivE2</strong> provides a function (<code><a href="../reference/summarize_stats_CSV.html">summarize_stats_CSV()</a></code>) to calculate the mean and quantiles over all simulations. It reads the output of <code><a href="../reference/split_aggregate_CSV.html">split_aggregate_CSV()</a></code>, and returns the desired summaries.</p>
<p>Quantiles are calculated empirically, using algorithm 8 from the built-in quantile function.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># mean and 95% quantiles</span>
<span class="fu"><a href="../reference/summarize_stats_CSV.html">summarize_stats_CSV</a></span><span class="op">(</span>read_dir <span class="op">=</span> <span class="va">analysis_folders</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, write_dir <span class="op">=</span> <span class="va">analysis_folders</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,
                    spn_P <span class="op">=</span> <span class="va">SPN_P</span>, tmax <span class="op">=</span> <span class="va">tmax</span>, dt <span class="op">=</span> <span class="va">dt</span>, mean <span class="op">=</span> <span class="cn">TRUE</span>,
                    quantiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>Since repetitions are summarized, we do not have the same directory structure in the <code>analyzed</code> folder, just the summaries.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">analysis_folders</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt;  [1] "E_Mean_0001.csv"            "E_Mean_0002.csv"           </span>
<span class="co">#&gt;  [3] "E_Quantile_00250_0001.csv"  "E_Quantile_00250_0002.csv" </span>
<span class="co">#&gt;  [5] "E_Quantile_09750_0001.csv"  "E_Quantile_09750_0002.csv" </span>
<span class="co">#&gt;  [7] "FE_Mean_0001.csv"           "FE_Mean_0002.csv"          </span>
<span class="co">#&gt;  [9] "FE_Quantile_00250_0001.csv" "FE_Quantile_00250_0002.csv"</span>
<span class="co">#&gt; [11] "FE_Quantile_09750_0001.csv" "FE_Quantile_09750_0002.csv"</span>
<span class="co">#&gt; [13] "FI_Mean_0001.csv"           "FI_Mean_0002.csv"          </span>
<span class="co">#&gt; [15] "FI_Quantile_00250_0001.csv" "FI_Quantile_00250_0002.csv"</span>
<span class="co">#&gt; [17] "FI_Quantile_09750_0001.csv" "FI_Quantile_09750_0002.csv"</span>
<span class="co">#&gt; [19] "FS_Mean_0001.csv"           "FS_Mean_0002.csv"          </span>
<span class="co">#&gt; [21] "FS_Quantile_00250_0001.csv" "FS_Quantile_00250_0002.csv"</span>
<span class="co">#&gt; [23] "FS_Quantile_09750_0001.csv" "FS_Quantile_09750_0002.csv"</span>
<span class="co">#&gt; [25] "H_Mean_0002.csv"            "H_Mean_0003.csv"           </span>
<span class="co">#&gt; [27] "H_Quantile_00250_0002.csv"  "H_Quantile_00250_0003.csv" </span>
<span class="co">#&gt; [29] "H_Quantile_09750_0002.csv"  "H_Quantile_09750_0003.csv" </span>
<span class="co">#&gt; [31] "L_Mean_0001.csv"            "L_Mean_0002.csv"           </span>
<span class="co">#&gt; [33] "L_Quantile_00250_0001.csv"  "L_Quantile_00250_0002.csv" </span>
<span class="co">#&gt; [35] "L_Quantile_09750_0001.csv"  "L_Quantile_09750_0002.csv" </span>
<span class="co">#&gt; [37] "M_Mean_0001.csv"            "M_Mean_0002.csv"           </span>
<span class="co">#&gt; [39] "M_Quantile_00250_0001.csv"  "M_Quantile_00250_0002.csv" </span>
<span class="co">#&gt; [41] "M_Quantile_09750_0001.csv"  "M_Quantile_09750_0002.csv" </span>
<span class="co">#&gt; [43] "P_Mean_0001.csv"            "P_Mean_0002.csv"           </span>
<span class="co">#&gt; [45] "P_Quantile_00250_0001.csv"  "P_Quantile_00250_0002.csv" </span>
<span class="co">#&gt; [47] "P_Quantile_09750_0001.csv"  "P_Quantile_09750_0002.csv" </span>
<span class="co">#&gt; [49] "U_Mean_0001.csv"            "U_Mean_0002.csv"           </span>
<span class="co">#&gt; [51] "U_Quantile_00250_0001.csv"  "U_Quantile_00250_0002.csv" </span>
<span class="co">#&gt; [53] "U_Quantile_09750_0001.csv"  "U_Quantile_09750_0002.csv"</span></code></pre></div>
<p>Again, the stage designation is at the front of every file name. Next, either <code>Mean</code> or <code>Quantile</code>. If <code>Mean</code>, then the node designation. If <code>Quantile</code>, which quantile, and then the node designation.</p>
<p>We will open the egg and susceptible females files, to see the summaries, but the structure of these files is the same as the trace files.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># read the eggs from repetition 1</span>
<span class="va">egg_stage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">analysis_folders</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="st">"E_Mean_0001.csv"</span><span class="op">)</span>,
                      header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># read susceptible females from repetition 1</span>
<span class="va">fs_stage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">analysis_folders</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="st">"FS_Mean_0001.csv"</span><span class="op">)</span>,
                     header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># eggs</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">egg_stage</span><span class="op">)</span>
<span class="co">#&gt; [1] 26  4</span>

<span class="co"># susceptible females</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">fs_stage</span><span class="op">)</span>
<span class="co">#&gt; [1] 26  4</span></code></pre></div>
<p>The dimensions are the same as the trace files. We also see that the column names are the same as well.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># eggs</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">egg_stage</span><span class="op">)</span>
<span class="co">#&gt; [1] "Time" "AA"   "Aa"   "aa"</span>

<span class="co"># females</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">fs_stage</span><span class="op">)</span>
<span class="co">#&gt; [1] "Time" "AA"   "Aa"   "aa"</span></code></pre></div>
<p>The plotting utilities provided by <strong>MGDrivE2</strong> do not work on CSV output. Our assumption is that, if one is generating enough data to use the CSV utilities, then there are specific plotting requirements.</p>
<!-- ```{r, echo=FALSE}
# Cleanup
unlink(x = main_out, recursive = TRUE)
``` -->
</div>
<div id="ref" class="section level3">
<h3 class="hasAnchor">
<a href="#ref" class="anchor"></a>References</h3>
<ul>
<li>Smith, D. L., &amp; McKenzie, F. E. (2004). Statics and dynamics of malaria infection in Anopheles mosquitoes. Malaria journal, 3(1), 13.</li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="http://www.slwu89.com">Sean L. Wu</a>, <a href="https://github.com/GilChrist19">Jared B. Bennett</a>, <a href="https://www.marshalllab.com">John M. Marshall</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
